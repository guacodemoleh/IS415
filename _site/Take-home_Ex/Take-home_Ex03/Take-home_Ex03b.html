<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victoria Grace ANN">
<meta name="dcterms.date" content="2024-03-11">

<title>IS415-GAA - Take-home Exercise 3 (Revised): Exploratory Spatial Data Analysis for Potential Push &amp; Pull Factors of Locations in Singapore using Public Bus Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.32/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex10.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1: Technical Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01a.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1: Report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03a.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3 (beta)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03b.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About Victoria</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1.0 Overview</a></li>
  <li><a href="#package-installation" id="toc-package-installation" class="nav-link" data-scroll-target="#package-installation">2.0 Package Installation</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">3.0 Data sources</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">4.0 Data preparation</a></li>
  <li><a href="#data-preparation-for-bus-induced-hexagons" id="toc-data-preparation-for-bus-induced-hexagons" class="nav-link" data-scroll-target="#data-preparation-for-bus-induced-hexagons">4.1 Data preparation for bus-induced hexagons</a></li>
  <li><a href="#constructing-bus-commuter-flow-data" id="toc-constructing-bus-commuter-flow-data" class="nav-link" data-scroll-target="#constructing-bus-commuter-flow-data">4.2 Constructing bus commuter flow data</a></li>
  <li><a href="#spatial-push-pull-factors" id="toc-spatial-push-pull-factors" class="nav-link" data-scroll-target="#spatial-push-pull-factors">5.0 Spatial Push &amp; Pull Factors</a></li>
  <li><a href="#data-preparation-for-pois" id="toc-data-preparation-for-pois" class="nav-link" data-scroll-target="#data-preparation-for-pois">5.1 Data preparation for POIs</a></li>
  <li><a href="#visualisation-of-poi-densities" id="toc-visualisation-of-poi-densities" class="nav-link" data-scroll-target="#visualisation-of-poi-densities">5.2 Visualisation of POI densities</a></li>
  <li><a href="#distance-matrix-computation" id="toc-distance-matrix-computation" class="nav-link" data-scroll-target="#distance-matrix-computation">6.0 Distance Matrix Computation</a></li>
  <li><a href="#prepare-origin-destination-variables" id="toc-prepare-origin-destination-variables" class="nav-link" data-scroll-target="#prepare-origin-destination-variables">6.1 Prepare Origin &amp; Destination Variables</a></li>
  <li><a href="#construction" id="toc-construction" class="nav-link" data-scroll-target="#construction">6.2 Construction</a>
  <ul>
  <li><a href="#label-column-and-row-headers" id="toc-label-column-and-row-headers" class="nav-link" data-scroll-target="#label-column-and-row-headers">Label column and row headers</a></li>
  <li><a href="#pivot-distance-value-by-hexagon-grid-index" id="toc-pivot-distance-value-by-hexagon-grid-index" class="nav-link" data-scroll-target="#pivot-distance-value-by-hexagon-grid-index">Pivot distance value by hexagon grid index</a></li>
  <li><a href="#update-intra-zonal-distances" id="toc-update-intra-zonal-distances" class="nav-link" data-scroll-target="#update-intra-zonal-distances">Update intra-zonal distances</a></li>
  </ul></li>
  <li><a href="#separating-intra-flow-from-passenger-volume" id="toc-separating-intra-flow-from-passenger-volume" class="nav-link" data-scroll-target="#separating-intra-flow-from-passenger-volume">6.3 Separating intra-flow from passenger volume</a>
  <ul>
  <li><a href="#combining-passenger-volume-data-with-distance-value" id="toc-combining-passenger-volume-data-with-distance-value" class="nav-link" data-scroll-target="#combining-passenger-volume-data-with-distance-value">Combining passenger volume data with distance value</a></li>
  <li><a href="#preparing-origin-attributes" id="toc-preparing-origin-attributes" class="nav-link" data-scroll-target="#preparing-origin-attributes">Preparing origin attributes</a></li>
  <li><a href="#preparing-destination-attributes" id="toc-preparing-destination-attributes" class="nav-link" data-scroll-target="#preparing-destination-attributes">Preparing destination attributes</a></li>
  <li><a href="#check-for-variables-with-zero-values" id="toc-check-for-variables-with-zero-values" class="nav-link" data-scroll-target="#check-for-variables-with-zero-values">Check for variables with zero values</a></li>
  <li><a href="#apply-log-transformation" id="toc-apply-log-transformation" class="nav-link" data-scroll-target="#apply-log-transformation">Apply log transformation</a></li>
  </ul></li>
  <li><a href="#spatial-econometric-interaction-modelling" id="toc-spatial-econometric-interaction-modelling" class="nav-link" data-scroll-target="#spatial-econometric-interaction-modelling">7.0 Spatial Econometric Interaction Modelling</a>
  <ul>
  <li><a href="#spatial-interaction-model" id="toc-spatial-interaction-model" class="nav-link" data-scroll-target="#spatial-interaction-model">7.1 Spatial Interaction Model</a></li>
  <li><a href="#spatial-econometric-interaction-modelling-1" id="toc-spatial-econometric-interaction-modelling-1" class="nav-link" data-scroll-target="#spatial-econometric-interaction-modelling-1">7.2 Spatial Econometric Interaction Modelling</a></li>
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis">Correlation Analysis</a></li>
  <li><a href="#seim-calibration" id="toc-seim-calibration" class="nav-link" data-scroll-target="#seim-calibration">7.2.1 SEIM Calibration</a>
  <ul class="collapse">
  <li><a href="#residual-diagnostics" id="toc-residual-diagnostics" class="nav-link" data-scroll-target="#residual-diagnostics">Residual diagnostics</a></li>
  <li><a href="#visualise-fitted-values" id="toc-visualise-fitted-values" class="nav-link" data-scroll-target="#visualise-fitted-values">Visualise Fitted Values</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#prototype" id="toc-prototype" class="nav-link" data-scroll-target="#prototype">8.0 Prototype</a></li>
  <li><a href="#level-1-general-perspective" id="toc-level-1-general-perspective" class="nav-link" data-scroll-target="#level-1-general-perspective">Level 1: General Perspective</a>
  <ul>
  <li><a href="#general-outflows-from-origins-propulsive" id="toc-general-outflows-from-origins-propulsive" class="nav-link" data-scroll-target="#general-outflows-from-origins-propulsive">General Outflows from Origins (Propulsive)</a></li>
  <li><a href="#inflows-to-destinations-attractive" id="toc-inflows-to-destinations-attractive" class="nav-link" data-scroll-target="#inflows-to-destinations-attractive">Inflows to Destinations (Attractive)</a></li>
  <li><a href="#weekday-vs-weekendholiday" id="toc-weekday-vs-weekendholiday" class="nav-link" data-scroll-target="#weekday-vs-weekendholiday">Weekday vs Weekend/Holiday</a></li>
  <li><a href="#specific-hour-of-the-day" id="toc-specific-hour-of-the-day" class="nav-link" data-scroll-target="#specific-hour-of-the-day">Specific Hour of the Day</a></li>
  </ul></li>
  <li><a href="#level-2-planning-area" id="toc-level-2-planning-area" class="nav-link" data-scroll-target="#level-2-planning-area">Level 2: Planning Area</a></li>
  <li><a href="#level-3-subzone" id="toc-level-3-subzone" class="nav-link" data-scroll-target="#level-3-subzone">Level 3: Subzone</a></li>
  <li><a href="#validating-spatial-interaction-models" id="toc-validating-spatial-interaction-models" class="nav-link" data-scroll-target="#validating-spatial-interaction-models">Validating Spatial Interaction Models</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3 (Revised): Exploratory Spatial Data Analysis for Potential Push &amp; Pull Factors of Locations in Singapore using Public Bus Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Victoria Grace ANN </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 11, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 26, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>1.0 Overview</h1>
<p>In this exercise, my focus would be on prototyping exploratory spatial data analysis, particularly density of spatial assets within hexagonal traffic analysis zones. In conventional geography, a traffic analysis zone is the unit most commonly used in transportation planning models and the size of it varies. Hexagonal traffic analysis zones has gained traction as the hexagons of the study area have a uniform size which are easily comparable with each other when determining transport attractiveness. It is also recommended that hexagon radius should be 125m for areas in high urbanisation and 250m in areas with less urbanisation (Chmielewski et al., 2020).</p>
<p>The data preparation for this purpose also supports the preparation for calibrating spatial interaction models. For the prototyping, only exploratory spatial data analysis will be done.</p>
</section>
<section id="package-installation" class="level1">
<h1>2.0 Package Installation</h1>
<p>I will load up the below R packages for the following purposes:</p>
<ul>
<li><p>tmap: to visualise spatial data by creating thematic maps that could be interactive or static.</p></li>
<li><p>sf: to manipulate spatial data.</p></li>
<li><p>sp: to manipulate spatial data (older than sp).</p></li>
<li><p>reshape2: to reshape and transform data frames; converting data between “wide” and “long” formats using functions like melt().</p></li>
<li><p>ggplot2: to visualise data with plot types including bar plots.</p></li>
<li><p>tidyverse: to clean and transform data and contains sub-packagess including tidyr, dplyr and readr.</p></li>
<li><p>stplanr: to provide functions suitable for working with spatial transport data like networks, orgins-destinations matrices and travel time matrices; builds on the capabilities of sf and sp packages.</p></li>
<li><p>knitr: to combine code into a single documents that can be easily converted to various output formats like html, pdf, or Word.</p></li>
<li><p>kableExtra: to further style any Kables.</p></li>
<li><p>spdep: to create spatial wieght matrix objects from contiguities</p></li>
<li><p>spflow: to estimate spatial econometric interaction models</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tmap, sf, sp, reshape2, ggplot2, ggpubr, tidyverse, stplanr, knitr, kableExtra, spdep)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"LukeCe/spflow"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spflow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-sources" class="level1">
<h1>3.0 Data sources</h1>
<ul>
<li><p>URA’s Masterplan Subzone 2019 Layer in shapefile format</p></li>
<li><p>Bus Stop Locations extracted from LTA</p></li>
<li><p>A tabulated bus passenger flow for Nov 2023, Dec 2023 and Jan 2024 from LTA dynamic data mall</p></li>
<li><p>Population Data for 2023 from SingStat</p></li>
<li><p>Schools from MOE</p></li>
<li><p>Financial Services</p></li>
<li><p>Hospitals, polyclinics and CHAS clinics derived from Google Maps</p></li>
</ul>
</section>
<section id="data-preparation" class="level1">
<h1>4.0 Data preparation</h1>
</section>
<section id="data-preparation-for-bus-induced-hexagons" class="level1">
<h1>4.1 Data preparation for bus-induced hexagons</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Bus Stops Layer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Subzone Layer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Spatial Grids Layer</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Read the aspatial bus stop layer and set its CRS to 3414.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BusStop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/aspatial/bus_coords_subzone_v2.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Read the subzone layer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/master-plan-2019-subzone-boundary-no-sea-kml.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert <code>mpsz</code> to 2D geometry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(mpsz, <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="co"># Convert 3D geometries to 2D</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Extract the <code>SUBZONE_N</code> and <code>PLN_AREA_N</code> from the <code>Dscrptn</code> field</p>
<p>For SUBZONE_N,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUBZONE_N =</span> <span class="fu">str_extract</span>(Description, <span class="st">"&lt;th&gt;SUBZONE_N&lt;/th&gt; &lt;td&gt;(.*?)&lt;/td&gt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>SUBZONE_N <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(mpsz<span class="sc">$</span>SUBZONE_N, <span class="st">"&lt;.*?&gt;|SUBZONE_N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For PLN_AREA_N,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PLN_AREA_N =</span> <span class="fu">str_extract</span>(Description, <span class="st">"&lt;th&gt;PLN_AREA_N&lt;/th&gt; &lt;td&gt;(.*?)&lt;/td&gt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>PLN_AREA_N <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(mpsz<span class="sc">$</span>PLN_AREA_N, <span class="st">"&lt;.*?&gt;|PLN_AREA_N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove the <code>Description</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>Description <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove unwanted outer islands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mpsz, <span class="dv">3414</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>outer_islands <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEMAKAU"</span>, <span class="st">"SUDONG"</span>, <span class="st">"NORTH-EASTERN ISLANDS"</span>, <span class="st">"SOUTHERN GROUP"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> mpsz3414 <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_trim</span>(SUBZONE_N) <span class="sc">%in%</span> <span class="fu">str_trim</span>(outer_islands))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the shapefile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(mpsz3414, <span class="st">"data/geospatial/mpsz_sf.shp"</span>, <span class="at">append=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the updated shapefile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mpsz_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/mpsz_sf.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `mpsz_sf' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\mpsz_sf.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 328 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 21448.47 xmax: 55941.94 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>The goal to create incoming and outgoing bus traffic flow visualisations from trip origins to trip destinations only requires hexagons containing bus stops.</p>
<p>Let’s look at how bus stops are distributed in Singapore.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz_sf) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Bus stops in Singapore"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(BusStop) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.005</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are a few bus stops that are located in Malaysia after the Tuas Checkpoint. Since they are geographically beyond Singapore’s boundary, these bus stops need to be removed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>BusStop <span class="ot">&lt;-</span> BusStop <span class="sc">%&gt;%</span>  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(mpsz_sf) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(BusStopCode,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some regions like the Central Water Catchment area and the west-end of Singapore do not have any bus stops. To make the hexagons containing bus stops,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hex_sg <span class="ot">&lt;-</span> BusStop <span class="sc">%&gt;%</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">750</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">what =</span> <span class="st">"polygons"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">square =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">as.factor</span>(<span class="fu">row_number</span>()))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>mpsz_border <span class="ot">&lt;-</span> mpsz_sf <span class="sc">%&gt;%</span> <span class="fu">st_union</span>()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>hex_sg2 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(hex_sg, mpsz_border)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">&lt;-</span> hex_sg <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">lengths</span>(<span class="fu">st_intersects</span>(geometry, BusStop)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code interpretation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>st_make_grid: creates grids</p></li>
<li><p>cellsize: hexagon size determined by twice the length of the apothem</p></li>
<li><p>st_sf: set the hexagons as a sf object</p></li>
<li><p>filter: filtering for hexagons that contain bus stops</p></li>
<li><p>mutate: creating index IDs for the filtered hexagons based on the row number</p></li>
</ul>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz_sf) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Hexagons with SG Bus Stops"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(BusStop) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.005</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="constructing-bus-commuter-flow-data" class="level1">
<h1>4.2 Constructing bus commuter flow data</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Combining OD data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>od_bus_nov <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_nov_v2.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>od_bus_dec <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_dec_v2.csv"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>od_bus_jan <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_jan_v2.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>OD <span class="ot">&lt;-</span> <span class="fu">rbind</span>(od_bus_nov, od_bus_dec)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>OD <span class="ot">&lt;-</span> <span class="fu">rbind</span>(OD, od_bus_jan)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(od_bus_nov) <span class="sc">+</span> <span class="fu">nrow</span>(od_bus_dec) <span class="sc">+</span> <span class="fu">nrow</span>(od_bus_jan) <span class="sc">==</span> <span class="fu">nrow</span>(OD) <span class="co"># evaluates to TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(OD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>ORIGIN_PT_CODE</code> and <code>DESTINATION_PT_CODE</code> are listed as character variables. These variables should be transformed to factors so that R treats them as grouping variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ORIGIN_PT_CODE"</span>, <span class="st">"DESTINATION_PT_CODE"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>OD[cols_to_convert] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(OD[cols_to_convert], as.factor)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(OD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ORIGIN_PT_CODE<code>and</code>DESTINATION_PT_CODE` are now factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OD, <span class="st">"data/rds/odbus_combined.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>odbus_combined <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/odbus_combined.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Creating Commute Flow Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> odbus_combined <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_PT_CODE, ORIGIN_SUBZONE, DESTINATION_PT_CODE, DESTINATION_SUBZONE, DAY_TYPE ,TIME_PER_HOUR) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TOTAL_TRIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(od, <span class="st">"data/rds/od.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/od.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Geospatial Wrangling
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Now we need to convert the od data from aspatial to geospatial data.</p>
<p>First, we populate the hexagon grid indexes of <code>hex_grid_bounded2</code> sf data frame into <code>BusStop</code> sf data frame using <em>st_intersection()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>BusStop_hex <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(BusStop, hex_sg) <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(BusStopCode, index) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BusStopCode"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>BusStop_hex[cols_to_convert] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(BusStop_hex[cols_to_convert], as.factor)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(BusStop_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Append the hexagon grid index from <code>BusStop_hex</code> data frame to the segregated od data frames for both <code>ORIGIN_PT_CODE</code> and <code>DESTINATION_PT_CODE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>od_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(od, BusStop_hex,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BusStopCode"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>od_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(od_data, BusStop_hex,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"DESTINATION_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BusStopCode"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"DESTIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_hex, ORIGIN_SUBZONE, DESTIN_hex, DESTINATION_SUBZONE, DAY_TYPE, TIME_PER_HOUR) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TOTAL_TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span>, <span class="st">"DESTIN_hex"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>od_data[cols_to_convert] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(od_data[cols_to_convert], as.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(od_data, <span class="st">"data/rds/od_data.rds"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>od_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/od_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remove intra-zonal flows
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It is not meaningful to include trips that started and ended from the same point, so we will only include point pairs where the origin and destination of a trip are different.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>od_plot <span class="ot">&lt;-</span> od_data[od_data<span class="sc">$</span>ORIGIN_hex<span class="sc">!=</span>od_data<span class="sc">$</span>DESTIN_hex,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Create desire lines
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Use <em>od2line()</em> of <strong>stplanr</strong> package to create the desire lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>od_plot <span class="ot">&lt;-</span> od_plot[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="fu">ncol</span>(od_plot))]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>flowLine <span class="ot">&lt;-</span> <span class="fu">od2line</span>(<span class="at">flow =</span> od_plot, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">zones =</span> hex_grids,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">zone_code =</span> <span class="st">"index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Point
</div>
</div>
<div class="callout-body-container callout-body">
<p>The flow data in the <code>od2line</code> function must have the origin and destination indexes in its first two columns.</p>
</div>
</div>
<p>Write and read the flowline layer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(flowLine, <span class="st">"data/rds/flowLine.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>flowLine <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flowLine.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="spatial-push-pull-factors" class="level1">
<h1>5.0 Spatial Push &amp; Pull Factors</h1>
<p>Push factors are reasons for pushing people or passengers away from their location. Pull factors are reasons for attracting passenger to a location. These are the factor densities I am looking into:</p>
<ul>
<li><p><strong>Population density</strong> of an area has an impact on movement patterns as higher population density areas can act as a propulsive force. The HDB data will be used as a proxy for the population density, where a greater number of units will indicate a higher population density.</p></li>
<li><p><strong>Employment opportunities density</strong> of an area can also contribute a location’s push or pull. An area with more businesses will attract more workers to the area and thus the registered business data will be used as a proxy.</p></li>
<li><p><strong>School Density</strong> can determine the volume of passengers commuting to an area as an area with more schools would attract more human traffic whilst an area with fewer or no schools will not attract students especially during school hours.</p></li>
<li><p><strong>Financial Services Density</strong> can contribute to the overall attractiveness of a destination of a destination for employment by offering convenience.</p></li>
<li><p><strong>Public Healthcare Density</strong> can reflect the utility of polyclinics and public hospitals through the traffic network.</p></li>
</ul>
</section>
<section id="data-preparation-for-pois" class="level1">
<h1>5.1 Data preparation for POIs</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Population</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Business</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">School</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Financial Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Public Healthcare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Leisure &amp; Recreation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Food &amp; Beverages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-8" role="tab" aria-controls="tabset-2-8" aria-selected="false">Retail</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-9" role="tab" aria-controls="tabset-2-9" aria-selected="false">Entertainment</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-10" role="tab" aria-controls="tabset-2-10" aria-selected="false">Bus Stop</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importing Aspatial HDB data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <em>read_csv()</em> from the <strong>readr</strong> package to import the prepared HDB csv data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hdb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/hdb.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the purpose of computing a proxy for population density, the residential units will be extracted using <em>filter()</em> from the <strong>dplyr</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>hdb_residential <span class="ot">&lt;-</span> hdb <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(residential <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hdb_residential, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 37
    ...1 blk_no street       max_floor_lvl year_completed residential commercial
   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
 1     0 1      BEACH RD                16           1970 Y           Y         
 2     1 1      BEDOK STH A…            14           1975 Y           N         
 3     3 1      CHAI CHEE RD            15           1982 Y           N         
 4     4 1      CHANGI VILL…             4           1975 Y           Y         
 5     5 1      DELTA AVE               25           1982 Y           N         
 6     6 1      DOVER RD                12           1975 Y           N         
 7     7 1      EUNOS CRES              14           1977 Y           N         
 8     8 1      EVERTON PK              12           1980 Y           Y         
 9    10 1      GHIM MOH RD             15           1975 Y           N         
10    11 1      HAIG RD                 15           1976 Y           N         
# ℹ 30 more variables: market_hawker &lt;chr&gt;, miscellaneous &lt;chr&gt;,
#   multistorey_carpark &lt;chr&gt;, precinct_pavilion &lt;chr&gt;,
#   bldg_contract_town &lt;chr&gt;, total_dwelling_units &lt;dbl&gt;, `1room_sold` &lt;dbl&gt;,
#   `2room_sold` &lt;dbl&gt;, `3room_sold` &lt;dbl&gt;, `4room_sold` &lt;dbl&gt;,
#   `5room_sold` &lt;dbl&gt;, exec_sold &lt;dbl&gt;, multigen_sold &lt;dbl&gt;,
#   studio_apartment_sold &lt;dbl&gt;, `1room_rental` &lt;dbl&gt;, `2room_rental` &lt;dbl&gt;,
#   `3room_rental` &lt;dbl&gt;, other_room_rental &lt;dbl&gt;, lat &lt;dbl&gt;, lng &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>There are also some outliers like hotels that are classified as a residential unit. We can remove rows containing ‘hotel’ using <em>grepl()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>hotels <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"HOTEL"</span>, building, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(hotels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">…1</th>
<th style="text-align: left;">blk_no</th>
<th style="text-align: left;">street</th>
<th style="text-align: right;">max_floor_lvl</th>
<th style="text-align: right;">year_completed</th>
<th style="text-align: left;">residential</th>
<th style="text-align: left;">commercial</th>
<th style="text-align: left;">market_hawker</th>
<th style="text-align: left;">miscellaneous</th>
<th style="text-align: left;">multistorey_carpark</th>
<th style="text-align: left;">precinct_pavilion</th>
<th style="text-align: left;">bldg_contract_town</th>
<th style="text-align: right;">total_dwelling_units</th>
<th style="text-align: right;">1room_sold</th>
<th style="text-align: right;">2room_sold</th>
<th style="text-align: right;">3room_sold</th>
<th style="text-align: right;">4room_sold</th>
<th style="text-align: right;">5room_sold</th>
<th style="text-align: right;">exec_sold</th>
<th style="text-align: right;">multigen_sold</th>
<th style="text-align: right;">studio_apartment_sold</th>
<th style="text-align: right;">1room_rental</th>
<th style="text-align: right;">2room_rental</th>
<th style="text-align: right;">3room_rental</th>
<th style="text-align: right;">other_room_rental</th>
<th style="text-align: right;">lat</th>
<th style="text-align: right;">lng</th>
<th style="text-align: left;">building</th>
<th style="text-align: left;">addr</th>
<th style="text-align: left;">postal</th>
<th style="text-align: right;">SUBZONE_NO</th>
<th style="text-align: left;">SUBZONE_N</th>
<th style="text-align: left;">SUBZONE_C</th>
<th style="text-align: left;">PLN_AREA_N</th>
<th style="text-align: left;">PLN_AREA_C</th>
<th style="text-align: left;">REGION_N</th>
<th style="text-align: left;">REGION_C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295097</td>
<td style="text-align: right;">103.8541</td>
<td style="text-align: left;">RAFFLES HOTEL</td>
<td style="text-align: left;">1 BEACH ROAD RAFFLES HOTEL SINGAPORE 189673</td>
<td style="text-align: left;">189673</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">4580</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.294801</td>
<td style="text-align: right;">103.8545</td>
<td style="text-align: left;">RAFFLES HOTEL SINGAPORE</td>
<td style="text-align: left;">3 BEACH ROAD RAFFLES HOTEL SINGAPORE SINGAPORE 189674</td>
<td style="text-align: left;">189674</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The HDB Blk 1 Beach Road shares a similar address as Raffles Hotel’s 1 Beach Road, but they have different postal codes.</p>
<p>To verify other similar addresses, filter for addresses containing “BEACH RD”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>beach_rd <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"BEACH RD"</span>, street, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(beach_rd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 5%">
<col style="width: 12%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">…1</th>
<th style="text-align: left;">blk_no</th>
<th style="text-align: left;">street</th>
<th style="text-align: right;">max_floor_lvl</th>
<th style="text-align: right;">year_completed</th>
<th style="text-align: left;">residential</th>
<th style="text-align: left;">commercial</th>
<th style="text-align: left;">market_hawker</th>
<th style="text-align: left;">miscellaneous</th>
<th style="text-align: left;">multistorey_carpark</th>
<th style="text-align: left;">precinct_pavilion</th>
<th style="text-align: left;">bldg_contract_town</th>
<th style="text-align: right;">total_dwelling_units</th>
<th style="text-align: right;">1room_sold</th>
<th style="text-align: right;">2room_sold</th>
<th style="text-align: right;">3room_sold</th>
<th style="text-align: right;">4room_sold</th>
<th style="text-align: right;">5room_sold</th>
<th style="text-align: right;">exec_sold</th>
<th style="text-align: right;">multigen_sold</th>
<th style="text-align: right;">studio_apartment_sold</th>
<th style="text-align: right;">1room_rental</th>
<th style="text-align: right;">2room_rental</th>
<th style="text-align: right;">3room_rental</th>
<th style="text-align: right;">other_room_rental</th>
<th style="text-align: right;">lat</th>
<th style="text-align: right;">lng</th>
<th style="text-align: left;">building</th>
<th style="text-align: left;">addr</th>
<th style="text-align: left;">postal</th>
<th style="text-align: right;">SUBZONE_NO</th>
<th style="text-align: left;">SUBZONE_N</th>
<th style="text-align: left;">SUBZONE_C</th>
<th style="text-align: left;">PLN_AREA_N</th>
<th style="text-align: left;">PLN_AREA_C</th>
<th style="text-align: left;">REGION_N</th>
<th style="text-align: left;">REGION_C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295097</td>
<td style="text-align: right;">103.8541</td>
<td style="text-align: left;">RAFFLES HOTEL</td>
<td style="text-align: left;">1 BEACH ROAD RAFFLES HOTEL SINGAPORE 189673</td>
<td style="text-align: left;">189673</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">1660</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1974</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295796</td>
<td style="text-align: right;">103.8555</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">15 BEACH ROAD</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">BUGIS</td>
<td style="text-align: left;">DTSZ01</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2079</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1974</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.303689</td>
<td style="text-align: right;">103.8636</td>
<td style="text-align: left;">GOLDEN BEACH VISTA</td>
<td style="text-align: left;">17 BEACH ROAD GOLDEN BEACH VISTA SINGAPORE 190017</td>
<td style="text-align: left;">190017</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">2567</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">136</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.390462</td>
<td style="text-align: right;">103.9753</td>
<td style="text-align: left;">CHANGI BEACH CLUB</td>
<td style="text-align: left;">2 ANDOVER ROAD CHANGI BEACH CLUB SINGAPORE 509984</td>
<td style="text-align: left;">509984</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">CHANGI POINT</td>
<td style="text-align: left;">CHSZ01</td>
<td style="text-align: left;">CHANGI</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">EAST REGION</td>
<td style="text-align: left;">ER</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4580</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.294801</td>
<td style="text-align: right;">103.8545</td>
<td style="text-align: left;">RAFFLES HOTEL SINGAPORE</td>
<td style="text-align: left;">3 BEACH ROAD RAFFLES HOTEL SINGAPORE SINGAPORE 189674</td>
<td style="text-align: left;">189674</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">6028</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.304716</td>
<td style="text-align: right;">103.8652</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">4 BEACH ROAD SINGAPORE 190004</td>
<td style="text-align: left;">190004</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7743</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.298092</td>
<td style="text-align: right;">103.8569</td>
<td style="text-align: left;">BEACH ROAD CONSERVATION AREA</td>
<td style="text-align: left;">5 TAN QUEE LAN STREET BEACH ROAD CONSERVATION AREA SINGAPORE 188094</td>
<td style="text-align: left;">188094</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">BUGIS</td>
<td style="text-align: left;">DTSZ01</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">8956</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">198</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.303992</td>
<td style="text-align: right;">103.8644</td>
<td style="text-align: left;">BEACH ROAD GARDENS</td>
<td style="text-align: left;">6 BEACH ROAD BEACH ROAD GARDENS SINGAPORE 190006</td>
<td style="text-align: left;">190006</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>2, 5 and 15 Beach Road do not have the correct postal codes following the 1900XX convention. Additionally, these addresses do not have the correct coordinates too.</p>
<p>With reference to URA’s official asset map of Singapore, OneMap, the data will be manually modified using <em>mutate()</em> and <em>ifelse()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>hdb_residential2 <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190001</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3036714</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8644787</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190002</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3040331</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8649285</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190003</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3041872</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8651934</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190005</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3043463</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8648158</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190015</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3034254</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8631535</span>, lng))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check for any duplicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>duplicate <span class="ot">&lt;-</span> hdb_residential2 <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>()<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(duplicate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-81f6fba92bbfcbc41653" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-81f6fba92bbfcbc41653">{"x":{"filter":"none","vertical":false,"data":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>...1<\/th>\n      <th>blk_no<\/th>\n      <th>street<\/th>\n      <th>max_floor_lvl<\/th>\n      <th>year_completed<\/th>\n      <th>residential<\/th>\n      <th>commercial<\/th>\n      <th>market_hawker<\/th>\n      <th>miscellaneous<\/th>\n      <th>multistorey_carpark<\/th>\n      <th>precinct_pavilion<\/th>\n      <th>bldg_contract_town<\/th>\n      <th>total_dwelling_units<\/th>\n      <th>1room_sold<\/th>\n      <th>2room_sold<\/th>\n      <th>3room_sold<\/th>\n      <th>4room_sold<\/th>\n      <th>5room_sold<\/th>\n      <th>exec_sold<\/th>\n      <th>multigen_sold<\/th>\n      <th>studio_apartment_sold<\/th>\n      <th>1room_rental<\/th>\n      <th>2room_rental<\/th>\n      <th>3room_rental<\/th>\n      <th>other_room_rental<\/th>\n      <th>lat<\/th>\n      <th>lng<\/th>\n      <th>building<\/th>\n      <th>addr<\/th>\n      <th>postal<\/th>\n      <th>SUBZONE_NO<\/th>\n      <th>SUBZONE_N<\/th>\n      <th>SUBZONE_C<\/th>\n      <th>PLN_AREA_N<\/th>\n      <th>PLN_AREA_C<\/th>\n      <th>REGION_N<\/th>\n      <th>REGION_C<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"...1","targets":1},{"name":"blk_no","targets":2},{"name":"street","targets":3},{"name":"max_floor_lvl","targets":4},{"name":"year_completed","targets":5},{"name":"residential","targets":6},{"name":"commercial","targets":7},{"name":"market_hawker","targets":8},{"name":"miscellaneous","targets":9},{"name":"multistorey_carpark","targets":10},{"name":"precinct_pavilion","targets":11},{"name":"bldg_contract_town","targets":12},{"name":"total_dwelling_units","targets":13},{"name":"1room_sold","targets":14},{"name":"2room_sold","targets":15},{"name":"3room_sold","targets":16},{"name":"4room_sold","targets":17},{"name":"5room_sold","targets":18},{"name":"exec_sold","targets":19},{"name":"multigen_sold","targets":20},{"name":"studio_apartment_sold","targets":21},{"name":"1room_rental","targets":22},{"name":"2room_rental","targets":23},{"name":"3room_rental","targets":24},{"name":"other_room_rental","targets":25},{"name":"lat","targets":26},{"name":"lng","targets":27},{"name":"building","targets":28},{"name":"addr","targets":29},{"name":"postal","targets":30},{"name":"SUBZONE_NO","targets":31},{"name":"SUBZONE_N","targets":32},{"name":"SUBZONE_C","targets":33},{"name":"PLN_AREA_N","targets":34},{"name":"PLN_AREA_C","targets":35},{"name":"REGION_N","targets":36},{"name":"REGION_C","targets":37}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Converting Aspatial data to Geospatial data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Longitude and latitude values are in decimal degrees and thus the data is in wgs84 geographic coordinate system.</p>
<p>To convert <code>hdb_residential2</code> into sf, we use <em>st_as_sf()</em> and set the <code>crs</code> argument to 4326 first. The transformation to Singapore’s coordinate reference system 3414 will be done with <em>st_transform()</em>.</p>
<p>We only need the postal code, total dwelling units and geometry attributes so we will use the <em>select()</em> function to extract these columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>hdb_residential_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(hdb_residential2, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(postal, total_dwelling_units, geometry)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(hdb_residential_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sf [10,181 × 3] (S3: sf/tbl_df/tbl/data.frame)
 $ postal              : chr [1:10181] "190001" "460001" "461001" "500001" ...
 $ total_dwelling_units: num [1:10181] 142 206 102 55 96 125 247 95 220 219 ...
 $ geometry            :sfc_POINT of length 10181; first list element:  'XY' num [1:2] 31468 31779
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA
  ..- attr(*, "names")= chr [1:2] "postal" "total_dwelling_units"</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Performing in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>housing_count <span class="ot">&lt;-</span> <span class="fu">st_join</span>(hex_sg, hdb_residential_sf, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">join =</span> st_intersects, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(index) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">housing_count =</span> <span class="fu">sum</span>(total_dwelling_units)) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">housing_count =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(housing_count), <span class="dv">0</span>, housing_count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>hex_sg2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_sg, housing_count,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"index"</span> <span class="ot">=</span> <span class="st">"index"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>housing_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0     0.0     0.0   459.3     0.0  7890.0 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: Business
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Business.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Business' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Business.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 6550 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3669.148 ymin: 25408.41 xmax: 47034.83 ymax: 50148.54
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>biz_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, biz))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>biz_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   2.757   0.000 104.000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import aspatial data: School
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/schoolsclean.csv"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(latlong, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"latitude"</span>, <span class="st">"longitude"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>schools_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(schools, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>school_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, schools_sf))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>school_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.1368  0.0000  4.0000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: Financial Services
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>FinServ <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"FinServ"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `FinServ' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 3320 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4881.527 ymin: 25171.88 xmax: 46526.16 ymax: 49338.02
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>fin_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, FinServ))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>fin_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   1.397   0.000 114.000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import aspatial data: Healthcare
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>public_hc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/HospitalsPolyclinics v_2024.csv"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>public_hc.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(public_hc[<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>,], <span class="at">wkt =</span> <span class="st">"geometry"</span>, <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>public_hc2.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(public_hc[<span class="dv">43</span><span class="sc">:</span><span class="dv">1235</span>,], <span class="at">wkt =</span> <span class="st">"geometry"</span>, <span class="at">crs =</span> <span class="dv">3414</span>) <span class="co"># CHAS clinics encoded in EPSG 3414 </span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>public_hc.sf <span class="ot">&lt;-</span> <span class="fu">rbind</span>(public_hc.sf, public_hc2.sf)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">#write_rds(public_hc.sf, "data/geospatial/public_hc.sf")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>hc_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, public_hc.sf))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>hc_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.5196  0.0000 17.0000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: Leisure &amp; Recreation
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>leisure_recre <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Liesure&amp;Recreation.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Liesure&amp;Recreation' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Liesure&amp;Recreation.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1217 features and 30 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25134.28 xmax: 48439.77 ymax: 50078.88
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>leisure_recre_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, leisure_recre))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>leisure_recre_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.5112  0.0000 36.0000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: F&amp;B
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>food_bev <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/F&amp;B.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `F&amp;B' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\F&amp;B.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1919 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25343.27 xmax: 45462.43 ymax: 48796.21
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>food_bev_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, food_bev))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>food_bev_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
  0.0000   0.0000   0.0000   0.8051   0.0000 152.0000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-8-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: Leisure &amp; Recreation
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Retails.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Retails' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Retails.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 37635 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4737.982 ymin: 25171.88 xmax: 48265.04 ymax: 50135.28
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>retail_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, retail))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>retail_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    0.00    0.00   15.84    3.00 1188.00 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-9-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Import Geospatial data: Entertainment
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>entertn <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/entertn.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `entertn' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\entertn.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 114 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 10809.34 ymin: 26528.63 xmax: 41600.62 ymax: 46375.77
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>entertn_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, entertn))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>entertn_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   0.048   0.000  12.000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-10-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perform point-in-polygon count
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>hex_sg2<span class="sc">$</span>bus_count <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_sg2, BusStop))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hex_sg2<span class="sc">$</span>bus_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   2.149   4.000  20.000 </code></pre>
</div>
</div>
<ul>
<li>There are up to 20 bus stops in a study hexagon.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="visualisation-of-poi-densities" class="level1">
<h1>5.2 Visualisation of POI densities</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Bus Stop</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Population</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Business</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">School</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">Financial Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false">Public Healthcare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-7" role="tab" aria-controls="tabset-3-7" aria-selected="false">Leisure &amp; Recreation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-8" role="tab" aria-controls="tabset-3-8" aria-selected="false">Food &amp; Beverages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-9" role="tab" aria-controls="tabset-3-9" aria-selected="false">Retail</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-10" role="tab" aria-controls="tabset-3-10" aria-selected="false">Entertainment</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"bus_count"</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Bus Stop Density"</span>) <span class="sc">+</span> </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"housing_count"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Housing Density"</span>) <span class="sc">+</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"biz_count"</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Business Density"</span>) <span class="sc">+</span> </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"school_count"</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"School Density"</span>) <span class="sc">+</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"fin_count"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Financial Services Density"</span>) <span class="sc">+</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"hc_count"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Public Healthcare Density"</span>) <span class="sc">+</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"leisure_recre_count"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Leisure &amp; Recreation Density"</span>) <span class="sc">+</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"food_bev_count"</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"F&amp;B Density"</span>) <span class="sc">+</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"entertn_count"</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Entertainment Density"</span>) <span class="sc">+</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"entertn_count"</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Entertainment Density"</span>) <span class="sc">+</span> </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>)  <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="distance-matrix-computation" class="level1">
<h1>6.0 Distance Matrix Computation</h1>
</section>
<section id="prepare-origin-destination-variables" class="level1">
<h1>6.1 Prepare Origin &amp; Destination Variables</h1>
<p>::: {callout-note collapse=“true”} ## Origin (Propulsive)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>propulsive <span class="ot">&lt;-</span> hex_sg2 <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index, biz_count, school_count, fin_count, hc_count, bus_count, housing_count, leisure_recre_count, retail_count, entertn_count, food_bev_count)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">names</span>(propulsive) <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_at</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"o_"</span>, .))  <span class="co"># Add prefix to all except index</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign modified names back to the data frame</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(propulsive) <span class="ot">&lt;-</span> origin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
<p>::: {callout-note collapse=“true”} ## Destination</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>attractiveness <span class="ot">&lt;-</span> hex_sg2 <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index, biz_count, school_count, fin_count, hc_count, bus_count, housing_count, leisure_recre_count, retail_count, entertn_count, food_bev_count)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>destin <span class="ot">&lt;-</span> <span class="fu">names</span>(propulsive) <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_at</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"d_"</span>, .))  <span class="co"># Add prefix to all except index</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign modified names back to the data frame</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(attractiveness) <span class="ot">&lt;-</span> destin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
</section>
<section id="construction" class="level1">
<h1>6.2 Construction</h1>
<p>A distance matrix shows the distance between pairs of locations. A location’s distance from itself is shown in the main diagonal of a distance matrix table.</p>
<p>In view of time, we will use sp rather than sf.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>hex_grid_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(hex_grids, <span class="st">"Spatial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">spDists</span>(hex_grid_sp, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># resultant matrix</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dist, <span class="at">n=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
 [1,]    0.000  750.000 1500.000 2704.163 1299.038 2250.000 3436.932 4683.748
 [2,]  750.000    0.000 1299.038 2598.076  750.000 1984.313 3269.174 4562.072
 [3,] 1500.000 1299.038    0.000 1299.038  750.000  750.000 1984.313 3269.174
 [4,] 2704.163 2598.076 1299.038    0.000 1984.313  750.000  750.000 1984.313
 [5,] 1299.038  750.000  750.000 1984.313    0.000 1299.038 2598.076 3897.114
 [6,] 2250.000 1984.313  750.000  750.000 1299.038    0.000 1299.038 2598.076
 [7,] 3436.932 3269.174 1984.313  750.000 2598.076 1299.038    0.000 1299.038
 [8,] 4683.748 4562.072 3269.174 1984.313 3897.114 2598.076 1299.038    0.000
 [9,] 1984.313 1500.000  750.000 1500.000  750.000  750.000 1984.313 3269.174
[10,] 3000.000 2704.163 1500.000  750.000 1984.313  750.000  750.000 1984.313
          [,9]    [,10]
 [1,] 1984.313 3000.000
 [2,] 1500.000 2704.163
 [3,]  750.000 1500.000
 [4,] 1500.000  750.000
 [5,]  750.000 1984.313
 [6,]  750.000  750.000
 [7,] 1984.313  750.000
 [8,] 3269.174 1984.313
 [9,]    0.000 1299.038
[10,] 1299.038    0.000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The result is a matrix object class and the column and row headers are not labeled with the hexagon grid index representing the TAZ.</p>
</div>
</div>
<section id="label-column-and-row-headers" class="level2">
<h2 class="anchored" data-anchor-id="label-column-and-row-headers">Label column and row headers</h2>
<p>Create a list sorted according to the distance matrix by Traffic Analytical Zones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>hex_names <span class="ot">&lt;-</span> hex_grids<span class="sc">$</span>index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Attach the hexagon grid index to the rows and columns for distance matrix matching.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dist) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_names)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dist) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivot-distance-value-by-hexagon-grid-index" class="level2">
<h2 class="anchored" data-anchor-id="pivot-distance-value-by-hexagon-grid-index">Pivot distance value by hexagon grid index</h2>
<p>The distance matrix is pivoted into a long table by using the <em>melt()</em> function of <strong>reshape2</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>distPair <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(dist) <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dist =</span> value)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distPair, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Var1 Var2     dist
1     2    2    0.000
2    40    2  750.000
3    41    2 1500.000
4    42    2 2704.163
5    60    2 1299.038
6    61    2 2250.000
7    62    2 3436.932
8    63    2 4683.748
9    79    2 1984.313
10   80    2 3000.000</code></pre>
</div>
</div>
<ul>
<li>The intra-zonal distances are 0.</li>
</ul>
</section>
<section id="update-intra-zonal-distances" class="level2">
<h2 class="anchored" data-anchor-id="update-intra-zonal-distances">Update intra-zonal distances</h2>
<p>Check for the lowest non-zero distance value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>distPair <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dist <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Var1           Var2           dist      
 Min.   :   2   Min.   :   2   Min.   :  750  
 1st Qu.: 791   1st Qu.: 791   1st Qu.: 8352  
 Median :1203   Median :1203   Median :13500  
 Mean   :1160   Mean   :1160   Mean   :14257  
 3rd Qu.:1545   3rd Qu.:1545   3rd Qu.:19018  
 Max.   :2365   Max.   :2365   Max.   :47381  </code></pre>
</div>
</div>
<p>Since the lowest distance is 750m, any distance less than 750m can represent the intra-zonal distance. For consistency, 375m is appended to intra-zonal distances.</p>
<p>:::{.callout-warning, collapse=“true} ### Warning: Do not leave distances at zero value</p>
<p>In Poisson regression, log is applied to the distances and distances need to be set as positive values. :::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>distPair<span class="sc">$</span>dist <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(distPair<span class="sc">$</span>dist <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">375</span>, distPair<span class="sc">$</span>dist)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(distPair)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Var1           Var2           dist      
 Min.   :   2   Min.   :   2   Min.   :  375  
 1st Qu.: 791   1st Qu.: 791   1st Qu.: 8352  
 Median :1203   Median :1203   Median :13332  
 Mean   :1160   Mean   :1160   Mean   :14240  
 3rd Qu.:1545   3rd Qu.:1545   3rd Qu.:19018  
 Max.   :2365   Max.   :2365   Max.   :47381  </code></pre>
</div>
</div>
<p>Rename the origin and destination fields and convert into factor data type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>distPair <span class="ot">&lt;-</span> distPair <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">orig =</span> Var1,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">dest =</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(orig, dest), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="separating-intra-flow-from-passenger-volume" class="level1">
<h1>6.3 Separating intra-flow from passenger volume</h1>
<p>A new column <code>FlowNoIntra</code> is created to differentiate intra-zone trips from inter-zone trips based on the comparison of origin and destination zones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>od_data<span class="sc">$</span>FlowNoIntra <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  od_data<span class="sc">$</span>ORIGIN_hex <span class="sc">==</span> od_data<span class="sc">$</span>DESTIN_hex, <span class="dv">0</span>, od_data<span class="sc">$</span>TOTAL_TRIPS)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>od_data<span class="sc">$</span>offset <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  od_data<span class="sc">$</span>ORIGIN_hex <span class="sc">==</span> od_data<span class="sc">$</span>DESTIN_hex, <span class="fl">0.000001</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>od_data <span class="ot">&lt;-</span> od_data<span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FlowNoIntra <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="combining-passenger-volume-data-with-distance-value" class="level2">
<h2 class="anchored" data-anchor-id="combining-passenger-volume-data-with-distance-value">Combining passenger volume data with distance value</h2>
<p>Convert the data value type into factor for the origin and destination hex indexes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>od_data<span class="sc">$</span>ORIGIN_hex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(od_data<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>od_data<span class="sc">$</span>DESTIN_hex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(od_data<span class="sc">$</span>DESTIN_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then perform a left join to join the OD data and distPair. Store it under <code>flow_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> od_data <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span> (distPair,</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"orig"</span>,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"DESTIN_hex"</span> <span class="ot">=</span> <span class="st">"dest"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-origin-attributes" class="level2">
<h2 class="anchored" data-anchor-id="preparing-origin-attributes">Preparing origin attributes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span> (propulsive,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-destination-attributes" class="level2">
<h2 class="anchored" data-anchor-id="preparing-destination-attributes">Preparing destination attributes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span> (attractiveness,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"DESTIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-variables-with-zero-values" class="level2">
<h2 class="anchored" data-anchor-id="check-for-variables-with-zero-values">Check for variables with zero values</h2>
<p>For log transformation, log 0 is undefined so it is critical to ensure there are no zero values in the explanatory variables.</p>
<p>All except the bus stop count variables contain zero values and need to be replaced with a negligible value like 0.99.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">ends_with</span>(<span class="st">"_count"</span>)), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.99</span>, .))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(flow_data, <span class="st">"data/rds/flow_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flow_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-log-transformation" class="level2">
<h2 class="anchored" data-anchor-id="apply-log-transformation">Apply log transformation</h2>
<p>Poisson regression is based on log, so log() has to be applied to all our explanatory variables before calibrating the various spatial interaction models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>flow_data_log <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">ends_with</span>(<span class="st">"_count"</span>)), log) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">log</span>(dist))</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flow_data_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="spatial-econometric-interaction-modelling" class="level1">
<h1>7.0 Spatial Econometric Interaction Modelling</h1>
<section id="spatial-interaction-model" class="level2">
<h2 class="anchored" data-anchor-id="spatial-interaction-model">7.1 Spatial Interaction Model</h2>
<p>SIM is a mathematical model predicting the movement of people between origins (like homes) and destinations by examining the distance between them.</p>
<p>In a healthcare context, a SIM can account the likely demand for health services and the quality of service provision at health centres. Conventionally, SIM’s cousin term is gravity model.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Variable Construction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate propulsive variables names</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>origin_var <span class="ot">&lt;-</span> propulsive <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(index)) <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate attractiveness variables names</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>destin_var <span class="ot">&lt;-</span> attractiveness <span class="sc">%&gt;%</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(index)) <span class="sc">%&gt;%</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Origin Constrained Model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the formula dynamically</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>formula_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"TOTAL_TRIPS ~ ORIGIN_hex +"</span>, </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(destin_var, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ dist - 1"</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the string to a formula</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_string)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>orcSIM <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> flow_data_log,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">na.action =</span> na.exclude)</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(orcSIM, <span class="st">"data/rds/decSIM.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>orcSIM <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/orcSIM.rds"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(orcSIM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula, family = poisson(link = "log"), data = flow_data_log, 
    na.action = na.exclude)

Coefficients:
                 Estimate Std. Error  z value Pr(&gt;|z|)    
ORIGIN_hex121  13.5336831  0.0584301   231.62   &lt;2e-16 ***
ORIGIN_hex123  12.4390069  0.0819305   151.82   &lt;2e-16 ***
ORIGIN_hex144  13.4750844  0.0440337   306.02   &lt;2e-16 ***
ORIGIN_hex145  15.0222243  0.0153560   978.26   &lt;2e-16 ***
ORIGIN_hex146  11.3879612  0.0949213   119.97   &lt;2e-16 ***
ORIGIN_hex168  12.0552874  0.0803284   150.07   &lt;2e-16 ***
ORIGIN_hex169  13.2386065  0.0301146   439.61   &lt;2e-16 ***
ORIGIN_hex170  11.5352737  0.0778572   148.16   &lt;2e-16 ***
ORIGIN_hex171  15.1750746  0.0089784  1690.17   &lt;2e-16 ***
ORIGIN_hex190  15.5789009  0.0134204  1160.84   &lt;2e-16 ***
ORIGIN_hex191  13.3539440  0.0455629   293.09   &lt;2e-16 ***
ORIGIN_hex192  14.8953975  0.0105360  1413.76   &lt;2e-16 ***
ORIGIN_hex193  14.5160158  0.0127033  1142.70   &lt;2e-16 ***
ORIGIN_hex194  10.8691168  0.0971347   111.90   &lt;2e-16 ***
ORIGIN_hex215  11.9622065  0.0542435   220.53   &lt;2e-16 ***
ORIGIN_hex216  12.8327822  0.0341570   375.70   &lt;2e-16 ***
ORIGIN_hex217  13.2947484  0.0235066   565.58   &lt;2e-16 ***
ORIGIN_hex218  12.4857636  0.0296134   421.62   &lt;2e-16 ***
ORIGIN_hex236  15.5530131  0.0151447  1026.96   &lt;2e-16 ***
ORIGIN_hex237  12.2034225  0.0533120   228.91   &lt;2e-16 ***
ORIGIN_hex238  12.9448506  0.0348097   371.88   &lt;2e-16 ***
ORIGIN_hex239  12.6631297  0.0342159   370.10   &lt;2e-16 ***
ORIGIN_hex240  12.8543661  0.0335764   382.84   &lt;2e-16 ***
ORIGIN_hex241  12.9443515  0.0211229   612.81   &lt;2e-16 ***
ORIGIN_hex242  13.4779463  0.0197298   683.13   &lt;2e-16 ***
ORIGIN_hex260  14.6962917  0.0356452   412.29   &lt;2e-16 ***
ORIGIN_hex261  11.9823820  0.0498236   240.50   &lt;2e-16 ***
ORIGIN_hex263  13.9405926  0.0199410   699.09   &lt;2e-16 ***
ORIGIN_hex264  16.1279023  0.0040731  3959.61   &lt;2e-16 ***
ORIGIN_hex265  16.5930476  0.0035485  4676.07   &lt;2e-16 ***
ORIGIN_hex286  12.0221498  0.0544035   220.98   &lt;2e-16 ***
ORIGIN_hex287  13.2017789  0.0182382   723.85   &lt;2e-16 ***
ORIGIN_hex288  10.0829448  0.2294183    43.95   &lt;2e-16 ***
ORIGIN_hex309  11.0657186  0.0733322   150.90   &lt;2e-16 ***
ORIGIN_hex310  13.1230383  0.0188857   694.87   &lt;2e-16 ***
ORIGIN_hex311  11.9663950  0.0560884   213.35   &lt;2e-16 ***
ORIGIN_hex331  12.2590234  0.0449598   272.67   &lt;2e-16 ***
ORIGIN_hex332  16.6481995  0.0033582  4957.54   &lt;2e-16 ***
ORIGIN_hex333  13.2075112  0.0206966   638.15   &lt;2e-16 ***
ORIGIN_hex354  13.5544063  0.0253806   534.05   &lt;2e-16 ***
ORIGIN_hex355  12.6696851  0.0311935   406.16   &lt;2e-16 ***
ORIGIN_hex356  13.3390124  0.0168607   791.13   &lt;2e-16 ***
ORIGIN_hex376  11.7534231  0.1031482   113.95   &lt;2e-16 ***
ORIGIN_hex377  12.1780590  0.0400150   304.34   &lt;2e-16 ***
ORIGIN_hex378  12.3413051  0.0294483   419.08   &lt;2e-16 ***
ORIGIN_hex400  12.2011386  0.0479020   254.71   &lt;2e-16 ***
ORIGIN_hex401  14.8904017  0.0081678  1823.06   &lt;2e-16 ***
ORIGIN_hex402  12.8393957  0.0303964   422.40   &lt;2e-16 ***
ORIGIN_hex422  13.7973255  0.0265114   520.43   &lt;2e-16 ***
ORIGIN_hex423  12.7386630  0.0348761   365.25   &lt;2e-16 ***
ORIGIN_hex424  15.2587718  0.0072075  2117.08   &lt;2e-16 ***
ORIGIN_hex446  12.8193956  0.0285447   449.10   &lt;2e-16 ***
ORIGIN_hex447  12.7376760  0.0286467   444.65   &lt;2e-16 ***
ORIGIN_hex448  13.5397484  0.0247556   546.94   &lt;2e-16 ***
ORIGIN_hex468  13.4771925  0.0223460   603.11   &lt;2e-16 ***
ORIGIN_hex469  13.0041018  0.0238821   544.51   &lt;2e-16 ***
ORIGIN_hex470  13.1828958  0.0191584   688.10   &lt;2e-16 ***
ORIGIN_hex492  12.6960485  0.0615570   206.25   &lt;2e-16 ***
ORIGIN_hex493  12.2040978  0.0540860   225.64   &lt;2e-16 ***
ORIGIN_hex494  12.9203086  0.0247718   521.57   &lt;2e-16 ***
ORIGIN_hex515  13.2167915  0.0197119   670.50   &lt;2e-16 ***
ORIGIN_hex516  12.3922036  0.0324141   382.31   &lt;2e-16 ***
ORIGIN_hex518  12.3487104  0.0430076   287.13   &lt;2e-16 ***
ORIGIN_hex538  13.8818652  0.0198955   697.74   &lt;2e-16 ***
ORIGIN_hex539  13.3129638  0.0228677   582.17   &lt;2e-16 ***
ORIGIN_hex540  17.5959241  0.0018849  9335.32   &lt;2e-16 ***
ORIGIN_hex541  13.3927601  0.0265201   505.00   &lt;2e-16 ***
ORIGIN_hex542  14.4041433  0.0127096  1133.32   &lt;2e-16 ***
ORIGIN_hex561  12.2835640  0.0333693   368.11   &lt;2e-16 ***
ORIGIN_hex562  13.3776651  0.0180821   739.83   &lt;2e-16 ***
ORIGIN_hex564  14.4830527  0.0139878  1035.41   &lt;2e-16 ***
ORIGIN_hex565  13.8477991  0.0201971   685.63   &lt;2e-16 ***
ORIGIN_hex584  13.3033595  0.0300736   442.36   &lt;2e-16 ***
ORIGIN_hex585  13.5266341  0.0215723   627.04   &lt;2e-16 ***
ORIGIN_hex586  13.5883414  0.0122092  1112.96   &lt;2e-16 ***
ORIGIN_hex587  16.8900641  0.0031964  5284.07   &lt;2e-16 ***
ORIGIN_hex588  15.0317147  0.0085150  1765.33   &lt;2e-16 ***
ORIGIN_hex608  13.0378272  0.0205707   633.80   &lt;2e-16 ***
ORIGIN_hex609  14.4460100  0.0088504  1632.25   &lt;2e-16 ***
ORIGIN_hex610  16.3767263  0.0035848  4568.43   &lt;2e-16 ***
ORIGIN_hex611  13.8570078  0.0189852   729.88   &lt;2e-16 ***
ORIGIN_hex612  11.1939871  0.3333357    33.58   &lt;2e-16 ***
ORIGIN_hex630  12.8832477  0.0426954   301.75   &lt;2e-16 ***
ORIGIN_hex631  13.7389440  0.0193323   710.67   &lt;2e-16 ***
ORIGIN_hex632  14.5843536  0.0078518  1857.44   &lt;2e-16 ***
ORIGIN_hex633  16.7509020  0.0026053  6429.50   &lt;2e-16 ***
ORIGIN_hex635  13.7698094  0.0243534   565.41   &lt;2e-16 ***
ORIGIN_hex636  14.0465507  0.0147709   950.96   &lt;2e-16 ***
ORIGIN_hex653  15.1477946  0.0090213  1679.11   &lt;2e-16 ***
ORIGIN_hex654  13.5044102  0.0163302   826.96   &lt;2e-16 ***
ORIGIN_hex655  15.9138666  0.0037338  4262.07   &lt;2e-16 ***
ORIGIN_hex656  17.0421969  0.0024877  6850.46   &lt;2e-16 ***
ORIGIN_hex657  14.1249047  0.0160263   881.36   &lt;2e-16 ***
ORIGIN_hex658  11.5526564  0.1042640   110.80   &lt;2e-16 ***
ORIGIN_hex659  11.6618867  0.1259944    92.56   &lt;2e-16 ***
ORIGIN_hex676  13.1128246  0.0308937   424.45   &lt;2e-16 ***
ORIGIN_hex677  13.7890874  0.0202401   681.28   &lt;2e-16 ***
ORIGIN_hex678  14.3008878  0.0126170  1133.46   &lt;2e-16 ***
ORIGIN_hex679  17.4601841  0.0020968  8327.21   &lt;2e-16 ***
ORIGIN_hex680  17.0395798  0.0025523  6676.14   &lt;2e-16 ***
ORIGIN_hex682  12.2808837  0.0548946   223.72   &lt;2e-16 ***
ORIGIN_hex683  12.0900955  0.0743390   162.63   &lt;2e-16 ***
ORIGIN_hex684  11.8563240  0.0848272   139.77   &lt;2e-16 ***
ORIGIN_hex685   8.9833170  0.5773513    15.56   &lt;2e-16 ***
ORIGIN_hex686  11.5676592  0.0747510   154.75   &lt;2e-16 ***
ORIGIN_hex699  10.4491373  0.1313109    79.58   &lt;2e-16 ***
ORIGIN_hex700  13.4186583  0.0285311   470.32   &lt;2e-16 ***
ORIGIN_hex701  13.6753378  0.0145808   937.90   &lt;2e-16 ***
ORIGIN_hex702  17.0617057  0.0022618  7543.49   &lt;2e-16 ***
ORIGIN_hex704  10.7997386  0.1348450    80.09   &lt;2e-16 ***
ORIGIN_hex707  12.6492861  0.0596665   212.00   &lt;2e-16 ***
ORIGIN_hex708  13.8405687  0.0335975   411.95   &lt;2e-16 ***
ORIGIN_hex709  11.6500712  0.0780946   149.18   &lt;2e-16 ***
ORIGIN_hex723  13.5799869  0.0211508   642.06   &lt;2e-16 ***
ORIGIN_hex724  13.5214548  0.0174834   773.39   &lt;2e-16 ***
ORIGIN_hex725  17.7292538  0.0016107 11007.33   &lt;2e-16 ***
ORIGIN_hex726  16.4391001  0.0032320  5086.30   &lt;2e-16 ***
ORIGIN_hex728  10.5300048  0.2294184    45.90   &lt;2e-16 ***
ORIGIN_hex732  11.2759165  0.1601324    70.42   &lt;2e-16 ***
ORIGIN_hex733  11.6748272  0.0860733   135.64   &lt;2e-16 ***
ORIGIN_hex734  14.3484245  0.0361091   397.36   &lt;2e-16 ***
ORIGIN_hex745  13.1506271  0.0299961   438.41   &lt;2e-16 ***
ORIGIN_hex746  13.9500697  0.0162751   857.14   &lt;2e-16 ***
ORIGIN_hex747  13.6751132  0.0122037  1120.57   &lt;2e-16 ***
ORIGIN_hex748  16.9458633  0.0022698  7465.66   &lt;2e-16 ***
ORIGIN_hex750  10.9992468  0.0975975   112.70   &lt;2e-16 ***
ORIGIN_hex756  11.6500430  0.2132054    54.64   &lt;2e-16 ***
ORIGIN_hex769  12.4013625  0.0324955   381.63   &lt;2e-16 ***
ORIGIN_hex770  14.6577552  0.0104970  1396.37   &lt;2e-16 ***
ORIGIN_hex771  15.5741050  0.0045217  3444.28   &lt;2e-16 ***
ORIGIN_hex772  16.0490461  0.0035928  4466.97   &lt;2e-16 ***
ORIGIN_hex774  14.2124407  0.0170390   834.11   &lt;2e-16 ***
ORIGIN_hex791  13.4524324  0.0233018   577.31   &lt;2e-16 ***
ORIGIN_hex792  12.0926289  0.0341792   353.80   &lt;2e-16 ***
ORIGIN_hex793  13.2188081  0.0166994   791.57   &lt;2e-16 ***
ORIGIN_hex794  17.0312099  0.0021822  7804.65   &lt;2e-16 ***
ORIGIN_hex815  14.5974747  0.0091525  1594.92   &lt;2e-16 ***
ORIGIN_hex816  16.3133513  0.0029467  5536.20   &lt;2e-16 ***
ORIGIN_hex817  16.0191688  0.0034294  4671.08   &lt;2e-16 ***
ORIGIN_hex818  17.0719879  0.0021719  7860.49   &lt;2e-16 ***
ORIGIN_hex820  16.4705171  0.0047062  3499.74   &lt;2e-16 ***
ORIGIN_hex837  14.7737840  0.0103482  1427.67   &lt;2e-16 ***
ORIGIN_hex838  12.6069131  0.0220644   571.37   &lt;2e-16 ***
ORIGIN_hex839  16.7452815  0.0024176  6926.47   &lt;2e-16 ***
ORIGIN_hex840  15.1311580  0.0054197  2791.90   &lt;2e-16 ***
ORIGIN_hex862  15.3190950  0.0050217  3050.58   &lt;2e-16 ***
ORIGIN_hex863  15.7311018  0.0053263  2953.49   &lt;2e-16 ***
ORIGIN_hex864  16.8048984  0.0024181  6949.55   &lt;2e-16 ***
ORIGIN_hex866  12.5637593  0.0323114   388.83   &lt;2e-16 ***
ORIGIN_hex883  14.0140174  0.0184800   758.34   &lt;2e-16 ***
ORIGIN_hex886  15.7045707  0.0036452  4308.28   &lt;2e-16 ***
ORIGIN_hex887  12.9253806  0.0492822   262.27   &lt;2e-16 ***
ORIGIN_hex889  13.2004910  0.0253700   520.32   &lt;2e-16 ***
ORIGIN_hex906  12.7557863  0.0291070   438.24   &lt;2e-16 ***
ORIGIN_hex907  15.7719119  0.0054491  2894.39   &lt;2e-16 ***
ORIGIN_hex909  15.6502548  0.0038093  4108.42   &lt;2e-16 ***
ORIGIN_hex910  16.1350668  0.0032478  4968.03   &lt;2e-16 ***
ORIGIN_hex912  15.7958370  0.0051347  3076.28   &lt;2e-16 ***
ORIGIN_hex930  16.7446455  0.0028023  5975.27   &lt;2e-16 ***
ORIGIN_hex931  16.3869138  0.0024673  6641.61   &lt;2e-16 ***
ORIGIN_hex932  16.6165690  0.0023672  7019.55   &lt;2e-16 ***
ORIGIN_hex933  16.4761355  0.0034252  4810.31   &lt;2e-16 ***
ORIGIN_hex935  17.1840643  0.0025082  6851.15   &lt;2e-16 ***
ORIGIN_hex936  11.8598025  0.0753867   157.32   &lt;2e-16 ***
ORIGIN_hex940  12.5834177  0.0478505   262.97   &lt;2e-16 ***
ORIGIN_hex952  12.9495621  0.0249851   518.29   &lt;2e-16 ***
ORIGIN_hex954  14.2709761  0.0071352  2000.08   &lt;2e-16 ***
ORIGIN_hex955  15.9095214  0.0031246  5091.66   &lt;2e-16 ***
ORIGIN_hex956  16.3532498  0.0028176  5804.01   &lt;2e-16 ***
ORIGIN_hex957  15.8361625  0.0050786  3118.20   &lt;2e-16 ***
ORIGIN_hex958  17.3266243  0.0024060  7201.37   &lt;2e-16 ***
ORIGIN_hex959  15.9325566  0.0045326  3515.12   &lt;2e-16 ***
ORIGIN_hex974  11.7895191  0.0725569   162.49   &lt;2e-16 ***
ORIGIN_hex976  15.6847923  0.0038175  4108.60   &lt;2e-16 ***
ORIGIN_hex977  16.0164134  0.0028213  5677.06   &lt;2e-16 ***
ORIGIN_hex978  16.6677817  0.0024670  6756.18   &lt;2e-16 ***
ORIGIN_hex979  16.5400997  0.0033467  4942.18   &lt;2e-16 ***
ORIGIN_hex980  16.0461657  0.0051764  3099.85   &lt;2e-16 ***
ORIGIN_hex981  16.3318135  0.0031170  5239.61   &lt;2e-16 ***
ORIGIN_hex982  17.1137509  0.0027615  6197.30   &lt;2e-16 ***
ORIGIN_hex983  16.3493999  0.0056522  2892.59   &lt;2e-16 ***
ORIGIN_hex985  13.2969512  0.0413262   321.76   &lt;2e-16 ***
ORIGIN_hex986  13.8604377  0.0181837   762.25   &lt;2e-16 ***
ORIGIN_hex998  12.8707858  0.0247161   520.75   &lt;2e-16 ***
ORIGIN_hex999  15.4782558  0.0049505  3126.57   &lt;2e-16 ***
ORIGIN_hex1000 14.4479438  0.0060376  2392.99   &lt;2e-16 ***
ORIGIN_hex1001 16.7371874  0.0024839  6738.37   &lt;2e-16 ***
ORIGIN_hex1002 16.0646765  0.0028642  5608.74   &lt;2e-16 ***
ORIGIN_hex1003 16.8943966  0.0026724  6321.88   &lt;2e-16 ***
ORIGIN_hex1004 16.7689529  0.0030448  5507.42   &lt;2e-16 ***
ORIGIN_hex1005 17.0103765  0.0021472  7922.03   &lt;2e-16 ***
ORIGIN_hex1006 16.5491496  0.0035758  4628.06   &lt;2e-16 ***
ORIGIN_hex1008 12.8714888  0.0334642   384.63   &lt;2e-16 ***
ORIGIN_hex1009 14.7025720  0.0102817  1429.97   &lt;2e-16 ***
ORIGIN_hex1020 12.5737955  0.0303224   414.67   &lt;2e-16 ***
ORIGIN_hex1021 13.7920011  0.0184941   745.75   &lt;2e-16 ***
ORIGIN_hex1022 15.2442783  0.0049333  3090.11   &lt;2e-16 ***
ORIGIN_hex1023 15.1590797  0.0050865  2980.28   &lt;2e-16 ***
ORIGIN_hex1024 15.8319708  0.0036694  4314.56   &lt;2e-16 ***
ORIGIN_hex1025 16.0855118  0.0033919  4742.36   &lt;2e-16 ***
ORIGIN_hex1026 15.8061885  0.0040794  3874.63   &lt;2e-16 ***
ORIGIN_hex1027 16.7971079  0.0024519  6850.54   &lt;2e-16 ***
ORIGIN_hex1028 15.9349744  0.0042657  3735.64   &lt;2e-16 ***
ORIGIN_hex1029 17.6142201  0.0028831  6109.41   &lt;2e-16 ***
ORIGIN_hex1030 14.1059333  0.0147744   954.76   &lt;2e-16 ***
ORIGIN_hex1031 12.7348694  0.0265398   479.84   &lt;2e-16 ***
ORIGIN_hex1044 12.6947984  0.0262750   483.15   &lt;2e-16 ***
ORIGIN_hex1045 14.2683187  0.0098086  1454.68   &lt;2e-16 ***
ORIGIN_hex1046 13.8871355  0.0109848  1264.21   &lt;2e-16 ***
ORIGIN_hex1047 16.2571596  0.0038191  4256.81   &lt;2e-16 ***
ORIGIN_hex1048 17.0649621  0.0019387  8802.40   &lt;2e-16 ***
ORIGIN_hex1049 15.9638254  0.0050562  3157.27   &lt;2e-16 ***
ORIGIN_hex1050 15.3128402  0.0047208  3243.71   &lt;2e-16 ***
ORIGIN_hex1051 15.2557283  0.0052736  2892.85   &lt;2e-16 ***
ORIGIN_hex1052 14.2474666  0.0103460  1377.10   &lt;2e-16 ***
ORIGIN_hex1053 14.5911592  0.0087018  1676.79   &lt;2e-16 ***
ORIGIN_hex1054 13.5045992  0.0210091   642.80   &lt;2e-16 ***
ORIGIN_hex1055 14.1177980  0.0131384  1074.55   &lt;2e-16 ***
ORIGIN_hex1067 15.6406525  0.0040834  3830.31   &lt;2e-16 ***
ORIGIN_hex1068 15.4125161  0.0043590  3535.79   &lt;2e-16 ***
ORIGIN_hex1069 14.1868748  0.0094031  1508.74   &lt;2e-16 ***
ORIGIN_hex1070 16.7808444  0.0022294  7527.06   &lt;2e-16 ***
ORIGIN_hex1073 16.2283217  0.0029808  5444.27   &lt;2e-16 ***
ORIGIN_hex1074 13.7843521  0.0121748  1132.21   &lt;2e-16 ***
ORIGIN_hex1075 15.7775836  0.0047079  3351.31   &lt;2e-16 ***
ORIGIN_hex1076 13.3823613  0.0201222   665.05   &lt;2e-16 ***
ORIGIN_hex1077 11.6242667  0.0451421   257.50   &lt;2e-16 ***
ORIGIN_hex1078 11.8252993  0.0610957   193.55   &lt;2e-16 ***
ORIGIN_hex1090 15.3337579  0.0060568  2531.64   &lt;2e-16 ***
ORIGIN_hex1091 15.8522547  0.0033817  4687.60   &lt;2e-16 ***
ORIGIN_hex1092 14.0091298  0.0103999  1347.04   &lt;2e-16 ***
ORIGIN_hex1093 15.2652660  0.0050722  3009.62   &lt;2e-16 ***
ORIGIN_hex1094 15.8072881  0.0037904  4170.33   &lt;2e-16 ***
ORIGIN_hex1096 14.2570784  0.0084232  1692.60   &lt;2e-16 ***
ORIGIN_hex1097 16.5825710  0.0027261  6082.80   &lt;2e-16 ***
ORIGIN_hex1099 13.9657920  0.0178607   781.93   &lt;2e-16 ***
ORIGIN_hex1100 15.6538758  0.0055387  2826.29   &lt;2e-16 ***
ORIGIN_hex1101 16.2202244  0.0063687  2546.86   &lt;2e-16 ***
ORIGIN_hex1112 15.5476982  0.0048991  3173.60   &lt;2e-16 ***
ORIGIN_hex1113 16.1592413  0.0027249  5930.19   &lt;2e-16 ***
ORIGIN_hex1114 16.3416561  0.0029453  5548.45   &lt;2e-16 ***
ORIGIN_hex1116 13.7509964  0.0103874  1323.81   &lt;2e-16 ***
ORIGIN_hex1117 16.0968730  0.0035373  4550.56   &lt;2e-16 ***
ORIGIN_hex1118 14.6132695  0.0069028  2117.00   &lt;2e-16 ***
ORIGIN_hex1119 17.1609589  0.0019477  8810.74   &lt;2e-16 ***
ORIGIN_hex1123 17.2100923  0.0025057  6868.34   &lt;2e-16 ***
ORIGIN_hex1124 14.5285797  0.0131341  1106.17   &lt;2e-16 ***
ORIGIN_hex1135 15.0019889  0.0054040  2776.09   &lt;2e-16 ***
ORIGIN_hex1136 16.5467352  0.0025572  6470.56   &lt;2e-16 ***
ORIGIN_hex1137 17.6096388  0.0016190 10876.63   &lt;2e-16 ***
ORIGIN_hex1138 14.4264638  0.0177345   813.47   &lt;2e-16 ***
ORIGIN_hex1139 15.3620906  0.0055673  2759.36   &lt;2e-16 ***
ORIGIN_hex1140 13.7308116  0.0109918  1249.19   &lt;2e-16 ***
ORIGIN_hex1141 15.5857256  0.0042098  3702.26   &lt;2e-16 ***
ORIGIN_hex1142 16.0087523  0.0037879  4226.28   &lt;2e-16 ***
ORIGIN_hex1143 16.9134651  0.0030258  5589.77   &lt;2e-16 ***
ORIGIN_hex1145 12.3282313  0.0450044   273.93   &lt;2e-16 ***
ORIGIN_hex1148 18.5297275  0.0016929 10945.62   &lt;2e-16 ***
ORIGIN_hex1158 14.1571616  0.0089210  1586.94   &lt;2e-16 ***
ORIGIN_hex1159 16.2707569  0.0025547  6368.90   &lt;2e-16 ***
ORIGIN_hex1160 15.0361464  0.0050369  2985.19   &lt;2e-16 ***
ORIGIN_hex1162 15.5999397  0.0038254  4077.99   &lt;2e-16 ***
ORIGIN_hex1163 14.9561137  0.0061427  2434.78   &lt;2e-16 ***
ORIGIN_hex1165 16.2706873  0.0033230  4896.32   &lt;2e-16 ***
ORIGIN_hex1169 15.9056586  0.0059548  2671.09   &lt;2e-16 ***
ORIGIN_hex1170 16.2185133  0.0035238  4602.52   &lt;2e-16 ***
ORIGIN_hex1181 14.7008011  0.0065836  2232.93   &lt;2e-16 ***
ORIGIN_hex1182 10.5942756  0.1458697    72.63   &lt;2e-16 ***
ORIGIN_hex1183 15.2076708  0.0046203  3291.50   &lt;2e-16 ***
ORIGIN_hex1184 14.1685466  0.0082741  1712.39   &lt;2e-16 ***
ORIGIN_hex1185 16.1091563  0.0029712  5421.80   &lt;2e-16 ***
ORIGIN_hex1187 13.7415596  0.0184062   746.57   &lt;2e-16 ***
ORIGIN_hex1188 17.3633984  0.0021212  8185.50   &lt;2e-16 ***
ORIGIN_hex1189 16.4010262  0.0041516  3950.58   &lt;2e-16 ***
ORIGIN_hex1191 14.6440599  0.0148360   987.07   &lt;2e-16 ***
ORIGIN_hex1193 16.8671147  0.0024284  6945.69   &lt;2e-16 ***
ORIGIN_hex1194 16.8597199  0.0030454  5536.04   &lt;2e-16 ***
ORIGIN_hex1203 14.6879560  0.0065742  2234.17   &lt;2e-16 ***
ORIGIN_hex1204 13.1363533  0.0150861   870.76   &lt;2e-16 ***
ORIGIN_hex1205 15.7818704  0.0036349  4341.81   &lt;2e-16 ***
ORIGIN_hex1206 15.0446800  0.0055523  2709.64   &lt;2e-16 ***
ORIGIN_hex1207 14.3097190  0.0076853  1861.96   &lt;2e-16 ***
ORIGIN_hex1208 14.7755389  0.0083792  1763.37   &lt;2e-16 ***
ORIGIN_hex1210 15.6970726  0.0065581  2393.52   &lt;2e-16 ***
ORIGIN_hex1211 14.9741697  0.0121610  1231.32   &lt;2e-16 ***
ORIGIN_hex1215 15.7857034  0.0056759  2781.19   &lt;2e-16 ***
ORIGIN_hex1216 17.0922838  0.0024700  6919.93   &lt;2e-16 ***
ORIGIN_hex1217 12.6640904  0.0356660   355.07   &lt;2e-16 ***
ORIGIN_hex1226 16.0822255  0.0035742  4499.53   &lt;2e-16 ***
ORIGIN_hex1228 15.8299594  0.0037332  4240.37   &lt;2e-16 ***
ORIGIN_hex1229 14.6641604  0.0106984  1370.68   &lt;2e-16 ***
ORIGIN_hex1231 14.9649353  0.0049752  3007.89   &lt;2e-16 ***
ORIGIN_hex1237 14.1870457  0.0152497   930.32   &lt;2e-16 ***
ORIGIN_hex1239 16.4293390  0.0029629  5544.99   &lt;2e-16 ***
ORIGIN_hex1240 16.1295662  0.0050972  3164.38   &lt;2e-16 ***
ORIGIN_hex1249 12.8669988  0.0227988   564.37   &lt;2e-16 ***
ORIGIN_hex1250 15.0131050  0.0048040  3125.14   &lt;2e-16 ***
ORIGIN_hex1251 15.9847869  0.0032330  4944.32   &lt;2e-16 ***
ORIGIN_hex1252 13.7505848  0.0122062  1126.53   &lt;2e-16 ***
ORIGIN_hex1253 16.4512906  0.0028185  5836.85   &lt;2e-16 ***
ORIGIN_hex1261 14.2069029  0.0155050   916.28   &lt;2e-16 ***
ORIGIN_hex1262 18.1581327  0.0015730 11543.85   &lt;2e-16 ***
ORIGIN_hex1263 16.6917194  0.0042822  3897.91   &lt;2e-16 ***
ORIGIN_hex1272 15.1148817  0.0053281  2836.82   &lt;2e-16 ***
ORIGIN_hex1273 15.5052955  0.0043599  3556.32   &lt;2e-16 ***
ORIGIN_hex1274 13.7048963  0.0096642  1418.11   &lt;2e-16 ***
ORIGIN_hex1275 14.1308290  0.0078127  1808.71   &lt;2e-16 ***
ORIGIN_hex1283 12.1624556  0.0596668   203.84   &lt;2e-16 ***
ORIGIN_hex1285 16.5341989  0.0031199  5299.56   &lt;2e-16 ***
ORIGIN_hex1286 15.6353457  0.0063930  2445.70   &lt;2e-16 ***
ORIGIN_hex1294 15.1704676  0.0054835  2766.56   &lt;2e-16 ***
ORIGIN_hex1295 14.8258947  0.0093080  1592.82   &lt;2e-16 ***
ORIGIN_hex1296 14.0200666  0.0137728  1017.95   &lt;2e-16 ***
ORIGIN_hex1297 16.4644130  0.0023111  7123.91   &lt;2e-16 ***
ORIGIN_hex1298 13.9657111  0.0108967  1281.64   &lt;2e-16 ***
ORIGIN_hex1299 14.7528773  0.0058790  2509.41   &lt;2e-16 ***
ORIGIN_hex1305 12.9606454  0.0418289   309.85   &lt;2e-16 ***
ORIGIN_hex1307 14.7416795  0.0098822  1491.74   &lt;2e-16 ***
ORIGIN_hex1308 17.0142574  0.0024189  7033.99   &lt;2e-16 ***
ORIGIN_hex1309 16.4474009  0.0046667  3524.43   &lt;2e-16 ***
ORIGIN_hex1319 13.8946694  0.0127002  1094.05   &lt;2e-16 ***
ORIGIN_hex1320 15.1677482  0.0042576  3562.52   &lt;2e-16 ***
ORIGIN_hex1321 14.2746423  0.0077120  1850.96   &lt;2e-16 ***
ORIGIN_hex1322 14.7327023  0.0072450  2033.51   &lt;2e-16 ***
ORIGIN_hex1331 17.0513564  0.0026170  6515.71   &lt;2e-16 ***
ORIGIN_hex1332 16.9308780  0.0026989  6273.19   &lt;2e-16 ***
ORIGIN_hex1333 15.1302945  0.0099369  1522.64   &lt;2e-16 ***
ORIGIN_hex1340 14.0060324  0.0090019  1555.90   &lt;2e-16 ***
ORIGIN_hex1342 14.5953833  0.0054036  2701.07   &lt;2e-16 ***
ORIGIN_hex1343 14.6071627  0.0065182  2240.99   &lt;2e-16 ***
ORIGIN_hex1345 15.1819393  0.0049026  3096.70   &lt;2e-16 ***
ORIGIN_hex1352 13.6842795  0.0275830   496.11   &lt;2e-16 ***
ORIGIN_hex1353 14.1450906  0.0153570   921.08   &lt;2e-16 ***
ORIGIN_hex1354 17.4671451  0.0020357  8580.42   &lt;2e-16 ***
ORIGIN_hex1355 16.2742081  0.0038677  4207.71   &lt;2e-16 ***
ORIGIN_hex1356  8.2754984  0.5000014    16.55   &lt;2e-16 ***
ORIGIN_hex1363 13.8216148  0.0209145   660.86   &lt;2e-16 ***
ORIGIN_hex1364 14.4483946  0.0063404  2278.79   &lt;2e-16 ***
ORIGIN_hex1365 15.4306568  0.0035822  4307.58   &lt;2e-16 ***
ORIGIN_hex1366 16.4335077  0.0023347  7038.83   &lt;2e-16 ***
ORIGIN_hex1368 14.0807681  0.0081702  1723.44   &lt;2e-16 ***
ORIGIN_hex1377 17.1964006  0.0026902  6392.17   &lt;2e-16 ***
ORIGIN_hex1378 16.9816083  0.0029928  5674.16   &lt;2e-16 ***
ORIGIN_hex1379 15.3765270  0.0061083  2517.34   &lt;2e-16 ***
ORIGIN_hex1380 11.1964031  0.1324589    84.53   &lt;2e-16 ***
ORIGIN_hex1386 14.9693130  0.0047713  3137.38   &lt;2e-16 ***
ORIGIN_hex1387 15.3945092  0.0034411  4473.75   &lt;2e-16 ***
ORIGIN_hex1388 14.8548801  0.0051029  2911.08   &lt;2e-16 ***
ORIGIN_hex1389 14.6439981  0.0054325  2695.64   &lt;2e-16 ***
ORIGIN_hex1398 12.9895116  0.0300083   432.86   &lt;2e-16 ***
ORIGIN_hex1400 16.5708643  0.0032464  5104.39   &lt;2e-16 ***
ORIGIN_hex1401 16.3283536  0.0036494  4474.30   &lt;2e-16 ***
ORIGIN_hex1402 14.1151001  0.0112057  1259.63   &lt;2e-16 ***
ORIGIN_hex1409 15.9468394  0.0031632  5041.35   &lt;2e-16 ***
ORIGIN_hex1410 15.3503962  0.0041856  3667.39   &lt;2e-16 ***
ORIGIN_hex1411 15.9046467  0.0029455  5399.61   &lt;2e-16 ***
ORIGIN_hex1413 15.5168370  0.0039554  3922.97   &lt;2e-16 ***
ORIGIN_hex1414 14.7871832  0.0058065  2546.66   &lt;2e-16 ***
ORIGIN_hex1421 12.3220956  0.0686905   179.39   &lt;2e-16 ***
ORIGIN_hex1424 16.7362819  0.0029558  5662.20   &lt;2e-16 ***
ORIGIN_hex1426 13.7553008  0.0166896   824.19   &lt;2e-16 ***
ORIGIN_hex1432 15.7398005  0.0036167  4351.93   &lt;2e-16 ***
ORIGIN_hex1433 15.5188447  0.0035031  4430.01   &lt;2e-16 ***
ORIGIN_hex1434 15.1918823  0.0065036  2335.92   &lt;2e-16 ***
ORIGIN_hex1435 12.7667922  0.0176195   724.58   &lt;2e-16 ***
ORIGIN_hex1436 14.4098891  0.0061076  2359.33   &lt;2e-16 ***
ORIGIN_hex1443 13.6109698  0.0235434   578.12   &lt;2e-16 ***
ORIGIN_hex1444 12.6822387  0.0527183   240.57   &lt;2e-16 ***
ORIGIN_hex1447 14.8911460  0.0121755  1223.04   &lt;2e-16 ***
ORIGIN_hex1448 15.2744997  0.0060215  2536.67   &lt;2e-16 ***
ORIGIN_hex1455 14.7387030  0.0054057  2726.50   &lt;2e-16 ***
ORIGIN_hex1456 15.5284407  0.0032216  4820.14   &lt;2e-16 ***
ORIGIN_hex1457 15.2106189  0.0037757  4028.52   &lt;2e-16 ***
ORIGIN_hex1458 12.4914317  0.0216502   576.97   &lt;2e-16 ***
ORIGIN_hex1460 14.2934313  0.0089620  1594.89   &lt;2e-16 ***
ORIGIN_hex1466 12.7423472  0.0357804   356.13   &lt;2e-16 ***
ORIGIN_hex1470 16.1664183  0.0038665  4181.18   &lt;2e-16 ***
ORIGIN_hex1471 16.8841121  0.0033830  4990.90   &lt;2e-16 ***
ORIGIN_hex1476 12.8292255  0.0390575   328.47   &lt;2e-16 ***
ORIGIN_hex1477 15.4179983  0.0065287  2361.58   &lt;2e-16 ***
ORIGIN_hex1478 16.0053302  0.0030649  5222.05   &lt;2e-16 ***
ORIGIN_hex1479 16.3469033  0.0022620  7226.64   &lt;2e-16 ***
ORIGIN_hex1480 13.4294603  0.0134672   997.20   &lt;2e-16 ***
ORIGIN_hex1482 15.0565031  0.0053308  2824.41   &lt;2e-16 ***
ORIGIN_hex1483 11.6471003  0.0420145   277.22   &lt;2e-16 ***
ORIGIN_hex1488 10.8385227  0.0867185   124.98   &lt;2e-16 ***
ORIGIN_hex1489 15.0370956  0.0072825  2064.82   &lt;2e-16 ***
ORIGIN_hex1492 13.9401766  0.0177627   784.80   &lt;2e-16 ***
ORIGIN_hex1493 17.3725025  0.0020591  8436.90   &lt;2e-16 ***
ORIGIN_hex1494 15.8283917  0.0052498  3015.05   &lt;2e-16 ***
ORIGIN_hex1501 15.9617692  0.0028907  5521.76   &lt;2e-16 ***
ORIGIN_hex1502 15.0063441  0.0040042  3747.65   &lt;2e-16 ***
ORIGIN_hex1503 14.1620271  0.0073222  1934.13   &lt;2e-16 ***
ORIGIN_hex1504 14.4879201  0.0058491  2476.95   &lt;2e-16 ***
ORIGIN_hex1507 12.2192144  0.0396713   308.01   &lt;2e-16 ***
ORIGIN_hex1511 11.6537469  0.0431287   270.21   &lt;2e-16 ***
ORIGIN_hex1512 16.4152440  0.0038804  4230.28   &lt;2e-16 ***
ORIGIN_hex1513 12.7383251  0.0257354   494.97   &lt;2e-16 ***
ORIGIN_hex1514 11.5271067  0.0549782   209.67   &lt;2e-16 ***
ORIGIN_hex1516 16.4921933  0.0029356  5617.93   &lt;2e-16 ***
ORIGIN_hex1517 15.3979975  0.0059111  2604.91   &lt;2e-16 ***
ORIGIN_hex1522 11.5279805  0.1036995   111.17   &lt;2e-16 ***
ORIGIN_hex1524 16.0285779  0.0030507  5254.06   &lt;2e-16 ***
ORIGIN_hex1525 16.4276261  0.0021813  7531.09   &lt;2e-16 ***
ORIGIN_hex1526 13.6177627  0.0179695   757.83   &lt;2e-16 ***
ORIGIN_hex1528 15.6839814  0.0033971  4616.93   &lt;2e-16 ***
ORIGIN_hex1533 14.8352403  0.0075730  1958.96   &lt;2e-16 ***
ORIGIN_hex1535 14.2871771  0.0121527  1175.63   &lt;2e-16 ***
ORIGIN_hex1536 12.9805515  0.0196615   660.20   &lt;2e-16 ***
ORIGIN_hex1537 15.4671657  0.0050753  3047.51   &lt;2e-16 ***
ORIGIN_hex1538 15.2051672  0.0060205  2525.55   &lt;2e-16 ***
ORIGIN_hex1539 15.8873616  0.0041700  3809.96   &lt;2e-16 ***
ORIGIN_hex1547 14.3137414  0.0065359  2190.03   &lt;2e-16 ***
ORIGIN_hex1548 15.8984096  0.0028261  5625.62   &lt;2e-16 ***
ORIGIN_hex1549 15.1626952  0.0034971  4335.79   &lt;2e-16 ***
ORIGIN_hex1550 14.0367043  0.0061265  2291.14   &lt;2e-16 ***
ORIGIN_hex1551 14.6160974  0.0069584  2100.49   &lt;2e-16 ***
ORIGIN_hex1552 12.4370220  0.0333375   373.06   &lt;2e-16 ***
ORIGIN_hex1553  8.9971106  0.3333354    26.99   &lt;2e-16 ***
ORIGIN_hex1555 14.5694030  0.0074341  1959.81   &lt;2e-16 ***
ORIGIN_hex1556 15.1459000  0.0058132  2605.45   &lt;2e-16 ***
ORIGIN_hex1558 12.2953111  0.0556567   220.91   &lt;2e-16 ***
ORIGIN_hex1559 11.9695770  0.0359662   332.80   &lt;2e-16 ***
ORIGIN_hex1560 15.0898454  0.0072767  2073.72   &lt;2e-16 ***
ORIGIN_hex1561 17.1913245  0.0021585  7964.35   &lt;2e-16 ***
ORIGIN_hex1562 15.9082637  0.0042015  3786.34   &lt;2e-16 ***
ORIGIN_hex1563 13.3620043  0.0213131   626.94   &lt;2e-16 ***
ORIGIN_hex1570 15.0278805  0.0041142  3652.65   &lt;2e-16 ***
ORIGIN_hex1571 14.9815984  0.0040157  3730.78   &lt;2e-16 ***
ORIGIN_hex1572 13.9957821  0.0066040  2119.30   &lt;2e-16 ***
ORIGIN_hex1573 14.2289259  0.0068347  2081.88   &lt;2e-16 ***
ORIGIN_hex1574 13.5243561  0.0157078   861.00   &lt;2e-16 ***
ORIGIN_hex1577 15.4027653  0.0041027  3754.30   &lt;2e-16 ***
ORIGIN_hex1578 14.7558730  0.0064437  2289.97   &lt;2e-16 ***
ORIGIN_hex1579 14.4818296  0.0082450  1756.44   &lt;2e-16 ***
ORIGIN_hex1582 17.0384093  0.0022441  7592.69   &lt;2e-16 ***
ORIGIN_hex1583 16.1391634  0.0034228  4715.24   &lt;2e-16 ***
ORIGIN_hex1584 15.8477046  0.0041068  3858.92   &lt;2e-16 ***
ORIGIN_hex1585 16.9586169  0.0029705  5708.96   &lt;2e-16 ***
ORIGIN_hex1593 12.0012284  0.0491029   244.41   &lt;2e-16 ***
ORIGIN_hex1594 14.1430915  0.0130857  1080.81   &lt;2e-16 ***
ORIGIN_hex1595 12.9303944  0.0112638  1147.96   &lt;2e-16 ***
ORIGIN_hex1596 14.0675328  0.0059814  2351.87   &lt;2e-16 ***
ORIGIN_hex1597 14.6437495  0.0068383  2141.44   &lt;2e-16 ***
ORIGIN_hex1598 14.1079004  0.0081009  1741.52   &lt;2e-16 ***
ORIGIN_hex1599 14.7303597  0.0050856  2896.50   &lt;2e-16 ***
ORIGIN_hex1600 15.3606896  0.0039680  3871.12   &lt;2e-16 ***
ORIGIN_hex1601 15.5537010  0.0052368  2970.06   &lt;2e-16 ***
ORIGIN_hex1602 15.7545579  0.0046115  3416.35   &lt;2e-16 ***
ORIGIN_hex1603 13.8244718  0.0242919   569.10   &lt;2e-16 ***
ORIGIN_hex1605 14.4403814  0.0119499  1208.41   &lt;2e-16 ***
ORIGIN_hex1606 16.3942772  0.0026614  6160.00   &lt;2e-16 ***
ORIGIN_hex1607 16.9514848  0.0023781  7128.22   &lt;2e-16 ***
ORIGIN_hex1608 16.3428110  0.0049748  3285.11   &lt;2e-16 ***
ORIGIN_hex1609 14.5525696  0.0156259   931.31   &lt;2e-16 ***
ORIGIN_hex1616 14.9711144  0.0039464  3793.61   &lt;2e-16 ***
ORIGIN_hex1617 13.3763488  0.0091535  1461.34   &lt;2e-16 ***
ORIGIN_hex1618 14.2388041  0.0050420  2824.03   &lt;2e-16 ***
ORIGIN_hex1619 15.1023454  0.0037551  4021.78   &lt;2e-16 ***
ORIGIN_hex1621 13.9636701  0.0079057  1766.28   &lt;2e-16 ***
ORIGIN_hex1622 13.4395620  0.0095250  1410.98   &lt;2e-16 ***
ORIGIN_hex1623 14.9511059  0.0054759  2730.32   &lt;2e-16 ***
ORIGIN_hex1624 16.3322936  0.0028606  5709.45   &lt;2e-16 ***
ORIGIN_hex1625 16.3876316  0.0027990  5854.91   &lt;2e-16 ***
ORIGIN_hex1626 14.8350885  0.0074845  1982.12   &lt;2e-16 ***
ORIGIN_hex1628 16.7522172  0.0027788  6028.65   &lt;2e-16 ***
ORIGIN_hex1629 17.4692210  0.0017894  9762.44   &lt;2e-16 ***
ORIGIN_hex1630 16.4381043  0.0040779  4031.03   &lt;2e-16 ***
ORIGIN_hex1632 15.6719331  0.0134534  1164.90   &lt;2e-16 ***
ORIGIN_hex1639 13.3190579  0.0129986  1024.65   &lt;2e-16 ***
ORIGIN_hex1640 14.3228646  0.0049425  2897.90   &lt;2e-16 ***
ORIGIN_hex1641 13.3946245  0.0086405  1550.21   &lt;2e-16 ***
ORIGIN_hex1642 12.5497381  0.0309129   405.97   &lt;2e-16 ***
ORIGIN_hex1643 14.9280007  0.0041037  3637.68   &lt;2e-16 ***
ORIGIN_hex1644 16.0293515  0.0024464  6552.18   &lt;2e-16 ***
ORIGIN_hex1645 15.4774204  0.0041995  3685.55   &lt;2e-16 ***
ORIGIN_hex1646 15.0854158  0.0051543  2926.76   &lt;2e-16 ***
ORIGIN_hex1647 15.7085127  0.0032982  4762.69   &lt;2e-16 ***
ORIGIN_hex1648 15.7742766  0.0039581  3985.30   &lt;2e-16 ***
ORIGIN_hex1649 15.5038064  0.0042408  3655.86   &lt;2e-16 ***
ORIGIN_hex1652 17.2652168  0.0023021  7499.63   &lt;2e-16 ***
ORIGIN_hex1653 17.5364523  0.0021396  8196.32   &lt;2e-16 ***
ORIGIN_hex1662 13.3840990  0.0082900  1614.49   &lt;2e-16 ***
ORIGIN_hex1663 14.3976062  0.0045438  3168.63   &lt;2e-16 ***
ORIGIN_hex1664 14.4945268  0.0044614  3248.84   &lt;2e-16 ***
ORIGIN_hex1665 14.0378423  0.0065468  2144.22   &lt;2e-16 ***
ORIGIN_hex1666 15.1367775  0.0037276  4060.74   &lt;2e-16 ***
ORIGIN_hex1667 16.6437951  0.0019578  8501.41   &lt;2e-16 ***
ORIGIN_hex1668 14.1927236  0.0065548  2165.24   &lt;2e-16 ***
ORIGIN_hex1669 16.7848734  0.0022978  7304.80   &lt;2e-16 ***
ORIGIN_hex1670 16.4854131  0.0022263  7404.94   &lt;2e-16 ***
ORIGIN_hex1671 17.0972991  0.0020287  8427.66   &lt;2e-16 ***
ORIGIN_hex1672 13.7189112  0.0126292  1086.29   &lt;2e-16 ***
ORIGIN_hex1674 16.9684478  0.0027772  6110.00   &lt;2e-16 ***
ORIGIN_hex1675 17.3642170  0.0022284  7792.15   &lt;2e-16 ***
ORIGIN_hex1686 13.0838097  0.0086244  1517.06   &lt;2e-16 ***
ORIGIN_hex1687 13.3124301  0.0080788  1647.83   &lt;2e-16 ***
ORIGIN_hex1688 15.2288911  0.0034641  4396.15   &lt;2e-16 ***
ORIGIN_hex1689 14.9288845  0.0045386  3289.30   &lt;2e-16 ***
ORIGIN_hex1690 15.0258823  0.0043810  3429.76   &lt;2e-16 ***
ORIGIN_hex1691 15.9538842  0.0027633  5773.49   &lt;2e-16 ***
ORIGIN_hex1692 16.1530931  0.0025663  6294.33   &lt;2e-16 ***
ORIGIN_hex1693 15.7651726  0.0040787  3865.24   &lt;2e-16 ***
ORIGIN_hex1694 15.5687228  0.0035670  4364.70   &lt;2e-16 ***
ORIGIN_hex1695 13.4435689  0.0144744   928.78   &lt;2e-16 ***
ORIGIN_hex1698 16.4769055  0.0035336  4662.93   &lt;2e-16 ***
ORIGIN_hex1699 16.4865792  0.0045347  3635.67   &lt;2e-16 ***
ORIGIN_hex1709 12.3048834  0.0193693   635.28   &lt;2e-16 ***
ORIGIN_hex1710 13.7442713  0.0057857  2375.55   &lt;2e-16 ***
ORIGIN_hex1711 14.2116954  0.0080235  1771.26   &lt;2e-16 ***
ORIGIN_hex1712 15.8025200  0.0028791  5488.64   &lt;2e-16 ***
ORIGIN_hex1713 15.8897257  0.0027179  5846.28   &lt;2e-16 ***
ORIGIN_hex1714 15.8213213  0.0028961  5463.03   &lt;2e-16 ***
ORIGIN_hex1715 15.2931770  0.0039314  3889.96   &lt;2e-16 ***
ORIGIN_hex1716 16.9995953  0.0018702  9089.60   &lt;2e-16 ***
ORIGIN_hex1718 14.5948934  0.0080757  1807.26   &lt;2e-16 ***
ORIGIN_hex1721 17.0390466  0.0031240  5454.26   &lt;2e-16 ***
ORIGIN_hex1732 12.3346115  0.0188906   652.95   &lt;2e-16 ***
ORIGIN_hex1733 12.4853009  0.0120466  1036.41   &lt;2e-16 ***
ORIGIN_hex1734 13.9314985  0.0056233  2477.47   &lt;2e-16 ***
ORIGIN_hex1735 14.9259312  0.0042715  3494.34   &lt;2e-16 ***
ORIGIN_hex1736 15.5630321  0.0035835  4342.92   &lt;2e-16 ***
ORIGIN_hex1737 16.0708907  0.0026326  6104.61   &lt;2e-16 ***
ORIGIN_hex1738 15.3001778  0.0055905  2736.82   &lt;2e-16 ***
ORIGIN_hex1739 16.5492581  0.0023806  6951.78   &lt;2e-16 ***
ORIGIN_hex1740 16.3799489  0.0029186  5612.20   &lt;2e-16 ***
ORIGIN_hex1744 15.8227552  0.0077464  2042.60   &lt;2e-16 ***
ORIGIN_hex1755 10.9835727  0.0437018   251.33   &lt;2e-16 ***
ORIGIN_hex1756 13.7658363  0.0060939  2258.96   &lt;2e-16 ***
ORIGIN_hex1757 13.5372841  0.0085019  1592.27   &lt;2e-16 ***
ORIGIN_hex1758 14.9329305  0.0059213  2521.91   &lt;2e-16 ***
ORIGIN_hex1759 17.0427895  0.0025085  6793.95   &lt;2e-16 ***
ORIGIN_hex1760 15.5119300  0.0036975  4195.30   &lt;2e-16 ***
ORIGIN_hex1761 14.6387843  0.0178991   817.85   &lt;2e-16 ***
ORIGIN_hex1762 16.8053384  0.0021859  7688.17   &lt;2e-16 ***
ORIGIN_hex1764 15.0768544  0.0064643  2332.32   &lt;2e-16 ***
ORIGIN_hex1765 12.8306697  0.0300664   426.75   &lt;2e-16 ***
ORIGIN_hex1767 14.3664145  0.0133747  1074.15   &lt;2e-16 ***
ORIGIN_hex1777 12.2091058  0.0464358   262.93   &lt;2e-16 ***
ORIGIN_hex1778 12.1030151  0.0275083   439.98   &lt;2e-16 ***
ORIGIN_hex1779 12.5646892  0.0173727   723.25   &lt;2e-16 ***
ORIGIN_hex1780 14.4046173  0.0046445  3101.42   &lt;2e-16 ***
ORIGIN_hex1781 14.5618499  0.0046131  3156.65   &lt;2e-16 ***
ORIGIN_hex1782 15.8710505  0.0028605  5548.35   &lt;2e-16 ***
ORIGIN_hex1783 15.6787655  0.0068356  2293.70   &lt;2e-16 ***
ORIGIN_hex1784 14.6018292  0.0056661  2577.07   &lt;2e-16 ***
ORIGIN_hex1785 14.4636039  0.0112114  1290.08   &lt;2e-16 ***
ORIGIN_hex1786 14.2362214  0.0083498  1704.97   &lt;2e-16 ***
ORIGIN_hex1787 13.3965650  0.0235506   568.84   &lt;2e-16 ***
ORIGIN_hex1789 11.1701519  0.0737296   151.50   &lt;2e-16 ***
ORIGIN_hex1790 12.9148260  0.0267230   483.29   &lt;2e-16 ***
ORIGIN_hex1802 14.2636493  0.0077616  1837.71   &lt;2e-16 ***
ORIGIN_hex1803 13.9227761  0.0060143  2314.94   &lt;2e-16 ***
ORIGIN_hex1804 16.5798026  0.0020863  7946.81   &lt;2e-16 ***
ORIGIN_hex1805 16.6661489  0.0042688  3904.14   &lt;2e-16 ***
ORIGIN_hex1806 13.8191814  0.0097941  1410.97   &lt;2e-16 ***
ORIGIN_hex1807 14.7228645  0.0052614  2798.28   &lt;2e-16 ***
ORIGIN_hex1808 14.6593761  0.0060011  2442.77   &lt;2e-16 ***
ORIGIN_hex1809 14.5149749  0.0080955  1792.96   &lt;2e-16 ***
ORIGIN_hex1810 13.2813240  0.0153758   863.78   &lt;2e-16 ***
ORIGIN_hex1811 11.8744392  0.0403728   294.12   &lt;2e-16 ***
ORIGIN_hex1812 10.7210577  0.0905428   118.41   &lt;2e-16 ***
ORIGIN_hex1826 11.6450085  0.0464405   250.75   &lt;2e-16 ***
ORIGIN_hex1827 12.9236824  0.0120883  1069.11   &lt;2e-16 ***
ORIGIN_hex1828 16.3929363  0.0021904  7484.10   &lt;2e-16 ***
ORIGIN_hex1829 15.8826133  0.0032186  4934.58   &lt;2e-16 ***
ORIGIN_hex1830 16.0019138  0.0028165  5681.45   &lt;2e-16 ***
ORIGIN_hex1831 15.3221080  0.0047878  3200.25   &lt;2e-16 ***
ORIGIN_hex1832 14.4120329  0.0092300  1561.43   &lt;2e-16 ***
ORIGIN_hex1833 15.3242903  0.0048566  3155.37   &lt;2e-16 ***
ORIGIN_hex1835 12.4033536  0.0284206   436.42   &lt;2e-16 ***
ORIGIN_hex1836 11.7151935  0.0595614   196.69   &lt;2e-16 ***
ORIGIN_hex1848 15.5803057  0.0065765  2369.10   &lt;2e-16 ***
ORIGIN_hex1849 15.7742531  0.0026405  5973.87   &lt;2e-16 ***
ORIGIN_hex1850 15.3069117  0.0038867  3938.27   &lt;2e-16 ***
ORIGIN_hex1851 15.4944931  0.0042451  3649.98   &lt;2e-16 ***
ORIGIN_hex1852 14.6528875  0.0054294  2698.82   &lt;2e-16 ***
ORIGIN_hex1853 16.0490229  0.0027128  5915.93   &lt;2e-16 ***
ORIGIN_hex1854 16.5281306  0.0025842  6395.79   &lt;2e-16 ***
ORIGIN_hex1855 14.8453300  0.0065458  2267.91   &lt;2e-16 ***
ORIGIN_hex1856 16.6822290  0.0026860  6210.90   &lt;2e-16 ***
ORIGIN_hex1857 16.3645973  0.0033407  4898.57   &lt;2e-16 ***
ORIGIN_hex1858 13.2184397  0.0328652   402.20   &lt;2e-16 ***
ORIGIN_hex1872 13.5400996  0.0111383  1215.63   &lt;2e-16 ***
ORIGIN_hex1873 14.9747080  0.0044635  3354.94   &lt;2e-16 ***
ORIGIN_hex1874 14.1926508  0.0067352  2107.23   &lt;2e-16 ***
ORIGIN_hex1875 14.8479952  0.0078230  1897.98   &lt;2e-16 ***
ORIGIN_hex1876 16.6095096  0.0020881  7954.26   &lt;2e-16 ***
ORIGIN_hex1877 15.5997112  0.0034136  4569.87   &lt;2e-16 ***
ORIGIN_hex1878 16.8165825  0.0022098  7610.09   &lt;2e-16 ***
ORIGIN_hex1879 15.5798728  0.0045112  3453.56   &lt;2e-16 ***
ORIGIN_hex1880 15.8011263  0.0044020  3589.51   &lt;2e-16 ***
ORIGIN_hex1881 12.0871506  0.0498888   242.28   &lt;2e-16 ***
ORIGIN_hex1894 11.2077952  0.0562651   199.20   &lt;2e-16 ***
ORIGIN_hex1895 15.8696810  0.0026533  5981.18   &lt;2e-16 ***
ORIGIN_hex1896 14.3882784  0.0059613  2413.62   &lt;2e-16 ***
ORIGIN_hex1897 15.7593201  0.0030366  5189.81   &lt;2e-16 ***
ORIGIN_hex1898 14.8949545  0.0046299  3217.12   &lt;2e-16 ***
ORIGIN_hex1899 14.6571088  0.0076100  1926.04   &lt;2e-16 ***
ORIGIN_hex1900 16.1075872  0.0027372  5884.64   &lt;2e-16 ***
ORIGIN_hex1901 16.4071425  0.0025684  6388.05   &lt;2e-16 ***
ORIGIN_hex1902 16.2908954  0.0033179  4910.01   &lt;2e-16 ***
ORIGIN_hex1918 15.1440555  0.0044462  3406.09   &lt;2e-16 ***
ORIGIN_hex1919 16.1920447  0.0023980  6752.35   &lt;2e-16 ***
ORIGIN_hex1920 15.2621196  0.0036466  4185.35   &lt;2e-16 ***
ORIGIN_hex1921 13.6261455  0.0088673  1536.67   &lt;2e-16 ***
ORIGIN_hex1922 15.6763021  0.0033157  4727.94   &lt;2e-16 ***
ORIGIN_hex1924 17.0104431  0.0021861  7781.05   &lt;2e-16 ***
ORIGIN_hex1925 16.9438485  0.0035926  4716.36   &lt;2e-16 ***
ORIGIN_hex1926 16.1038289  0.0044635  3607.91   &lt;2e-16 ***
ORIGIN_hex1940 14.9534977  0.0053527  2793.66   &lt;2e-16 ***
ORIGIN_hex1941 15.9602300  0.0026857  5942.76   &lt;2e-16 ***
ORIGIN_hex1942 15.1478705  0.0039144  3869.76   &lt;2e-16 ***
ORIGIN_hex1943 15.3980694  0.0034141  4510.15   &lt;2e-16 ***
ORIGIN_hex1944 13.7498136  0.0090945  1511.88   &lt;2e-16 ***
ORIGIN_hex1945 15.8172574  0.0032093  4928.63   &lt;2e-16 ***
ORIGIN_hex1946 16.0388451  0.0028861  5557.37   &lt;2e-16 ***
ORIGIN_hex1947 16.2553919  0.0028982  5608.84   &lt;2e-16 ***
ORIGIN_hex1948 16.7072517  0.0027548  6064.75   &lt;2e-16 ***
ORIGIN_hex1965 15.2004505  0.0037147  4092.01   &lt;2e-16 ***
ORIGIN_hex1966 15.8845305  0.0027094  5862.72   &lt;2e-16 ***
ORIGIN_hex1967 14.7081315  0.0047629  3088.06   &lt;2e-16 ***
ORIGIN_hex1968 16.4259780  0.0025198  6518.87   &lt;2e-16 ***
ORIGIN_hex1969 16.1382065  0.0027995  5764.69   &lt;2e-16 ***
ORIGIN_hex1970 16.4952846  0.0023545  7005.96   &lt;2e-16 ***
ORIGIN_hex1971 15.6058968  0.0042469  3674.63   &lt;2e-16 ***
ORIGIN_hex1972 16.1143076  0.0044480  3622.85   &lt;2e-16 ***
ORIGIN_hex1986 14.0408170  0.0102702  1367.14   &lt;2e-16 ***
ORIGIN_hex1987 15.1792693  0.0040372  3759.86   &lt;2e-16 ***
ORIGIN_hex1988 15.7598428  0.0029696  5307.00   &lt;2e-16 ***
ORIGIN_hex1989 14.5148955  0.0055512  2614.71   &lt;2e-16 ***
ORIGIN_hex1990 13.4008334  0.0120979  1107.70   &lt;2e-16 ***
ORIGIN_hex1991 15.7759269  0.0033790  4668.84   &lt;2e-16 ***
ORIGIN_hex1992 16.7792116  0.0019950  8410.63   &lt;2e-16 ***
ORIGIN_hex1993 16.3478658  0.0029231  5592.59   &lt;2e-16 ***
ORIGIN_hex1994 16.3095119  0.0027895  5846.66   &lt;2e-16 ***
ORIGIN_hex1995 17.0114591  0.0039999  4252.95   &lt;2e-16 ***
ORIGIN_hex2010 14.9400693  0.0048928  3053.48   &lt;2e-16 ***
ORIGIN_hex2011 15.5202859  0.0030695  5056.22   &lt;2e-16 ***
ORIGIN_hex2012 14.2022377  0.0069433  2045.47   &lt;2e-16 ***
ORIGIN_hex2013 14.1772843  0.0075930  1867.14   &lt;2e-16 ***
ORIGIN_hex2014 12.3902020  0.0429304   288.61   &lt;2e-16 ***
ORIGIN_hex2015 16.4670381  0.0024960  6597.30   &lt;2e-16 ***
ORIGIN_hex2016 16.3802269  0.0024933  6569.66   &lt;2e-16 ***
ORIGIN_hex2017 16.5787072  0.0024634  6729.90   &lt;2e-16 ***
ORIGIN_hex2018 15.8674346  0.0039204  4047.40   &lt;2e-16 ***
ORIGIN_hex2019 15.9301774  0.0059823  2662.90   &lt;2e-16 ***
ORIGIN_hex2032 13.3759749  0.0174110   768.25   &lt;2e-16 ***
ORIGIN_hex2033 15.4148959  0.0052046  2961.76   &lt;2e-16 ***
ORIGIN_hex2035 15.4179329  0.0037051  4161.32   &lt;2e-16 ***
ORIGIN_hex2036 14.3551949  0.0127194  1128.60   &lt;2e-16 ***
ORIGIN_hex2038 16.1520636  0.0035284  4577.76   &lt;2e-16 ***
ORIGIN_hex2039 16.0068488  0.0032476  4928.82   &lt;2e-16 ***
ORIGIN_hex2040 16.7769657  0.0022157  7571.86   &lt;2e-16 ***
ORIGIN_hex2041 17.0965192  0.0022577  7572.42   &lt;2e-16 ***
ORIGIN_hex2042 14.3896257  0.0167428   859.45   &lt;2e-16 ***
ORIGIN_hex2056 15.4656188  0.0035634  4340.08   &lt;2e-16 ***
ORIGIN_hex2057 16.0039083  0.0026316  6081.44   &lt;2e-16 ***
ORIGIN_hex2058 16.5615004  0.0021514  7697.92   &lt;2e-16 ***
ORIGIN_hex2059 14.1366118  0.0126395  1118.44   &lt;2e-16 ***
ORIGIN_hex2060 13.8982478  0.0194731   713.72   &lt;2e-16 ***
ORIGIN_hex2061 12.8831974  0.0215185   598.71   &lt;2e-16 ***
ORIGIN_hex2062 16.2491691  0.0034205  4750.57   &lt;2e-16 ***
ORIGIN_hex2063 16.4381168  0.0026684  6160.28   &lt;2e-16 ***
ORIGIN_hex2064 16.8115574  0.0024087  6979.59   &lt;2e-16 ***
ORIGIN_hex2065 14.7661102  0.0096617  1528.32   &lt;2e-16 ***
ORIGIN_hex2079 14.9782796  0.0044569  3360.68   &lt;2e-16 ***
ORIGIN_hex2080 16.1700629  0.0026248  6160.49   &lt;2e-16 ***
ORIGIN_hex2081 15.6644606  0.0035870  4367.05   &lt;2e-16 ***
ORIGIN_hex2085 15.9583452  0.0040560  3934.52   &lt;2e-16 ***
ORIGIN_hex2086 17.4996690  0.0018455  9482.57   &lt;2e-16 ***
ORIGIN_hex2087 16.9276555  0.0022429  7547.35   &lt;2e-16 ***
ORIGIN_hex2088 16.2279544  0.0059466  2728.94   &lt;2e-16 ***
ORIGIN_hex2102 15.9137065  0.0029015  5484.57   &lt;2e-16 ***
ORIGIN_hex2103 15.3601228  0.0037992  4042.95   &lt;2e-16 ***
ORIGIN_hex2104 14.8665955  0.0124332  1195.71   &lt;2e-16 ***
ORIGIN_hex2105 13.1494681  0.0203423   646.41   &lt;2e-16 ***
ORIGIN_hex2107 13.6095658  0.0235683   577.45   &lt;2e-16 ***
ORIGIN_hex2109 16.2230540  0.0036715  4418.70   &lt;2e-16 ***
ORIGIN_hex2110 16.1560131  0.0033241  4860.33   &lt;2e-16 ***
ORIGIN_hex2111 13.7017484  0.0217892   628.83   &lt;2e-16 ***
ORIGIN_hex2112 12.9837149  0.0581357   223.34   &lt;2e-16 ***
ORIGIN_hex2125 15.1710176  0.0042537  3566.58   &lt;2e-16 ***
ORIGIN_hex2126 15.7515170  0.0032816  4800.02   &lt;2e-16 ***
ORIGIN_hex2127 16.7638728  0.0023238  7214.13   &lt;2e-16 ***
ORIGIN_hex2130 14.2630344  0.0141680  1006.71   &lt;2e-16 ***
ORIGIN_hex2131  9.9656264  0.3015133    33.05   &lt;2e-16 ***
ORIGIN_hex2132 15.6217171  0.0044487  3511.49   &lt;2e-16 ***
ORIGIN_hex2133 16.4308126  0.0040535  4053.51   &lt;2e-16 ***
ORIGIN_hex2134 11.8657049  0.0971344   122.16   &lt;2e-16 ***
ORIGIN_hex2148 15.8963424  0.0033049  4809.88   &lt;2e-16 ***
ORIGIN_hex2149 13.7377893  0.0127170  1080.27   &lt;2e-16 ***
ORIGIN_hex2150 15.4818623  0.0071581  2162.84   &lt;2e-16 ***
ORIGIN_hex2151 15.1966821  0.0044586  3408.39   &lt;2e-16 ***
ORIGIN_hex2154 11.2057551  0.0848265   132.10   &lt;2e-16 ***
ORIGIN_hex2156 16.1859310  0.0038080  4250.48   &lt;2e-16 ***
ORIGIN_hex2171 15.1359764  0.0042883  3529.59   &lt;2e-16 ***
ORIGIN_hex2172 14.9399644  0.0049959  2990.45   &lt;2e-16 ***
ORIGIN_hex2173 15.7530462  0.0039170  4021.67   &lt;2e-16 ***
ORIGIN_hex2174 14.0413271  0.0119557  1174.44   &lt;2e-16 ***
ORIGIN_hex2177 12.6953573  0.0373886   339.55   &lt;2e-16 ***
ORIGIN_hex2178 14.9832081  0.0074143  2020.84   &lt;2e-16 ***
ORIGIN_hex2179 16.1806975  0.0065939  2453.89   &lt;2e-16 ***
ORIGIN_hex2195 14.5012490  0.0085266  1700.70   &lt;2e-16 ***
ORIGIN_hex2196 16.6215135  0.0026459  6281.90   &lt;2e-16 ***
ORIGIN_hex2197 16.2581759  0.0033299  4882.44   &lt;2e-16 ***
ORIGIN_hex2200 14.0166258  0.0162114   864.61   &lt;2e-16 ***
ORIGIN_hex2202 16.1065268  0.0070074  2298.49   &lt;2e-16 ***
ORIGIN_hex2217 15.2705634  0.0041892  3645.26   &lt;2e-16 ***
ORIGIN_hex2218 16.3142940  0.0024388  6689.36   &lt;2e-16 ***
ORIGIN_hex2219 16.5294380  0.0034031  4857.19   &lt;2e-16 ***
ORIGIN_hex2221 10.1729654  0.3015136    33.74   &lt;2e-16 ***
ORIGIN_hex2222 12.8529568  0.0267595   480.31   &lt;2e-16 ***
ORIGIN_hex2241 14.5574023  0.0062755  2319.72   &lt;2e-16 ***
ORIGIN_hex2242 16.6603386  0.0020852  7989.66   &lt;2e-16 ***
ORIGIN_hex2243 15.2738379  0.0052387  2915.57   &lt;2e-16 ***
ORIGIN_hex2244 16.7043859  0.0025964  6433.56   &lt;2e-16 ***
ORIGIN_hex2245 15.1842609  0.0055801  2721.14   &lt;2e-16 ***
ORIGIN_hex2246 15.4610754  0.0054492  2837.29   &lt;2e-16 ***
ORIGIN_hex2263 15.2992358  0.0046854  3265.27   &lt;2e-16 ***
ORIGIN_hex2264 16.2942786  0.0025121  6486.20   &lt;2e-16 ***
ORIGIN_hex2265 16.7139703  0.0022661  7375.61   &lt;2e-16 ***
ORIGIN_hex2266 15.6341543  0.0043869  3563.82   &lt;2e-16 ***
ORIGIN_hex2267 16.7193327  0.0025085  6665.19   &lt;2e-16 ***
ORIGIN_hex2268 15.4354748  0.0049534  3116.16   &lt;2e-16 ***
ORIGIN_hex2269 16.0361696  0.0036542  4388.45   &lt;2e-16 ***
ORIGIN_hex2287 15.2611656  0.0043280  3526.13   &lt;2e-16 ***
ORIGIN_hex2288 16.3146884  0.0025426  6416.51   &lt;2e-16 ***
ORIGIN_hex2289 15.2848377  0.0044383  3443.82   &lt;2e-16 ***
ORIGIN_hex2290 16.5891041  0.0027361  6062.95   &lt;2e-16 ***
ORIGIN_hex2291 16.5450371  0.0027966  5916.12   &lt;2e-16 ***
ORIGIN_hex2292 16.3896091  0.0031531  5197.88   &lt;2e-16 ***
ORIGIN_hex2293 14.3865864  0.0104741  1373.54   &lt;2e-16 ***
ORIGIN_hex2310 16.0536532  0.0030189  5317.75   &lt;2e-16 ***
ORIGIN_hex2311 16.3300515  0.0030587  5338.81   &lt;2e-16 ***
ORIGIN_hex2312 16.0560810  0.0028508  5632.04   &lt;2e-16 ***
ORIGIN_hex2313 16.5835517  0.0025239  6570.69   &lt;2e-16 ***
ORIGIN_hex2314 15.8780983  0.0048137  3298.49   &lt;2e-16 ***
ORIGIN_hex2315 16.4991701  0.0030226  5458.51   &lt;2e-16 ***
ORIGIN_hex2333 15.4426495  0.0043425  3556.19   &lt;2e-16 ***
ORIGIN_hex2334 16.4089017  0.0026106  6285.52   &lt;2e-16 ***
ORIGIN_hex2335 13.1424595  0.0201693   651.61   &lt;2e-16 ***
ORIGIN_hex2336 17.1493434  0.0017769  9651.37   &lt;2e-16 ***
ORIGIN_hex2337 16.3534023  0.0030179  5418.74   &lt;2e-16 ***
ORIGIN_hex2338 16.8512508  0.0024884  6771.94   &lt;2e-16 ***
ORIGIN_hex2339 14.2139039  0.0268693   529.00   &lt;2e-16 ***
ORIGIN_hex2356 16.0680173  0.0033690  4769.36   &lt;2e-16 ***
ORIGIN_hex2357 14.5052985  0.0073218  1981.11   &lt;2e-16 ***
ORIGIN_hex2358 15.4111982  0.0039185  3932.94   &lt;2e-16 ***
ORIGIN_hex2359 16.5972385  0.0022671  7320.99   &lt;2e-16 ***
ORIGIN_hex2360 14.8128192  0.0073703  2009.80   &lt;2e-16 ***
ORIGIN_hex2361 15.5328544  0.0050405  3081.58   &lt;2e-16 ***
ORIGIN_hex2379 14.9760137  0.0059951  2498.05   &lt;2e-16 ***
ORIGIN_hex2380 16.5723767  0.0025107  6600.68   &lt;2e-16 ***
ORIGIN_hex2381 15.5630162  0.0036898  4217.80   &lt;2e-16 ***
ORIGIN_hex2382 16.1738807  0.0027632  5853.30   &lt;2e-16 ***
ORIGIN_hex2383 15.7750397  0.0043125  3657.94   &lt;2e-16 ***
ORIGIN_hex2384 16.7235628  0.0023160  7220.85   &lt;2e-16 ***
ORIGIN_hex2401 12.7812572  0.0686930   186.06   &lt;2e-16 ***
ORIGIN_hex2402 15.1974678  0.0065066  2335.70   &lt;2e-16 ***
ORIGIN_hex2403 14.4506877  0.0066026  2188.62   &lt;2e-16 ***
ORIGIN_hex2404 16.0273043  0.0032280  4965.11   &lt;2e-16 ***
ORIGIN_hex2405 16.5553929  0.0023227  7127.69   &lt;2e-16 ***
ORIGIN_hex2406 16.4144972  0.0031323  5240.43   &lt;2e-16 ***
ORIGIN_hex2427 14.8277953  0.0059053  2510.93   &lt;2e-16 ***
ORIGIN_hex2428 16.3143247  0.0026655  6120.54   &lt;2e-16 ***
ORIGIN_hex2429 16.2672127  0.0027607  5892.33   &lt;2e-16 ***
ORIGIN_hex2430 16.6743632  0.0026430  6308.92   &lt;2e-16 ***
ORIGIN_hex2449 15.4630896  0.0044413  3481.66   &lt;2e-16 ***
ORIGIN_hex2450 15.9080882  0.0033964  4683.87   &lt;2e-16 ***
ORIGIN_hex2451 16.5939790  0.0023841  6960.17   &lt;2e-16 ***
ORIGIN_hex2452 16.4667274  0.0027007  6097.18   &lt;2e-16 ***
ORIGIN_hex2453 16.6507613  0.0055592  2995.18   &lt;2e-16 ***
ORIGIN_hex2472 13.1217536  0.0315025   416.53   &lt;2e-16 ***
ORIGIN_hex2473 15.1455242  0.0050780  2982.60   &lt;2e-16 ***
ORIGIN_hex2474 15.6894907  0.0040850  3840.79   &lt;2e-16 ***
ORIGIN_hex2475 16.2826793  0.0028767  5660.16   &lt;2e-16 ***
ORIGIN_hex2476 16.4279631  0.0031432  5226.49   &lt;2e-16 ***
ORIGIN_hex2495 12.8555799  0.0191177   672.45   &lt;2e-16 ***
ORIGIN_hex2496 14.8228295  0.0068538  2162.73   &lt;2e-16 ***
ORIGIN_hex2497 16.5349081  0.0032064  5156.86   &lt;2e-16 ***
ORIGIN_hex2498 15.5859916  0.0044172  3528.49   &lt;2e-16 ***
ORIGIN_hex2499 15.2362066  0.0123632  1232.38   &lt;2e-16 ***
ORIGIN_hex2518 12.7555118  0.0439956   289.93   &lt;2e-16 ***
ORIGIN_hex2519 11.5124090  0.0492210   233.89   &lt;2e-16 ***
ORIGIN_hex2520 13.8704148  0.0152153   911.61   &lt;2e-16 ***
ORIGIN_hex2521 14.4097037  0.0088256  1632.72   &lt;2e-16 ***
ORIGIN_hex2522 15.0444840  0.0061265  2455.64   &lt;2e-16 ***
ORIGIN_hex2523 12.8192037  0.0407398   314.66   &lt;2e-16 ***
ORIGIN_hex2541 13.0697016  0.0240038   544.48   &lt;2e-16 ***
ORIGIN_hex2542 14.7161248  0.0125443  1173.13   &lt;2e-16 ***
ORIGIN_hex2543 13.9579213  0.0142801   977.44   &lt;2e-16 ***
ORIGIN_hex2544 14.6381282  0.0083722  1748.42   &lt;2e-16 ***
ORIGIN_hex2545 13.1731802  0.0230090   572.52   &lt;2e-16 ***
ORIGIN_hex2567 14.3186136  0.0115691  1237.66   &lt;2e-16 ***
ORIGIN_hex2568 13.9755161  0.0102538  1362.95   &lt;2e-16 ***
ORIGIN_hex2569 13.3860216  0.0150432   889.84   &lt;2e-16 ***
ORIGIN_hex2590 14.7019628  0.0098924  1486.19   &lt;2e-16 ***
ORIGIN_hex2591 12.7640239  0.0213531   597.76   &lt;2e-16 ***
ORIGIN_hex2592 13.0312633  0.0304495   427.96   &lt;2e-16 ***
ORIGIN_hex2611 15.8607308  0.0053750  2950.85   &lt;2e-16 ***
ORIGIN_hex2615 14.4758066  0.0093779  1543.61   &lt;2e-16 ***
ORIGIN_hex2634 14.1237592  0.0130463  1082.59   &lt;2e-16 ***
ORIGIN_hex2635 16.1389851  0.0043826  3682.53   &lt;2e-16 ***
ORIGIN_hex2638 15.0486392  0.0083776  1796.30   &lt;2e-16 ***
ORIGIN_hex2655 16.3903533  0.0093873  1746.01   &lt;2e-16 ***
ORIGIN_hex2659 15.9861441  0.0057870  2762.44   &lt;2e-16 ***
ORIGIN_hex2661 15.2504243  0.0084398  1806.96   &lt;2e-16 ***
ORIGIN_hex2684 11.0326069  0.0737297   149.64   &lt;2e-16 ***
ORIGIN_hex2701 15.9599291  0.0113752  1403.04   &lt;2e-16 ***
ORIGIN_hex2706 15.6399027  0.0070253  2226.23   &lt;2e-16 ***
ORIGIN_hex2707 15.7490278  0.0062600  2515.83   &lt;2e-16 ***
ORIGIN_hex2729 14.5213356  0.0112439  1291.49   &lt;2e-16 ***
ORIGIN_hex2752 14.7293378  0.0154731   951.93   &lt;2e-16 ***
ORIGIN_hex2774 12.2722097  0.0916764   133.86   &lt;2e-16 ***
ORIGIN_hex2820 14.4664500  0.0440435   328.46   &lt;2e-16 ***
ORIGIN_hex2839 15.5100601  0.0195845   791.96   &lt;2e-16 ***
ORIGIN_hex2934 13.7315078  0.0555698   247.10   &lt;2e-16 ***
biz_count       0.0966665  0.0001184   816.44   &lt;2e-16 ***
school_count   -0.1015326  0.0004531  -224.11   &lt;2e-16 ***
fin_count       0.3251755  0.0001594  2040.23   &lt;2e-16 ***
hc_count        0.0598109  0.0002358   253.66   &lt;2e-16 ***
busstop_count   0.2550797  0.0003045   837.68   &lt;2e-16 ***
dist           -1.2831269  0.0001397 -9186.97   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 933854533  on 65780  degrees of freedom
Residual deviance: 105949622  on 64956  degrees of freedom
AIC: 106354372

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Destination Constrained Model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the formula dynamically</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>formula_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"TOTAL_TRIPS ~ DESTIN_hex +"</span>, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(destin_var, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ dist - 1"</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the string to a formula</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_string)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>decSIM <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula,</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> flow_data_log,</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">na.action =</span> na.exclude)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(decSIM, <span class="st">"data/rds/decSIM.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>decSIM <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/decSIM.rds"</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(decSIM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Doubly Constrained Model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>dbcSIM <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> TOTAL_TRIPS <span class="sc">~</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                ORIGIN_hex <span class="sc">+</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                DESTIN_hex <span class="sc">+</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                dist,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> flow_data_log,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">na.action =</span> na.exclude)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(dbcSIM, <span class="st">"data/rds/dbcSIM.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>dbcSIM <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/decSIM.rds"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dbcSIM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="spatial-econometric-interaction-modelling-1" class="level2">
<h2 class="anchored" data-anchor-id="spatial-econometric-interaction-modelling-1">7.2 Spatial Econometric Interaction Modelling</h2>
<p>Spatial Econometric Interaction Models extend the traditional SIM by considering econometric matters. It addresses the limitation of SIM which assumes there is independence across observations. SEIM addresses the spatial dependencies across observations and acknowledge that nearby locations might influence each other’s behaviour or out comes. Additionally, SEIM handles spatial autocorrelation more effectively and addresses multicollinearity.</p>
<p>Three data sets are needed to calibrate SEIM using <strong>spflow</strong> package:</p>
<ul>
<li><p>Spatial Weights</p></li>
<li><p>Distance Matrix</p></li>
<li><p>Explanatory Variables</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preparing Spatial Weights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The connectivity between traffic analytical zones can be described using contiguity, fixed distance and adaptive distance matrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> hex_sg2 <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bus_count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geometry) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>))</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    750     750     750     753     750    3269 </code></pre>
</div>
</div>
<section id="interpreting-summary-report" class="level3 {callout-tip}">
<h3 class="anchored" data-anchor-id="interpreting-summary-report">Interpreting Summary Report</h3>
<p>The largest first nearest neighbour distance is 3269m and it will be used as the upper threshold such that all k neighbours have at least one neighbour.</p>
</section>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Computing Spatial Weights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>({</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_point_on_surface</span>(<span class="fu">st_geometry</span>(hex_sg2))})</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>hexgrid_nb <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_contiguity"</span> <span class="ot">=</span> <span class="fu">poly2nb</span>(hex_sg2),</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_distance"</span> <span class="ot">=</span> <span class="fu">dnearneigh</span>(centroids, </span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="dv">3269</span>),</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_knn"</span> <span class="ot">=</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(centroids, <span class="dv">6</span>))</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>hexgrid_nb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$by_contiguity
Neighbour list object:
Number of regions: 2375 
Number of nonzero links: 13850 
Percentage nonzero weights: 0.2455402 
Average number of links: 5.831579 

$by_distance
Neighbour list object:
Number of regions: 2375 
Number of nonzero links: 131154 
Percentage nonzero weights: 2.325168 
Average number of links: 55.22274 

$by_knn
Neighbour list object:
Number of regions: 2375 
Number of nonzero links: 14250 
Percentage nonzero weights: 0.2526316 
Average number of links: 6 
Non-symmetric neighbours list</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prepare Flow Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>flow_data1 <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_hex, DESTIN_hex) <span class="sc">%&gt;%</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TOTAL_TRIPS =</span> <span class="fu">sum</span>(TOTAL_TRIPS), <span class="at">dist =</span> <span class="fu">first</span>(dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prepare Explanatory Variables
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>explanatory <span class="ot">&lt;-</span> hex_sg2 <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Create spflow_network-class objects
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>hex_net <span class="ot">&lt;-</span> <span class="fu">spflow_network</span>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_net =</span> <span class="st">"sg"</span>,  <span class="co"># assign an id name, can give it any input</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_neighborhood =</span> <span class="fu">nb2mat</span>(hexgrid_nb<span class="sc">$</span>by_distance),</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_data =</span> explanatory,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_key_column =</span> <span class="st">"index"</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>hex_net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial network nodes with id: sg
--------------------------------------------------
Number of nodes: 2375
Average number of links per node: 55.223
Density of the neighborhood matrix: 2.33% (non-zero connections)

Data on nodes:
     index housing_count biz_count school_count fin_count hc_count
1        1             0         0            0         0        0
2        2             0         0            0         0        0
3        3             0         0            0         0        0
4        4             0         0            0         0        0
5        5             0         0            0         0        0
6        6             0         0            0         0        0
---    ---           ---       ---          ---       ---      ---
2370  2370             0         0            0         0        0
2371  2371             0         0            0         0        0
2372  2372             0         0            0         0        0
2373  2373             0         0            0         0        0
2374  2374             0         0            0         0        0
2375  2375             0         0            0         0        0
     leisure_recre_count food_bev_count retail_count entertn_count bus_count
1                      0              0            0             0         0
2                      0              0            0             0         1
3                      0              0            0             0         0
4                      0              0            0             0         0
5                      0              0            0             0         0
6                      0              0            0             0         0
---                  ---            ---          ---           ---       ---
2370                   0              0            0             0         0
2371                   0              0            0             0         0
2372                   0              0            0             0         0
2373                   0              0            0             0         0
2374                   0              0            0             0         0
2375                   0              0            0             0         0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>hex_net_pairs <span class="ot">&lt;-</span> <span class="fu">spflow_network_pair</span>(</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_orig_net =</span> <span class="st">"sg"</span>,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_dest_net =</span> <span class="st">"sg"</span>,</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pair_data =</span> flow_data1,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_key_column =</span> <span class="st">"ORIGIN_hex"</span>,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dest_key_column =</span> <span class="st">"DESTIN_hex"</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>hex_net_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial network pair with id: sg_sg
--------------------------------------------------
Origin network id: sg (with 812 nodes)
Destination network id: sg (with 812 nodes)
Number of pairs: 67502
Completeness of pairs: 10.24% (67502/659344)

Data on node-pairs:
    DESTIN_hex ORIGIN_hex TOTAL_TRIPS    dist
1           60          2           2 1299.04
2           61          2          22    2250
3           80          2          62    3000
4           98          2         289 1984.31
5          117          2           1 2598.08
6          122          2          64 8112.49
---        ---        ---         ---     ---
11        2215       2365          32 3968.63
21        1983       2365           7 7937.25
31        2134       2365          26 5952.94
41        2172       2365          47 5408.33
51        2234       2365         154 3269.17
61        2286       2365           4 4175.82</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>hex_multi_net <span class="ot">&lt;-</span> <span class="fu">spflow_network_multi</span>(hex_net, hex_net_pairs)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>hex_multi_net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collection of spatial network nodes and pairs
--------------------------------------------------
Contains 1 spatial network nodes  
    With id :  sg
Contains 1 spatial network pairs  
    With id :  sg_sg

Availability of origin-destination pair information:

 ID_ORIG_NET ID_DEST_NET ID_NET_PAIR COMPLETENESS       C_PAIRS    C_ORIG
          sg          sg       sg_sg        1.20% 67502/5640625 2375/2375
    C_DEST
 2375/2375</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="correlation-analysis">Correlation Analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate explanatory variables names</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>var_name <span class="ot">&lt;-</span> explanatory <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(index)) <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the formula dynamically</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>cor_formula <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> TOTAL_TRIPS) <span class="sc">~</span> </span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  bus_count <span class="sc">+</span> </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  housing_count <span class="sc">+</span> </span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  biz_count <span class="sc">+</span> </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  school_count <span class="sc">+</span> </span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>  fin_count <span class="sc">+</span> </span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>  hc_count <span class="sc">+</span> </span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>  leisure_recre_count <span class="sc">+</span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>  food_bev_count <span class="sc">+</span> </span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>  retail_count <span class="sc">+</span> </span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>  entertn_count <span class="sc">+</span> </span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">P_</span>(<span class="fu">log</span>(dist <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">pair_cor</span>(</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>  hex_multi_net, </span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">spflow_formula =</span> cor_formula, </span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_lags_x =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(</span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(cor_mat),<span class="dv">1</span>,<span class="dv">3</span>),<span class="st">"..."</span>)</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cor_image</span>(cor_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Given that there are no variable pairs that are very highly correlated with one another, all variables will be used to calibrate the SEIM.</p>
</section>
<section id="seim-calibration" class="level2">
<h2 class="anchored" data-anchor-id="seim-calibration">7.2.1 SEIM Calibration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>base_model <span class="ot">&lt;-</span> <span class="fu">spflow</span>(</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">spflow_formula =</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> TOTAL_TRIPS) <span class="sc">~</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">O_</span>(bus_count <span class="sc">+</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  housing_count <span class="sc">+</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  biz_count <span class="sc">+</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  school_count <span class="sc">+</span> </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  fin_count <span class="sc">+</span> </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  hc_count <span class="sc">+</span> </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  leisure_recre_count <span class="sc">+</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  food_bev_count <span class="sc">+</span> </span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  retail_count <span class="sc">+</span> </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  entertn_count) <span class="sc">+</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">D_</span>(bus_count <span class="sc">+</span> </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>  housing_count <span class="sc">+</span> </span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  biz_count <span class="sc">+</span> </span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>  school_count <span class="sc">+</span> </span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>  fin_count <span class="sc">+</span> </span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>  hc_count <span class="sc">+</span> </span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>  leisure_recre_count <span class="sc">+</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>  food_bev_count <span class="sc">+</span> </span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>  retail_count <span class="sc">+</span> </span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>  entertn_count) <span class="sc">+</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">P_</span>(<span class="fu">log</span>(dist <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">spflow_networks =</span> hex_multi_net)</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>base_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------------------------------------------
Spatial interaction model estimated by: MLE  
Spatial correlation structure: SDM (model_9)
Dependent variable: log(1 + TOTAL_TRIPS)

--------------------------------------------------
Coefficients:
                               est     sd   t.stat  p.val
rho_d                        0.767  0.008  100.803  0.000
rho_o                        0.746  0.008   98.606  0.000
rho_w                       -0.999  0.024  -42.227  0.000
(Intercept)                  9.831  0.132   74.487  0.000
(Intra)                         NA     NA       NA     NA
D_bus_count                  0.031  0.002   13.789  0.000
D_bus_count.lag1            -0.012  0.014   -0.821  0.411
D_housing_count              0.000  0.000   15.847  0.000
D_housing_count.lag1         0.000  0.000    9.081  0.000
D_biz_count                 -0.001  0.001   -0.921  0.357
D_biz_count.lag1            -0.027  0.003   -9.068  0.000
D_school_count               0.003  0.008    0.385  0.700
D_school_count.lag1         -0.232  0.104   -2.220  0.026
D_fin_count                  0.014  0.002    9.608  0.000
D_fin_count.lag1             0.017  0.015    1.148  0.251
D_hc_count                   0.020  0.004    5.175  0.000
D_hc_count.lag1             -0.295  0.041   -7.128  0.000
D_leisure_recre_count       -0.008  0.003   -2.815  0.005
D_leisure_recre_count.lag1  -0.398  0.029  -13.530  0.000
D_food_bev_count            -0.001  0.001   -0.570  0.569
D_food_bev_count.lag1        0.023  0.011    2.083  0.037
D_retail_count               0.000  0.000    3.041  0.002
D_retail_count.lag1          0.006  0.001    9.060  0.000
D_entertn_count              0.082  0.010    7.954  0.000
D_entertn_count.lag1         0.286  0.090    3.193  0.001
O_bus_count                  0.032  0.002   14.290  0.000
O_bus_count.lag1             0.011  0.014    0.741  0.458
O_housing_count              0.000  0.000   15.482  0.000
O_housing_count.lag1         0.000  0.000   10.213  0.000
O_biz_count                  0.000  0.001    0.251  0.802
O_biz_count.lag1            -0.025  0.003   -8.117  0.000
O_school_count               0.018  0.008    2.143  0.032
O_school_count.lag1         -0.358  0.104   -3.436  0.001
O_fin_count                  0.013  0.002    8.646  0.000
O_fin_count.lag1             0.030  0.015    2.015  0.044
O_hc_count                   0.026  0.004    6.586  0.000
O_hc_count.lag1             -0.345  0.041   -8.346  0.000
O_leisure_recre_count       -0.012  0.003   -4.164  0.000
O_leisure_recre_count.lag1  -0.386  0.029  -13.191  0.000
O_food_bev_count            -0.001  0.001   -0.918  0.359
O_food_bev_count.lag1        0.025  0.011    2.255  0.024
O_retail_count               0.000  0.000    1.863  0.062
O_retail_count.lag1          0.004  0.001    6.525  0.000
O_entertn_count              0.077  0.010    7.418  0.000
O_entertn_count.lag1         0.455  0.089    5.084  0.000
P_log(dist + 1)             -0.729  0.016  -45.083  0.000

--------------------------------------------------
R2_corr: 0.560786  
Observations: 67502  
Model coherence: Validated</code></pre>
</div>
</div>
<section id="residual-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="residual-diagnostics">Residual diagnostics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>old_par <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="fu">spflow_moran_plots</span>(base_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualise-fitted-values" class="level3">
<h3 class="anchored" data-anchor-id="visualise-fitted-values">Visualise Fitted Values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>model.df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(base_model<span class="sc">@</span>spflow_indicators) <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FITTED_Y =</span> <span class="fu">round</span>(<span class="fu">exp</span>(FITTED),<span class="dv">0</span>))</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>inter_zonal_flow <span class="ot">&lt;-</span> flow_data <span class="sc">%&gt;%</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(model.df) <span class="sc">%&gt;%</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> (FITTED_Y<span class="sc">-</span>TOTAL_TRIPS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> inter_zonal_flow,</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> FITTED,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> ACTUAL)) <span class="sc">+</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>),</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>)) <span class="sc">+</span> </span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Observed vs. Fitted Values for SEIM"</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Fitted Values"</span>, <span class="at">y =</span> <span class="st">"Observed Values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="prototype" class="level1">
<h1>8.0 Prototype</h1>
<p>In light of our class project, I aim to test the feasibility of plotting out the various commuting flow maps.</p>
<p>Specifically, the maps can focus on the various areas of interest and plot the flow lines originating and ending in AOIs of ranged densities.</p>
<p>The analytical unit could be planning area, subzone or even hexagonal.</p>
<p>Before diving into these analytical units, we can have a look at the general inflow and outflows from origins and destinations.</p>
</section>
<section id="level-1-general-perspective" class="level1">
<h1>Level 1: General Perspective</h1>
<p>The <code>TOTAL_TRIPS</code> is set to 3000 at minimum due to computational time taken to run the below code chunks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>flowLine <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, TOTAL_TRIPS<span class="sc">&gt;=</span><span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Split outgoing and incoming flows along with the origin and destination hexagon layers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_sg2<span class="sc">$</span>index)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_sg2, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>flowLine_dest <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, DESTIN_hex <span class="sc">%in%</span> hex_sg2<span class="sc">$</span>index)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>dest_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_sg2, index <span class="sc">%in%</span> flowLine_dest<span class="sc">$</span>DESTIN_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="general-outflows-from-origins-propulsive" class="level2">
<h2 class="anchored" data-anchor-id="general-outflows-from-origins-propulsive">General Outflows from Origins (Propulsive)</h2>
<p>Here, I assume that the user is interested in bus traffic flows and where buses typically leave.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_sg2, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_sg2) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(org_hex_3000) <span class="sc">+</span> </span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span>  </span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origin: Desire Lines Traffic Analysis Zones </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (2).png" class="img-fluid"></p>
</section>
<section id="inflows-to-destinations-attractive" class="level2">
<h2 class="anchored" data-anchor-id="inflows-to-destinations-attractive">Inflows to Destinations (Attractive)</h2>
<p>This scenario assumes that the user is interested in the popular bus destinations, i.e.&nbsp;<code>TOTAL_TRIPS</code> is minmally <strong>8000</strong> on <strong>weekdays</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>flowLine_dest <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, DESTIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>dest_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_dest<span class="sc">$</span>DESTIN_hex)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>dest_hex_8000 <span class="ot">&lt;-</span> dest_hex[dest_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_dest<span class="sc">$</span>DESTIN_hex[flowLine_dest<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">10000</span>], ]</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dest_hex_8000) <span class="sc">+</span> </span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>flowLine_dest <span class="sc">%&gt;%</span>  </span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKDAY"</span>, TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">8000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Destinations: Desire Lines with at least 8000 trips </span><span class="sc">\n</span><span class="st">between Traffic Analysis Zones for Weekdays </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (3).png" class="img-fluid"></p>
</section>
<section id="weekday-vs-weekendholiday" class="level2">
<h2 class="anchored" data-anchor-id="weekday-vs-weekendholiday">Weekday vs Weekend/Holiday</h2>
<p>This scenario simulates the user wanting to find out how do bus destinations differ on <strong>weekends</strong> compared to <strong>weekdays</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dest_hex_8000) <span class="sc">+</span> </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>flowLine_dest <span class="sc">%&gt;%</span>  </span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKENDS/HOLIDAY"</span>, TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">8000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Destinations: Desire Lines with at least 8000 trips </span><span class="sc">\n</span><span class="st">between Traffic Analysis Zones for Weekends </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Hexagons linked to desire lines reveal that they are more popular starting or destination locations for bus rides.</p></li>
<li><p>There are many trips made to destinations in the north, which is around Tuas Checkpoint.</p></li>
</ul>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (4).png" class="img-fluid"></p>
</section>
<section id="specific-hour-of-the-day" class="level2">
<h2 class="anchored" data-anchor-id="specific-hour-of-the-day">Specific Hour of the Day</h2>
<p>A user might be curious about bus traffic flows and where they start on weekdays at 8am.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(org_hex_3000) <span class="sc">+</span> </span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span>  </span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origin: Desire Lines Traffic Analysis Zones Weekdays, 8am </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (9).png" class="img-fluid"></p>
<p>Since too many desire lines are plotted, the user can narrow the minimum number of total trips per origin-destination hexagon pair to 10000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>org_hex_10000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">10000</span>], ]</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(org_hex_10000) <span class="sc">+</span> </span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span>  </span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">10000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origin: Desire Lines between Traffic Analysis Zones with &gt;10000 Trips </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (4).png" class="img-fluid"></p>
</section>
</section>
<section id="level-2-planning-area" class="level1">
<h1>Level 2: Planning Area</h1>
<p>The below scenario is whereby a user is interested in looking at bus trips starting from a Planning Area like Bedok at 8am on a weekday.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="sc">%&gt;%</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PLN_AREA_N <span class="sc">==</span> <span class="st">"BEDOK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span> </span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIGIN_hex <span class="sc">%in%</span> org_hex_3000<span class="sc">$</span>index[org_hex_3000<span class="sc">$</span>PLN_AREA_N <span class="sc">==</span> <span class="st">"BEDOK"</span>]) <span class="sc">%&gt;%</span>  </span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Bedok Origin: Desire Lines between Traffic Analysis Zones with &gt;3000 Trips </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The majority of bus trips at 8 am starting from Bedok Planning Area mostly end within the Planning Area too.</li>
</ul>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (5).png" class="img-fluid"></p>
<p>Multiple starting planning areas for bus trips can also be observed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="sc">%&gt;%</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PLN_AREA_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BEDOK"</span>, <span class="st">"PUNGGOL"</span>, <span class="st">"PAYA LEBAR"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span> </span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"PLN_AREA_N"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIGIN_hex <span class="sc">%in%</span> org_hex_3000<span class="sc">$</span>index[org_hex_3000<span class="sc">$</span>PLN_AREA_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BEDOK"</span>, <span class="st">"PUNGGOL"</span>, <span class="st">"PAYA LEBAR"</span>)]) <span class="sc">%&gt;%</span>  </span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(org_hex_3000 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(index, PLN_AREA_N), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"PLN_AREA_N"</span>,</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">palette =</span> <span class="st">"Dark2"</span>,</span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>),</span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Bedok, Paya Lebar &amp; Punggol Origin: Desire Lines between </span><span class="sc">\n</span><span class="st">Traffic Analysis Zones with &gt;3000 Trips (Nov '23 - Jan '24)"</span>,</span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>There are more origin locations at Bedok than Punggol at 8am.</p></li>
<li><p>There are noticeable outgoing bus trips from Punggol to Bedok Planning Area at 8am.</p></li>
</ul>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (6).png" class="img-fluid"></p>
</section>
<section id="level-3-subzone" class="level1">
<h1>Level 3: Subzone</h1>
<p>The user might also want to view bus travels at the subzone level, such as those starting from subzone Mathilda in Punggol planning area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="sc">%&gt;%</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SUBZONE_N <span class="sc">==</span> <span class="st">"MATILDA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span> </span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIGIN_hex <span class="sc">%in%</span> org_hex_3000<span class="sc">$</span>index[org_hex_3000<span class="sc">$</span>SUBZONE_N <span class="sc">==</span> <span class="st">"MATILDA"</span>]) <span class="sc">%&gt;%</span>  </span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>),</span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>, </span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"Total Trips"</span></span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span> </span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Punggol Matilda Origin: Desire Lines between Traffic Analysis Zones with &gt;3000 Trips </span><span class="sc">\n</span><span class="st">(Nov '23 - Jan '24)"</span>,</span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb145-27"><a href="#cb145-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb145-28"><a href="#cb145-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Between 7am and 8am, there are many trips from Matilda subzone to its immediate east hexagon neighbour that is also within the Punggol Planning Area.</li>
</ul>
<p>Town Councils have recently been pushing for silver zones which promotes elderly-friendly paths along with school zones. Traffic calming in such zones may affect bus routes and it is important to check the volume of inter Planning Area bus routes. Planners can use the multiple-subzones perspective as a proxy of the potential economic costs of constructing such zones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowLine, ORIGIN_hex <span class="sc">%in%</span> hex_grid_bounded3<span class="sc">$</span>index)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>org_hex <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_bounded3, index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex[org_hex<span class="sc">$</span>index <span class="sc">%in%</span> flowLine_org<span class="sc">$</span>ORIGIN_hex[flowLine_org<span class="sc">$</span>TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>], ]</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="ot">&lt;-</span> org_hex_3000[, <span class="fu">c</span>(<span class="st">"index"</span>, <span class="fu">setdiff</span>(<span class="fu">names</span>(org_hex_3000), <span class="st">"index"</span>))]</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>hex_grid_bounded3 <span class="ot">&lt;-</span> hex_grid_bounded3[, <span class="fu">c</span>(<span class="st">"index"</span>, <span class="fu">setdiff</span>(<span class="fu">names</span>(hex_grid_bounded3), <span class="st">"index"</span>))]</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="sc">%&gt;%</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SUBZONE_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WATERWAY EAST"</span>, <span class="st">"NORTHSHORE"</span>, <span class="st">"MATILDA"</span>, <span class="st">"PUNGGOL FIELD"</span>, <span class="st">"CONEY ISLAND"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span> </span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"SUBZONE_N"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIGIN_hex <span class="sc">%in%</span> org_hex_3000<span class="sc">$</span>index[org_hex_3000<span class="sc">$</span>SUBZONE_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WATERWAY EAST"</span>, <span class="st">"NORTHSHORE"</span>, <span class="st">"MATILDA"</span>, <span class="st">"PUNGGOL FIELD"</span>, <span class="st">"CONEY ISLAND"</span>)]) <span class="sc">%&gt;%</span>  </span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKDAY"</span>,TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(org_hex_3000 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(index, SUBZONE_N), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"SUBZONE_N"</span>,</span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">palette =</span> <span class="st">"Dark2"</span>,</span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>),</span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Punggol Subzones Origin: Desire Lines between </span><span class="sc">\n</span><span class="st">Traffic Analysis Zones with &gt;3000 Trips (Nov '23 - Jan '24)"</span>,</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>On weekdays, 7-8am, there has been a high total bus traffic of 29,460 trips from Matilda (hex 1368) to Punggol Field (hex 1390), and 29,178 trips from Punggol Field (hex 1390) to Waterway East (hex 1412).</p></li>
<li><p>There is also high bus traffic of 14,581 trips within Punggol Field subzone, from hex 1390 to hex 1400. Should there be construction plans in these hexagonal areas, the relevant government agencies or even the town council can advice residents on alternative routes to go to their respective destinations.</p></li>
</ul>
</div>
</div>
<p>The potential user interface for the above scenario may look like this:</p>
<p><img src="img/Commute Flow Map (7).png" class="img-fluid"></p>
</section>
<section id="validating-spatial-interaction-models" class="level1">
<h1>Validating Spatial Interaction Models</h1>
<p>As a teaser to SIMs, users can have a look at whether the volume of bus trips could be influenced by areas of interests within the vicinity.</p>
<p>From the previous map, we can see that there is a total high bus traffic of 14,581 from Punggol Field hex 1400 to Bedok North (hex 1515) from 7-8am on weekdays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grid_bounded3) <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>org_hex_3000 <span class="sc">%&gt;%</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SUBZONE_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WATERWAY EAST"</span>, <span class="st">"NORTHSHORE"</span>, <span class="st">"MATILDA"</span>, <span class="st">"PUNGGOL FIELD"</span>, <span class="st">"CONEY ISLAND"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>() <span class="sc">+</span> </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"SUBZONE_N"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>flowLine_org <span class="sc">%&gt;%</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIGIN_hex <span class="sc">%in%</span> org_hex_3000<span class="sc">$</span>index[org_hex_3000<span class="sc">$</span>SUBZONE_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WATERWAY EAST"</span>, <span class="st">"NORTHSHORE"</span>, <span class="st">"MATILDA"</span>, <span class="st">"PUNGGOL FIELD"</span>, <span class="st">"CONEY ISLAND"</span>)]) <span class="sc">%&gt;%</span>  </span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>, TIME_PER_HOUR <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(org_hex_3000 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(index, SUBZONE_N), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_hex"</span> <span class="ot">=</span> <span class="st">"index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TOTAL_TRIPS"</span>,</span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"SUBZONE_N"</span>,</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">palette =</span> <span class="st">"Dark2"</span>,</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>),</span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(biz) <span class="sc">+</span></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Punggol Subzones Origin: Desire Lines between </span><span class="sc">\n</span><span class="st">Traffic Analysis Zones with &gt;3000 Trips (Nov '23 - Jan '24)"</span>,</span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_legend</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">legend.text.size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Perhaps on weekdays 8-9am, Bedok North hex 1515 is a popular destination for the population living in Punggol Field hex 1400 due to the numerous businesses in the former hex which is also an industrial area.</li>
</ul>
</div>
</div>
<p><img src="img/Commute Flow Map (8).png" class="img-fluid"></p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>M. Chan. Applied Spatial Interaction Models - Case Study of Singapore Public Bus Commuter Flows. https://geospatial2023.netlify.app/take_home_exercise/ex2/take_home_ex2#calibrate-spatial-econometric-interaction-model-usng-maximum-likelihood-estimation</p>
<p>K. J. Paas, 2023. Take Home Exercise 2: A Case Study of Singapore Public Bus Commuter Flows. https://isss624-kjcpaas.netlify.app/take-home_ex2/take-home_ex2</p>
<p>T. S. Kam.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>