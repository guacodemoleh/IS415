<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victoria Grace ANN">
<meta name="dcterms.date" content="2024-03-11">

<title>IS415-GAA - Take-home Exercise 3 (Revised): Exploratory Spatial Data Analysis for Potential Push &amp; Pull Factors of Locations in Singapore using Public Bus Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.32/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex10.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1: Technical Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01a.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1: Report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03a.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3 (beta)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03b.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About Victoria</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1.0 Overview</a></li>
  <li><a href="#package-installation" id="toc-package-installation" class="nav-link" data-scroll-target="#package-installation">2.0 Package Installation</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">3.0 Data sources</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">4.0 Data preparation</a></li>
  <li><a href="#data-preparation-for-bus-induced-hexagons" id="toc-data-preparation-for-bus-induced-hexagons" class="nav-link" data-scroll-target="#data-preparation-for-bus-induced-hexagons">4.1 Data preparation for bus-induced hexagons</a></li>
  <li><a href="#prototype-for-spatial-interaction-analysis" id="toc-prototype-for-spatial-interaction-analysis" class="nav-link" data-scroll-target="#prototype-for-spatial-interaction-analysis">4.2.1 Prototype for Spatial Interaction Analysis</a></li>
  <li><a href="#spatial-interaction-modelling" id="toc-spatial-interaction-modelling" class="nav-link" data-scroll-target="#spatial-interaction-modelling">5.0 Spatial Interaction Modelling</a>
  <ul>
  <li><a href="#attractiveness-variables" id="toc-attractiveness-variables" class="nav-link" data-scroll-target="#attractiveness-variables">5.1.1 Attractiveness variables</a>
  <ul class="collapse">
  <li><a href="#pois" id="toc-pois" class="nav-link" data-scroll-target="#pois">POIs</a></li>
  <li><a href="#public-healthcare" id="toc-public-healthcare" class="nav-link" data-scroll-target="#public-healthcare">Public Healthcare</a>
  <ul class="collapse">
  <li><a href="#data-preparation-2" id="toc-data-preparation-2" class="nav-link" data-scroll-target="#data-preparation-2">Data Preparation</a></li>
  </ul></li>
  <li><a href="#school" id="toc-school" class="nav-link" data-scroll-target="#school">School</a>
  <ul class="collapse">
  <li><a href="#save-memory-space-by-offloading-1" id="toc-save-memory-space-by-offloading-1" class="nav-link" data-scroll-target="#save-memory-space-by-offloading-1">Save Memory Space by Offloading</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#deriving-passengers-alighting-from-bus-stop" id="toc-deriving-passengers-alighting-from-bus-stop" class="nav-link" data-scroll-target="#deriving-passengers-alighting-from-bus-stop">5.1.2 Deriving Passengers Alighting from Bus Stop</a></li>
  <li><a href="#propulsiveness-variables" id="toc-propulsiveness-variables" class="nav-link" data-scroll-target="#propulsiveness-variables">5.2.1 Propulsiveness variables</a></li>
  <li><a href="#generating-distance-table" id="toc-generating-distance-table" class="nav-link" data-scroll-target="#generating-distance-table">5.3 Generating distance table</a>
  <ul class="collapse">
  <li><a href="#generating-distance-matrix" id="toc-generating-distance-matrix" class="nav-link" data-scroll-target="#generating-distance-matrix">Generating distance matrix</a></li>
  <li><a href="#generating-a-pivot-table" id="toc-generating-a-pivot-table" class="nav-link" data-scroll-target="#generating-a-pivot-table">Generating a pivot table</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-consolidation" id="toc-data-consolidation" class="nav-link" data-scroll-target="#data-consolidation">6.0 Data Consolidation</a>
  <ul>
  <li><a href="#finishing-touches" id="toc-finishing-touches" class="nav-link" data-scroll-target="#finishing-touches">Finishing Touches</a></li>
  </ul></li>
  <li><a href="#visualising-spatial-interactions" id="toc-visualising-spatial-interactions" class="nav-link" data-scroll-target="#visualising-spatial-interactions">7.0 Visualising Spatial Interactions</a>
  <ul>
  <li><a href="#general-view" id="toc-general-view" class="nav-link" data-scroll-target="#general-view">General view</a></li>
  </ul></li>
  <li><a href="#plotting-trips-vs-distance" id="toc-plotting-trips-vs-distance" class="nav-link" data-scroll-target="#plotting-trips-vs-distance">Plotting TRIPS vs DISTANCE</a>
  <ul>
  <li><a href="#visualising-propulsive-forces" id="toc-visualising-propulsive-forces" class="nav-link" data-scroll-target="#visualising-propulsive-forces">Visualising propulsive forces</a></li>
  <li><a href="#visualising-attractive-forces" id="toc-visualising-attractive-forces" class="nav-link" data-scroll-target="#visualising-attractive-forces">Visualising attractive forces</a></li>
  </ul></li>
  <li><a href="#prototype-potential" id="toc-prototype-potential" class="nav-link" data-scroll-target="#prototype-potential">7.1 Prototype Potential</a></li>
  <li><a href="#spatial-econometric-interaction-modelling" id="toc-spatial-econometric-interaction-modelling" class="nav-link" data-scroll-target="#spatial-econometric-interaction-modelling">8.0 Spatial Econometric Interaction Modelling</a>
  <ul>
  <li><a href="#prepare-spatial-weights" id="toc-prepare-spatial-weights" class="nav-link" data-scroll-target="#prepare-spatial-weights">Prepare Spatial Weights</a></li>
  <li><a href="#preparing-flow-data" id="toc-preparing-flow-data" class="nav-link" data-scroll-target="#preparing-flow-data">Preparing Flow Data</a></li>
  <li><a href="#preparing-explanatory-variables" id="toc-preparing-explanatory-variables" class="nav-link" data-scroll-target="#preparing-explanatory-variables">Preparing Explanatory Variables</a></li>
  <li><a href="#creating-spflow_network-class-objects" id="toc-creating-spflow_network-class-objects" class="nav-link" data-scroll-target="#creating-spflow_network-class-objects">Creating spflow_network-class objects</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3 (Revised): Exploratory Spatial Data Analysis for Potential Push &amp; Pull Factors of Locations in Singapore using Public Bus Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Victoria Grace ANN </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 11, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 31, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>1.0 Overview</h1>
<p>In this exercise, my focus would be on prototyping exploratory spatial data analysis, particularly density of spatial assets within hexagonal traffic analysis zones. In conventional geography, a traffic analysis zone is the unit most commonly used in transportation planning models and the size of it varies. Hexagonal traffic analysis zones has gained traction as the hexagons of the study area have a uniform size which are easily comparable with each other when determining transport attractiveness. It is also recommended that hexagon radius should be 125m for areas in high urbanisation and 250m in areas with less urbanisation (Chmielewski et al., 2020).</p>
<p>The data preparation for this purpose also supports the preparation for calibrating spatial interaction models. For the prototyping, only exploratory spatial data analysis will be done.</p>
</section>
<section id="package-installation" class="level1">
<h1>2.0 Package Installation</h1>
<p>I will load up the below R packages for the following purposes:</p>
<ul>
<li><p>tmap: to visualise spatial data by creating thematic maps that could be interactive or static.</p></li>
<li><p>sf: to manipulate spatial data.</p></li>
<li><p>sp: to manipulate spatial data (older than sp).</p></li>
<li><p>reshape2: to reshape and transform data frames; converting data between “wide” and “long” formats using functions like melt().</p></li>
<li><p>ggplot2: to visualise data with plot types including bar plots.</p></li>
<li><p>tidyverse: to clean and transform data and contains sub-packagess including tidyr, dplyr and readr.</p></li>
<li><p>stplanr: to provide functions suitable for working with spatial transport data like networks, orgins-destinations matrices and travel time matrices; builds on the capabilities of sf and sp packages.</p></li>
<li><p>knitr: to combine code into a single documents that can be easily converted to various output formats like html, pdf, or Word.</p></li>
<li><p>kableExtra: to further style any Kables.</p></li>
<li><p>spdep: to create spatial wieght matrix objects from contiguities</p></li>
<li><p>spflow: to estimate spatial econometric interaction models</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tmap, sf, sp, reshape2, ggplot2, ggpubr, tidyverse, stplanr, knitr, kableExtra, spdep)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"LukeCe/spflow"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spflow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-sources" class="level1">
<h1>3.0 Data sources</h1>
<ul>
<li><p>URA’s Masterplan Subzone 2019 Layer in shapefile format</p></li>
<li><p>Bus Stop Locations extracted from LTA</p></li>
<li><p>A tabulated bus passenger flow for Nov 2023, Dec 2023 and Jan 2024 from LTA dynamic data mall</p></li>
<li><p>Population Data for 2023 from SingStat</p></li>
<li><p>Schools from MOE</p></li>
<li><p>Financial Services</p></li>
<li><p>Hospitals, polyclinics and CHAS clinics derived from Google Maps</p></li>
</ul>
</section>
<section id="data-preparation" class="level1">
<h1>4.0 Data preparation</h1>
</section>
<section id="data-preparation-for-bus-induced-hexagons" class="level1">
<h1>4.1 Data preparation for bus-induced hexagons</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Subzone Layer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Bus Stops Layer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Spatial Grids Layer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Importing data sets</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Read the subzone layer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/master-plan-2019-subzone-boundary-no-sea-kml.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert <code>mpsz</code> to 2D geometry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(mpsz, <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="co"># Convert 3D geometries to 2D</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Extract the <code>SUBZONE_N</code> and <code>PLN_AREA_N</code> from the <code>Dscrptn</code> field</p>
<p>For SUBZONE_N,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUBZONE_N =</span> <span class="fu">str_extract</span>(Description, <span class="st">"&lt;th&gt;SUBZONE_N&lt;/th&gt; &lt;td&gt;(.*?)&lt;/td&gt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>SUBZONE_N <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(mpsz<span class="sc">$</span>SUBZONE_N, <span class="st">"&lt;.*?&gt;|SUBZONE_N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For PLN_AREA_N,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PLN_AREA_N =</span> <span class="fu">str_extract</span>(Description, <span class="st">"&lt;th&gt;PLN_AREA_N&lt;/th&gt; &lt;td&gt;(.*?)&lt;/td&gt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>PLN_AREA_N <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(mpsz<span class="sc">$</span>PLN_AREA_N, <span class="st">"&lt;.*?&gt;|PLN_AREA_N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove the <code>Description</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>Description <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove unwanted outer islands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>outer_islands <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEMAKAU"</span>, <span class="st">"SUDONG"</span>, <span class="st">"NORTH-EASTERN ISLANDS"</span>, <span class="st">"SOUTHERN GROUP"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> mpsz3414 <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_trim</span>(SUBZONE_N) <span class="sc">%in%</span> <span class="fu">str_trim</span>(outer_islands))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the shapefile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(mpsz3414, <span class="st">"data/geospatial/mpsz3414.shp"</span>, <span class="at">append=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the updated shapefile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/mpsz3414.shp"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `mpsz3414' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\mpsz3414.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 328 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 21448.47 xmax: 55941.94 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Read the aspatial bus stop layer and set its CRS to 3414.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>BusStop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/aspatial/bus_coords_subzone_v2.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(BusStop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  BusStopCode      RoadName         Description          Subzone         
 Min.   : 1012   Length:5107        Length:5107        Length:5107       
 1st Qu.:25345   Class :character   Class :character   Class :character  
 Median :49031   Mode  :character   Mode  :character   Mode  :character  
 Mean   :48663                                                           
 3rd Qu.:67065                                                           
 Max.   :99189                                                           
          geometry   
 POINT        :5107  
 epsg:3414    :   0  
 +proj=tmer...:   0  
                     
                     
                     </code></pre>
</div>
</div>
<p>Ensure that all bus stops are within Singapore’s boundary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>BusStop <span class="ot">&lt;-</span> BusStop <span class="sc">%&gt;%</span> <span class="fu">st_intersection</span>(mpsz3414) <span class="sc">%&gt;%</span> <span class="fu">select</span>(BusStopCode, )</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(BusStop) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Generate the hexagon grids using <code>st_make_grid()</code> with a cellsize of 750m.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">&lt;-</span> BusStop <span class="sc">%&gt;%</span> <span class="fu">st_make_grid</span>(<span class="at">cellsize =</span><span class="dv">750</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">what =</span> <span class="st">"polygons"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">square =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">lengths</span>(<span class="fu">st_intersects</span>(geometry, BusStop)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code interpretation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>st_make_grid: creates grids covering areas also without bus stops</p></li>
<li><p>cellsize: hexagon size determined by twice the length of the apothem</p></li>
<li><p>st_sf: set the hexagons as a sf object</p></li>
<li><p>filter: filtering for hexagons that contain bus stops</p></li>
</ul>
</div>
</div>
</div>
<p>Have a look and check if the hexagons cover all the bus stop locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">title =</span> <span class="st">"Hexagons"</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Hexagons corresponding to Singapore bus stops"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(BusStop) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.001</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="assign-id-to-each-hexagon" class="level3">
<h3 class="anchored" data-anchor-id="assign-id-to-each-hexagon">Assign ID to each hexagon</h3>
<p>Each hexagon will have an assigned ID that will be their unique identifier. This new information can be stored under the HEX_ID column which will be helpful for joining data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>HEX_ID <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"H%04d"</span>, <span class="fu">seq_len</span>(<span class="fu">nrow</span>(hex_grids))) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hex_grids, <span class="st">"data/rds/hex_grids.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/hex_grids.rds"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(hex_grids))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">geometry</th>
<th style="text-align: left;">HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">POLYGON ((3578.167 27517.51…</td>
<td style="text-align: left;">H0001</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4328.167 27517.51…</td>
<td style="text-align: left;">H0002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4328.167 28816.55…</td>
<td style="text-align: left;">H0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4328.167 30115.59…</td>
<td style="text-align: left;">H0004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4703.167 28167.03…</td>
<td style="text-align: left;">H0005</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4703.167 29466.07…</td>
<td style="text-align: left;">H0006</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="spatial-interaction-analysis" class="level1">
<h1>4.2 Spatial Interaction Analysis</h1>
</section>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Combining OD data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>od_bus_nov <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_nov_v2.csv"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>od_bus_dec <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_dec_v2.csv"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>od_bus_jan <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/OD Bus/merged_bus_jan_v2.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>OD <span class="ot">&lt;-</span> <span class="fu">rbind</span>(od_bus_nov, od_bus_dec)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>OD <span class="ot">&lt;-</span> <span class="fu">rbind</span>(OD, od_bus_jan)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(od_bus_nov) <span class="sc">+</span> <span class="fu">nrow</span>(od_bus_dec) <span class="sc">+</span> <span class="fu">nrow</span>(od_bus_jan) <span class="sc">==</span> <span class="fu">nrow</span>(OD) <span class="co"># evaluates to TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(OD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>ORIGIN_PT_CODE</code> and <code>DESTINATION_PT_CODE</code> are listed as character variables. These variables should be transformed to factors so that R treats them as grouping variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ORIGIN_PT_CODE"</span>, <span class="st">"DESTINATION_PT_CODE"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>OD[cols_to_convert] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(OD[cols_to_convert], as.factor)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(OD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ORIGIN_PT_CODE<code>and</code>DESTINATION_PT_CODE` are now factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OD, <span class="st">"data/rds/odbus_combined.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>odbus_combined <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/odbus_combined.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Creating Commute Flow Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> odbus_combined <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_PT_CODE, ORIGIN_SUBZONE, DESTINATION_PT_CODE, DESTINATION_SUBZONE, DAY_TYPE ,TIME_PER_HOUR) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TOTAL_TRIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(od, <span class="st">"data/rds/od.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/od.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Generating O-D trip data by hexagon level
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can create a lookup table for the bus stops associated to each hexagon.</p>
<section id="generating-lookup-table-for-bus-stop-to-associated-hexagon" class="level2">
<h2 class="anchored" data-anchor-id="generating-lookup-table-for-bus-stop-to-associated-hexagon">Generating lookup table for bus stop to associated hexagon</h2>
<p>To connect the trip data to their corresponding hexagons, a lookup table needs to be made so that there is a relationship beetween the aspatial <code>od</code> and <code>hex_grids</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bs_hex <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(BusStop, hex_grids) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(BusStopCode, HEX_ID))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bs_hex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">BusStopCode</th>
<th style="text-align: left;">HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1241</td>
<td style="text-align: right;">25059</td>
<td style="text-align: left;">H0001</td>
</tr>
<tr class="even">
<td style="text-align: left;">1241.1</td>
<td style="text-align: right;">25059</td>
<td style="text-align: left;">H0002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1341</td>
<td style="text-align: right;">25751</td>
<td style="text-align: left;">H0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">1395</td>
<td style="text-align: right;">26379</td>
<td style="text-align: left;">H0004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1342</td>
<td style="text-align: right;">25761</td>
<td style="text-align: left;">H0005</td>
</tr>
<tr class="even">
<td style="text-align: left;">1337</td>
<td style="text-align: right;">25711</td>
<td style="text-align: left;">H0006</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multiple HEX_ID per bus stop
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some bus stops may fall in the boundary of neighbouring hexagons. To resolve this, such bus stops shall be assigned to the first identified corresponding HEX_ID.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bs_hex <span class="ot">&lt;-</span> bs_hex <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BusStopCode) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), first)) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(bs_hex) <span class="sc">==</span> <span class="fu">nrow</span>(BusStop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Joining <em>od</em> and <em>bs_hex</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Associate the origin bus stops and destination bus stops to their corresponding hexagons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bs_hex<span class="sc">$</span>BusStopCode <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(bs_hex<span class="sc">$</span>BusStopCode)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>od_trips_w_hex <span class="ot">&lt;-</span> od <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(bs_hex,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BusStopCode"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ORIG_HEX_ID =</span> HEX_ID) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(bs_hex,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"DESTINATION_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BusStopCode"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">DEST_HEX_ID =</span> HEX_ID)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(od_trips_w_hex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ORIGIN_PT_CODE</th>
<th style="text-align: left;">ORIGIN_SUBZONE</th>
<th style="text-align: left;">DESTINATION_PT_CODE</th>
<th style="text-align: left;">DESTINATION_SUBZONE</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">TIME_PER_HOUR</th>
<th style="text-align: right;">TRIPS</th>
<th style="text-align: left;">ORIG_HEX_ID</th>
<th style="text-align: left;">DEST_HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
<tr class="even">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
<tr class="even">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">29</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
<tr class="even">
<td style="text-align: left;">10009</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">10017</td>
<td style="text-align: left;">BUKIT MERAH</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">H0381</td>
<td style="text-align: left;">H0455</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<p>::: {,callout-warning collapse=“true”} ### Save Data Memory Space</p>
<p><code>od</code> is not needed anymore since the necessary data has been extracted, so we can offload it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(od)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Aggregating data by hexagon
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Perform aggregations by <code>ORIGIN_HEX_ID</code> and <code>DEST_HEX_ID</code> to have an aggregated sum of trips by hexagon instead of bus stops.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>od_hex <span class="ot">&lt;-</span> od_trips_w_hex <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIG_HEX_ID, ORIGIN_SUBZONE ,DEST_HEX_ID, DESTINATION_SUBZONE, DAY_TYPE, TIME_PER_HOUR) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(od_hex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 22%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ORIG_HEX_ID</th>
<th style="text-align: left;">ORIGIN_SUBZONE</th>
<th style="text-align: left;">DEST_HEX_ID</th>
<th style="text-align: left;">DESTINATION_SUBZONE</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">TIME_PER_HOUR</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0005</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bs_hex, <span class="st">"data/rds/bs_hex.rds"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(od_hex, <span class="st">"data/rds/od_hex.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Generating flow lines
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>od_hex <span class="ot">&lt;-</span> od_hex[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="fu">ncol</span>(od_hex))]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>flowlines <span class="ot">&lt;-</span> od_hex <span class="sc">%&gt;%</span> <span class="fu">od2line</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  hex_grids,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">zone_code =</span> <span class="st">"HEX_ID"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(flowlines, <span class="st">"data/rds/flowlines.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Point
</div>
</div>
<div class="callout-body-container callout-body">
<p>The flow data in the <code>od2line</code> function must have the origin and destination indexes in its first two columns.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>flowlines <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flowlines.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="inspect-flowlines" class="level2">
<h2 class="anchored" data-anchor-id="inspect-flowlines">Inspect flowlines</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Large data size
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The flowlines data is very large.</p>
<p>For all visualisations, the number of trips per flowline shown will be 3000 and above.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">title =</span> <span class="st">"Singapore Boundary"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">title =</span> <span class="st">"Hexagons"</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(flowlines[flowlines<span class="sc">$</span>TRIPS <span class="sc">&gt;=</span> <span class="dv">3000</span>,]) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TRIPS"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"# of bus trips"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Bus Passenger Flow for Weekdays)"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save Data Memory
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(flowlines)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(od_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="prototype-for-spatial-interaction-analysis" class="level1">
<h1>4.2.1 Prototype for Spatial Interaction Analysis</h1>
</section>
<section id="spatial-interaction-modelling" class="level1">
<h1>5.0 Spatial Interaction Modelling</h1>
<section id="attractiveness-variables" class="level2">
<h2 class="anchored" data-anchor-id="attractiveness-variables">5.1.1 Attractiveness variables</h2>
<p>Initiate the attractiveness from <code>hex_grids</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>attractiveness <span class="ot">&lt;-</span> hex_grids <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For all the variables, we only need to count the number of each location types per hexagon, which can be done using <code>lengths()</code> and <code>st_intersects()</code>.</p>
<section id="pois" class="level3">
<h3 class="anchored" data-anchor-id="pois">POIs</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Entertainment</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">F&amp;B</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Leisure &amp; Recreation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Retail</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Business</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Financial Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-8" role="tab" aria-controls="tabset-2-8" aria-selected="false">Housing Population Proxies</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>BUS_STOP_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(attractiveness, BusStop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>entertn <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/entertn.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `entertn' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\entertn.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 114 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 10809.34 ymin: 26528.63 xmax: 41600.62 ymax: 46375.77
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>ENTERTN_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, entertn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>food_bev <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/F&amp;B.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `F&amp;B' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\F&amp;B.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1919 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25343.27 xmax: 45462.43 ymax: 48796.21
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>FOOD_BEV_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, food_bev))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>leis_rec <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Liesure&amp;Recreation.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Liesure&amp;Recreation' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Liesure&amp;Recreation.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1217 features and 30 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25134.28 xmax: 48439.77 ymax: 50078.88
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>LEISURE_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, leis_rec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Retails.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Retails' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Retails.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 37635 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4737.982 ymin: 25171.88 xmax: 48265.04 ymax: 50135.28
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>RETAIL_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, retail))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Business.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Business' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Business.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 6550 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3669.148 ymin: 25408.41 xmax: 47034.83 ymax: 50148.54
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>BIZ_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, biz))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fin <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/FinServ.shp"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_set_crs</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `FinServ' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\FinServ.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 3320 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4881.527 ymin: 25171.88 xmax: 46526.16 ymax: 49338.02
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>FIN_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, fin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-8-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data preparation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>hdb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/hdb.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the purpose of computing a proxy for population density, the residential units will be extracted using <em>filter()</em> from the <strong>dplyr</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>hdb_residential <span class="ot">&lt;-</span> hdb <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(residential <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hdb_residential, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 37
    ...1 blk_no street       max_floor_lvl year_completed residential commercial
   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
 1     0 1      BEACH RD                16           1970 Y           Y         
 2     1 1      BEDOK STH A…            14           1975 Y           N         
 3     3 1      CHAI CHEE RD            15           1982 Y           N         
 4     4 1      CHANGI VILL…             4           1975 Y           Y         
 5     5 1      DELTA AVE               25           1982 Y           N         
 6     6 1      DOVER RD                12           1975 Y           N         
 7     7 1      EUNOS CRES              14           1977 Y           N         
 8     8 1      EVERTON PK              12           1980 Y           Y         
 9    10 1      GHIM MOH RD             15           1975 Y           N         
10    11 1      HAIG RD                 15           1976 Y           N         
# ℹ 30 more variables: market_hawker &lt;chr&gt;, miscellaneous &lt;chr&gt;,
#   multistorey_carpark &lt;chr&gt;, precinct_pavilion &lt;chr&gt;,
#   bldg_contract_town &lt;chr&gt;, total_dwelling_units &lt;dbl&gt;, `1room_sold` &lt;dbl&gt;,
#   `2room_sold` &lt;dbl&gt;, `3room_sold` &lt;dbl&gt;, `4room_sold` &lt;dbl&gt;,
#   `5room_sold` &lt;dbl&gt;, exec_sold &lt;dbl&gt;, multigen_sold &lt;dbl&gt;,
#   studio_apartment_sold &lt;dbl&gt;, `1room_rental` &lt;dbl&gt;, `2room_rental` &lt;dbl&gt;,
#   `3room_rental` &lt;dbl&gt;, other_room_rental &lt;dbl&gt;, lat &lt;dbl&gt;, lng &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>There are also some outliers like hotels that are classified as a residential unit. We can remove rows containing ‘hotel’ using <em>grepl()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>hotels <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"HOTEL"</span>, building, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(hotels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">…1</th>
<th style="text-align: left;">blk_no</th>
<th style="text-align: left;">street</th>
<th style="text-align: right;">max_floor_lvl</th>
<th style="text-align: right;">year_completed</th>
<th style="text-align: left;">residential</th>
<th style="text-align: left;">commercial</th>
<th style="text-align: left;">market_hawker</th>
<th style="text-align: left;">miscellaneous</th>
<th style="text-align: left;">multistorey_carpark</th>
<th style="text-align: left;">precinct_pavilion</th>
<th style="text-align: left;">bldg_contract_town</th>
<th style="text-align: right;">total_dwelling_units</th>
<th style="text-align: right;">1room_sold</th>
<th style="text-align: right;">2room_sold</th>
<th style="text-align: right;">3room_sold</th>
<th style="text-align: right;">4room_sold</th>
<th style="text-align: right;">5room_sold</th>
<th style="text-align: right;">exec_sold</th>
<th style="text-align: right;">multigen_sold</th>
<th style="text-align: right;">studio_apartment_sold</th>
<th style="text-align: right;">1room_rental</th>
<th style="text-align: right;">2room_rental</th>
<th style="text-align: right;">3room_rental</th>
<th style="text-align: right;">other_room_rental</th>
<th style="text-align: right;">lat</th>
<th style="text-align: right;">lng</th>
<th style="text-align: left;">building</th>
<th style="text-align: left;">addr</th>
<th style="text-align: left;">postal</th>
<th style="text-align: right;">SUBZONE_NO</th>
<th style="text-align: left;">SUBZONE_N</th>
<th style="text-align: left;">SUBZONE_C</th>
<th style="text-align: left;">PLN_AREA_N</th>
<th style="text-align: left;">PLN_AREA_C</th>
<th style="text-align: left;">REGION_N</th>
<th style="text-align: left;">REGION_C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295097</td>
<td style="text-align: right;">103.8541</td>
<td style="text-align: left;">RAFFLES HOTEL</td>
<td style="text-align: left;">1 BEACH ROAD RAFFLES HOTEL SINGAPORE 189673</td>
<td style="text-align: left;">189673</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">4580</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.294801</td>
<td style="text-align: right;">103.8545</td>
<td style="text-align: left;">RAFFLES HOTEL SINGAPORE</td>
<td style="text-align: left;">3 BEACH ROAD RAFFLES HOTEL SINGAPORE SINGAPORE 189674</td>
<td style="text-align: left;">189674</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The HDB Blk 1 Beach Road shares a similar address as Raffles Hotel’s 1 Beach Road, but they have different postal codes.</p>
<p>To verify other similar addresses, filter for addresses containing “BEACH RD”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>beach_rd <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"BEACH RD"</span>, street, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(beach_rd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 5%">
<col style="width: 12%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">…1</th>
<th style="text-align: left;">blk_no</th>
<th style="text-align: left;">street</th>
<th style="text-align: right;">max_floor_lvl</th>
<th style="text-align: right;">year_completed</th>
<th style="text-align: left;">residential</th>
<th style="text-align: left;">commercial</th>
<th style="text-align: left;">market_hawker</th>
<th style="text-align: left;">miscellaneous</th>
<th style="text-align: left;">multistorey_carpark</th>
<th style="text-align: left;">precinct_pavilion</th>
<th style="text-align: left;">bldg_contract_town</th>
<th style="text-align: right;">total_dwelling_units</th>
<th style="text-align: right;">1room_sold</th>
<th style="text-align: right;">2room_sold</th>
<th style="text-align: right;">3room_sold</th>
<th style="text-align: right;">4room_sold</th>
<th style="text-align: right;">5room_sold</th>
<th style="text-align: right;">exec_sold</th>
<th style="text-align: right;">multigen_sold</th>
<th style="text-align: right;">studio_apartment_sold</th>
<th style="text-align: right;">1room_rental</th>
<th style="text-align: right;">2room_rental</th>
<th style="text-align: right;">3room_rental</th>
<th style="text-align: right;">other_room_rental</th>
<th style="text-align: right;">lat</th>
<th style="text-align: right;">lng</th>
<th style="text-align: left;">building</th>
<th style="text-align: left;">addr</th>
<th style="text-align: left;">postal</th>
<th style="text-align: right;">SUBZONE_NO</th>
<th style="text-align: left;">SUBZONE_N</th>
<th style="text-align: left;">SUBZONE_C</th>
<th style="text-align: left;">PLN_AREA_N</th>
<th style="text-align: left;">PLN_AREA_C</th>
<th style="text-align: left;">REGION_N</th>
<th style="text-align: left;">REGION_C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295097</td>
<td style="text-align: right;">103.8541</td>
<td style="text-align: left;">RAFFLES HOTEL</td>
<td style="text-align: left;">1 BEACH ROAD RAFFLES HOTEL SINGAPORE 189673</td>
<td style="text-align: left;">189673</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">1660</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1974</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.295796</td>
<td style="text-align: right;">103.8555</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">15 BEACH ROAD</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">BUGIS</td>
<td style="text-align: left;">DTSZ01</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2079</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1974</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.303689</td>
<td style="text-align: right;">103.8636</td>
<td style="text-align: left;">GOLDEN BEACH VISTA</td>
<td style="text-align: left;">17 BEACH ROAD GOLDEN BEACH VISTA SINGAPORE 190017</td>
<td style="text-align: left;">190017</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">2567</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">136</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.390462</td>
<td style="text-align: right;">103.9753</td>
<td style="text-align: left;">CHANGI BEACH CLUB</td>
<td style="text-align: left;">2 ANDOVER ROAD CHANGI BEACH CLUB SINGAPORE 509984</td>
<td style="text-align: left;">509984</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">CHANGI POINT</td>
<td style="text-align: left;">CHSZ01</td>
<td style="text-align: left;">CHANGI</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">EAST REGION</td>
<td style="text-align: left;">ER</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4580</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1970</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.294801</td>
<td style="text-align: right;">103.8545</td>
<td style="text-align: left;">RAFFLES HOTEL SINGAPORE</td>
<td style="text-align: left;">3 BEACH ROAD RAFFLES HOTEL SINGAPORE SINGAPORE 189674</td>
<td style="text-align: left;">189674</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CITY HALL</td>
<td style="text-align: left;">DTSZ02</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">6028</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.304716</td>
<td style="text-align: right;">103.8652</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">4 BEACH ROAD SINGAPORE 190004</td>
<td style="text-align: left;">190004</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7743</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">336</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.298092</td>
<td style="text-align: right;">103.8569</td>
<td style="text-align: left;">BEACH ROAD CONSERVATION AREA</td>
<td style="text-align: left;">5 TAN QUEE LAN STREET BEACH ROAD CONSERVATION AREA SINGAPORE 188094</td>
<td style="text-align: left;">188094</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">BUGIS</td>
<td style="text-align: left;">DTSZ01</td>
<td style="text-align: left;">DOWNTOWN CORE</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
<tr class="even">
<td style="text-align: right;">8956</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">BEACH RD</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1968</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">KWN</td>
<td style="text-align: right;">198</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.303992</td>
<td style="text-align: right;">103.8644</td>
<td style="text-align: left;">BEACH ROAD GARDENS</td>
<td style="text-align: left;">6 BEACH ROAD BEACH ROAD GARDENS SINGAPORE 190006</td>
<td style="text-align: left;">190006</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">CRAWFORD</td>
<td style="text-align: left;">KLSZ09</td>
<td style="text-align: left;">KALLANG</td>
<td style="text-align: left;">KL</td>
<td style="text-align: left;">CENTRAL REGION</td>
<td style="text-align: left;">CR</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>2, 5 and 15 Beach Road do not have the correct postal codes following the 1900XX convention. Additionally, these addresses do not have the correct coordinates too.</p>
<p>With reference to URA’s official asset map of Singapore, OneMap, the data will be manually modified using <em>mutate()</em> and <em>ifelse()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>hdb_residential2 <span class="ot">&lt;-</span> hdb_residential <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190001</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3036714</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8644787</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190002</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3040331</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8649285</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190003</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3041872</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8651934</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190005</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3043463</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8648158</span>, lng)) <span class="sc">%&gt;%</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">postal =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="dv">190015</span>, postal)) <span class="sc">%&gt;%</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">1.3034254</span>, lat)) <span class="sc">%&gt;%</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lng =</span> <span class="fu">ifelse</span>(blk_no <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> street <span class="sc">==</span> <span class="st">"BEACH RD"</span>, <span class="fl">103.8631535</span>, lng))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check for any duplicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>duplicate <span class="ot">&lt;-</span> hdb_residential2 <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>()<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(duplicate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-c1b0c1b436234c04029a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c1b0c1b436234c04029a">{"x":{"filter":"none","vertical":false,"data":[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>...1<\/th>\n      <th>blk_no<\/th>\n      <th>street<\/th>\n      <th>max_floor_lvl<\/th>\n      <th>year_completed<\/th>\n      <th>residential<\/th>\n      <th>commercial<\/th>\n      <th>market_hawker<\/th>\n      <th>miscellaneous<\/th>\n      <th>multistorey_carpark<\/th>\n      <th>precinct_pavilion<\/th>\n      <th>bldg_contract_town<\/th>\n      <th>total_dwelling_units<\/th>\n      <th>1room_sold<\/th>\n      <th>2room_sold<\/th>\n      <th>3room_sold<\/th>\n      <th>4room_sold<\/th>\n      <th>5room_sold<\/th>\n      <th>exec_sold<\/th>\n      <th>multigen_sold<\/th>\n      <th>studio_apartment_sold<\/th>\n      <th>1room_rental<\/th>\n      <th>2room_rental<\/th>\n      <th>3room_rental<\/th>\n      <th>other_room_rental<\/th>\n      <th>lat<\/th>\n      <th>lng<\/th>\n      <th>building<\/th>\n      <th>addr<\/th>\n      <th>postal<\/th>\n      <th>SUBZONE_NO<\/th>\n      <th>SUBZONE_N<\/th>\n      <th>SUBZONE_C<\/th>\n      <th>PLN_AREA_N<\/th>\n      <th>PLN_AREA_C<\/th>\n      <th>REGION_N<\/th>\n      <th>REGION_C<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,31]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"...1","targets":1},{"name":"blk_no","targets":2},{"name":"street","targets":3},{"name":"max_floor_lvl","targets":4},{"name":"year_completed","targets":5},{"name":"residential","targets":6},{"name":"commercial","targets":7},{"name":"market_hawker","targets":8},{"name":"miscellaneous","targets":9},{"name":"multistorey_carpark","targets":10},{"name":"precinct_pavilion","targets":11},{"name":"bldg_contract_town","targets":12},{"name":"total_dwelling_units","targets":13},{"name":"1room_sold","targets":14},{"name":"2room_sold","targets":15},{"name":"3room_sold","targets":16},{"name":"4room_sold","targets":17},{"name":"5room_sold","targets":18},{"name":"exec_sold","targets":19},{"name":"multigen_sold","targets":20},{"name":"studio_apartment_sold","targets":21},{"name":"1room_rental","targets":22},{"name":"2room_rental","targets":23},{"name":"3room_rental","targets":24},{"name":"other_room_rental","targets":25},{"name":"lat","targets":26},{"name":"lng","targets":27},{"name":"building","targets":28},{"name":"addr","targets":29},{"name":"postal","targets":30},{"name":"SUBZONE_NO","targets":31},{"name":"SUBZONE_N","targets":32},{"name":"SUBZONE_C","targets":33},{"name":"PLN_AREA_N","targets":34},{"name":"PLN_AREA_C","targets":35},{"name":"REGION_N","targets":36},{"name":"REGION_C","targets":37}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>hdb_residential2 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(hdb_residential2, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>,<span class="st">"lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>) </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>hdb_residential2 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(hdb_residential2, <span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>HDB_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, hdb_residential2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {.callout-warning collapse}</p>
<section id="save-memory-space-by-offloading" class="level4">
<h4 class="anchored" data-anchor-id="save-memory-space-by-offloading">Save Memory Space by Offloading</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(hdb)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(hdb_residential)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="public-healthcare" class="level3">
<h3 class="anchored" data-anchor-id="public-healthcare">Public Healthcare</h3>
<section id="data-preparation-2" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-2">Data Preparation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>public_hc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/HospitalsPolyclinics v_2024.csv"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>public_hc.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(public_hc[<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>,], <span class="at">wkt =</span> <span class="st">"geometry"</span>, <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>public_hc2.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(public_hc[<span class="dv">43</span><span class="sc">:</span><span class="dv">1235</span>,], <span class="at">wkt =</span> <span class="st">"geometry"</span>, <span class="at">crs =</span> <span class="dv">3414</span>) <span class="co"># CHAS clinics encoded in EPSG 3414 </span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>public_hc.sf <span class="ot">&lt;-</span> <span class="fu">rbind</span>(public_hc.sf, public_hc2.sf)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(public_hc.sf, <span class="st">"data/rds/public_hc.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/public_hc.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>HC_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, hc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="school" class="level3">
<h3 class="anchored" data-anchor-id="school">School</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/schoolsclean.csv"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(latlong, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"latitude"</span>, <span class="st">"longitude"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>schools_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(schools, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(schools_sf, <span class="st">"data/rds/schools.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {.callout-note collapse}</p>
<section id="save-memory-space-by-offloading-1" class="level4">
<h4 class="anchored" data-anchor-id="save-memory-space-by-offloading-1">Save Memory Space by Offloading</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(schools_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/schools.rds"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>attractiveness<span class="sc">$</span>SCH_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(attractiveness, schools))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
<p>Check attractiveness variables have been added correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(attractiveness))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">geometry</th>
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">BUS_STOP_COUNT</th>
<th style="text-align: right;">ENTERTN_COUNT</th>
<th style="text-align: right;">FOOD_BEV_COUNT</th>
<th style="text-align: right;">LEISURE_COUNT</th>
<th style="text-align: right;">RETAIL_COUNT</th>
<th style="text-align: right;">BIZ_COUNT</th>
<th style="text-align: right;">FIN_COUNT</th>
<th style="text-align: right;">HDB_COUNT</th>
<th style="text-align: right;">HC_COUNT</th>
<th style="text-align: right;">SCH_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">POLYGON ((3578.167 27517.51…</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4328.167 27517.51…</td>
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4328.167 28816.55…</td>
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4328.167 30115.59…</td>
<td style="text-align: left;">H0004</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4703.167 28167.03…</td>
<td style="text-align: left;">H0005</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4703.167 29466.07…</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(attractiveness, <span class="st">"data/rds/attractiveness.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(hotels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="deriving-passengers-alighting-from-bus-stop" class="level2">
<h2 class="anchored" data-anchor-id="deriving-passengers-alighting-from-bus-stop">5.1.2 Deriving Passengers Alighting from Bus Stop</h2>
<p>Aggregate the trips using <code>inner_join()</code>, <code>group_by()</code> and <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>dest_bus_hex <span class="ot">&lt;-</span> od_trips_w_hex <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(bs_hex,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(DESTINATION_PT_CODE <span class="sc">==</span> BusStopCode)) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HEX_ID) <span class="sc">%&gt;%</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(dest_bus_hex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1735</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">12698</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0004</td>
<td style="text-align: right;">4240</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0005</td>
<td style="text-align: right;">5051</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0006</td>
<td style="text-align: right;">23935</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0007</td>
<td style="text-align: right;">8620</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why use inner join?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>An inner join returns only the rows that have matching values in both tables based on the specified join condition.</p></li>
<li><p>It discards unmatched rows from both the left and right tables.</p></li>
<li><p>The result set contains only the rows where the join condition is satisfied.</p></li>
<li><p>Rows from either table that do not have a match in the other table are excluded from the result.</p></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(dest_bus_hex, <span class="st">"data/rds/dest_bus_hex.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save Data Memory Space
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bs_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="propulsiveness-variables" class="level2">
<h2 class="anchored" data-anchor-id="propulsiveness-variables">5.2.1 Propulsiveness variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>propulsiveness <span class="ot">&lt;-</span> hex_grids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>propulsiveness <span class="ot">&lt;-</span> propulsiveness <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">st_drop_geometry</span>(dest_bus_hex)) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">BUS_ALIGHT_COUNT =</span> TRIPS)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(propulsiveness))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">BUS_ALIGHT_COUNT</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1735</td>
<td style="text-align: left;">POLYGON ((3578.167 27517.51…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">POLYGON ((4328.167 27517.51…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">12698</td>
<td style="text-align: left;">POLYGON ((4328.167 28816.55…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0004</td>
<td style="text-align: right;">4240</td>
<td style="text-align: left;">POLYGON ((4328.167 30115.59…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0005</td>
<td style="text-align: right;">5051</td>
<td style="text-align: left;">POLYGON ((4703.167 28167.03…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0006</td>
<td style="text-align: right;">23935</td>
<td style="text-align: left;">POLYGON ((4703.167 29466.07…</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>propulsiveness[<span class="fu">is.na</span>(propulsiveness)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(propulsiveness))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">BUS_ALIGHT_COUNT</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1735</td>
<td style="text-align: left;">POLYGON ((3578.167 27517.51…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">POLYGON ((4328.167 27517.51…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">12698</td>
<td style="text-align: left;">POLYGON ((4328.167 28816.55…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0004</td>
<td style="text-align: right;">4240</td>
<td style="text-align: left;">POLYGON ((4328.167 30115.59…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0005</td>
<td style="text-align: right;">5051</td>
<td style="text-align: left;">POLYGON ((4703.167 28167.03…</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0006</td>
<td style="text-align: right;">23935</td>
<td style="text-align: left;">POLYGON ((4703.167 29466.07…</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(propulsiveness, <span class="st">"data/rds/propulsiveness.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="generating-distance-table" class="level2">
<h2 class="anchored" data-anchor-id="generating-distance-table">5.3 Generating distance table</h2>
<section id="generating-distance-matrix" class="level3">
<h3 class="anchored" data-anchor-id="generating-distance-matrix">Generating distance matrix</h3>
<p>We can use <code>spDists()</code> to generate the distance matrix from the hex_grids layer. The column and row names need to be renamed according to the corresponding <code>HEX_ID</code>s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">spDists</span>(<span class="fu">as</span>(hex_grids, <span class="st">"Spatial"</span>),</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dist_mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_grids<span class="sc">$</span>HEX_ID)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dist_mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_grids<span class="sc">$</span>HEX_ID)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(dist_mat, <span class="at">n=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">H0001</th>
<th style="text-align: right;">H0002</th>
<th style="text-align: right;">H0003</th>
<th style="text-align: right;">H0004</th>
<th style="text-align: right;">H0005</th>
<th style="text-align: right;">H0006</th>
<th style="text-align: right;">H0007</th>
<th style="text-align: right;">H0008</th>
<th style="text-align: right;">H0009</th>
<th style="text-align: right;">H0010</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">2704.163</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">2250.000</td>
<td style="text-align: right;">3436.932</td>
<td style="text-align: right;">4683.748</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">3000.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">4562.072</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">2704.163</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1500.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0004</td>
<td style="text-align: right;">2704.163</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">750.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0005</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">3897.114</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0006</td>
<td style="text-align: right;">2250.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0007</td>
<td style="text-align: right;">3436.932</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">750.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0008</td>
<td style="text-align: right;">4683.748</td>
<td style="text-align: right;">4562.072</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">3897.114</td>
<td style="text-align: right;">2598.076</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">1984.313</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0009</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">3269.174</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1299.038</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0010</td>
<td style="text-align: right;">3000.000</td>
<td style="text-align: right;">2704.163</td>
<td style="text-align: right;">1500.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">750.000</td>
<td style="text-align: right;">1984.313</td>
<td style="text-align: right;">1299.038</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the distance between adjacent centroids are 750m.</p>
</div>
</div>
</section>
<section id="generating-a-pivot-table" class="level3">
<h3 class="anchored" data-anchor-id="generating-a-pivot-table">Generating a pivot table</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>dist_tbl <span class="ot">&lt;-</span> <span class="fu">melt</span>(dist_mat) <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">DISTANCE =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ORIG_HEX_ID =</span> Var1) <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">DEST_HEX_ID =</span> Var2)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(dist_tbl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">ORIG_HEX_ID</th>
<th style="text-align: left;">DEST_HEX_ID</th>
<th style="text-align: right;">DISTANCE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">750.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1500.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0004</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2704.163</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0005</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1299.038</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2250.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Logically, intra-zonal distances are 0. This occurs when bus passengers are commuting to bus stops along the bus route that are within the same hexagon from where the passenger boarded the bus.</p>
<p>However, distances cannot be kept to 0 since we are going to conduct log-based Poisson regression modelling for spatial interaction modelling. Specifically, log(0) is undefined.</p>
<p>A reasonable replacement of the zero values would be 200m, assuming that the shortest distance between two consecutive bus stops is 200m.</p>
<p>Setting intra-zonal distances to 200m,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>dist_tbl<span class="sc">$</span>DISTANCE[dist_tbl<span class="sc">$</span>ORIG_HEX_ID <span class="sc">==</span> dist_tbl<span class="sc">$</span>DEST_HEX_ID] <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dist_tbl<span class="sc">$</span>DISTANCE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    200    8352   13332   14240   19018   47381 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(dist_tbl, <span class="st">"data/rds/dist_tbl.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save Data Memory Space by offloading
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dist_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="data-consolidation" class="level1">
<h1>6.0 Data Consolidation</h1>
<p>Load the necessary data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/hex_grids.rds"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>flowlines <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flowlines.rds"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>dist_tbl <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/dist_tbl.rds"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>attractiveness <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/attractiveness.rds"</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>propulsiveness <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/propulsiveness.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generating the consolidated geospatial data will require the following columns:</p>
<ul>
<li><p><code>ORIG_HEX_ID</code>: ID corresponding to the origin zone</p></li>
<li><p><code>DEST_HEX_ID</code>: ID corresponding to the destination zone</p></li>
<li><p><code>DISTANCE</code>: Distance between the (centroids of) origin and destination zones</p></li>
<li><p><code>TRIPS</code>: Number of bus trips between the origin and destination zones</p></li>
<li><p><code>DEST_*_COUNT</code>: Values from [Attractiveness Variables Table (attractiveness)]</p></li>
<li><p><code>ORIG_*_COUNT</code>: Values from [Propulsiveness Variables Table (propulsiveness)]</p></li>
<li><p>Geometry defining flowlines</p></li>
</ul>
<p>Now proceed to join the tables!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Flowlines</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Distance</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Propulsive</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Attractive</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(flowlines))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ORIG_HEX_ID</th>
<th style="text-align: left;">DEST_HEX_ID</th>
<th style="text-align: left;">ORIGIN_SUBZONE</th>
<th style="text-align: left;">DESTINATION_SUBZONE</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">TIME_PER_HOUR</th>
<th style="text-align: right;">TRIPS</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0005</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">H0006</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">TUAS</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">LINESTRING (3578.167 27950….</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>od_hex2 <span class="ot">&lt;-</span> od_trips_w_hex <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIG_HEX_ID, DEST_HEX_ID) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>flowlines2 <span class="ot">&lt;-</span> od_hex2 <span class="sc">%&gt;%</span> <span class="fu">od2line</span>(</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  hex_grids,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zone_code =</span> <span class="st">"HEX_ID"</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> flowlines2 <span class="sc">%&gt;%</span> </span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIG_HEX_ID, DEST_HEX_ID) <span class="sc">%&gt;%</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> SIM_data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dist_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Propulsive zones originate from origins so <code>propulsiveness</code> will join with <code>SIM_data</code> with the unique identifier as <code>ORIG_HEX_ID</code>. The <code>ORIG_</code> prefix will be added in by <code>propulsiveness</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  SIM_data,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  propulsiveness <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste</span>(<span class="st">"ORIG_"</span>, .x, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>Attractive zones originate from destinations so <code>attractiveness</code> will join with <code>SIM_data</code> with the unique identifier as <code>DEST_HEX_ID</code>. The <code>DEST_</code> prefix will be added in by <code>propulsiveness</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  SIM_data,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  attractiveness <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste</span>(<span class="st">"DEST_"</span>, .x, <span class="at">sep=</span> <span class="st">""</span>))</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(SIM_data, <span class="st">"data/rds/SIM_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="finishing-touches" class="level2">
<h2 class="anchored" data-anchor-id="finishing-touches">Finishing Touches</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/SIM_data.rds"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SIM_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ORIG_HEX_ID     DEST_HEX_ID        TRIPS                  geometry    
 H0588  :  313   H0725  :  314   Min.   :      1   LINESTRING   :68158  
 H0725  :  313   H0588  :  313   1st Qu.:     64   epsg:3414    :    0  
 H0504  :  285   H0488  :  287   Median :    338   +proj=tmer...:    0  
 H0501  :  283   H0504  :  284   Mean   :   3986                        
 H0237  :  281   H0653  :  283   3rd Qu.:   1652                        
 H0488  :  280   H0501  :  279   Max.   :1116120                        
 (Other):66403   (Other):66398                                          
    DISTANCE     ORIG_BUS_ALIGHT_COUNT DEST_BUS_STOP_COUNT DEST_ENTERTN_COUNT
 Min.   :  200   Min.   :     28       Min.   : 1.000      Min.   : 0.0000   
 1st Qu.: 3000   1st Qu.: 137200       1st Qu.: 5.000      1st Qu.: 0.0000   
 Median : 5662   Median : 349858       Median : 8.000      Median : 0.0000   
 Mean   : 6535   Mean   : 572344       Mean   : 7.424      Mean   : 0.1455   
 3rd Qu.: 9216   3rd Qu.: 679671       3rd Qu.:10.000      3rd Qu.: 0.0000   
 Max.   :24727   Max.   :5597771       Max.   :20.000      Max.   :12.0000   
                                                                             
 DEST_FOOD_BEV_COUNT DEST_LEISURE_COUNT DEST_RETAIL_COUNT DEST_BIZ_COUNT   
 Min.   : 0          Min.   : 0.000     Min.   :  0.00    Min.   :  0.000  
 1st Qu.: 0          1st Qu.: 0.000     1st Qu.:  6.00    1st Qu.:  0.000  
 Median : 0          Median : 1.000     Median : 21.00    Median :  1.000  
 Mean   : 2          Mean   : 1.543     Mean   : 57.27    Mean   :  5.643  
 3rd Qu.: 1          3rd Qu.: 2.000     3rd Qu.: 64.00    3rd Qu.:  5.000  
 Max.   :88          Max.   :13.000     Max.   :851.00    Max.   :104.000  
                                                                           
 DEST_FIN_COUNT   DEST_HDB_COUNT  DEST_HC_COUNT    DEST_SCH_COUNT
 Min.   : 0.000   Min.   : 0.00   Min.   : 0.000   Min.   :0.00  
 1st Qu.: 0.000   1st Qu.: 0.00   1st Qu.: 0.000   1st Qu.:0.00  
 Median : 3.000   Median : 8.00   Median : 1.000   Median :0.00  
 Mean   : 5.234   Mean   :16.44   Mean   : 2.094   Mean   :0.52  
 3rd Qu.: 7.000   3rd Qu.:29.00   3rd Qu.: 3.000   3rd Qu.:1.00  
 Max.   :72.000   Max.   :73.00   Max.   :17.000   Max.   :4.00  
                                                                 </code></pre>
</div>
</div>
<p>For the data to be compatible with modelling, we can change the zeroes to 0.99.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>replace_zeroes <span class="ot">&lt;-</span> <span class="cf">function</span>(data, col_name) {</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  data[[col_name]][data[[col_name]] <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fl">0.99</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> SIM_data <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"ORIG_BUS_ALIGHT_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_ENTERTN_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_FOOD_BEV_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_LEISURE_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_RETAIL_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_BIZ_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_FIN_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_HC_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_SCH_COUNT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_zeroes</span>(<span class="st">"DEST_HDB_COUNT"</span>)</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SIM_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ORIG_HEX_ID     DEST_HEX_ID        TRIPS                  geometry    
 H0588  :  313   H0725  :  314   Min.   :      1   LINESTRING   :68158  
 H0725  :  313   H0588  :  313   1st Qu.:     64   epsg:3414    :    0  
 H0504  :  285   H0488  :  287   Median :    338   +proj=tmer...:    0  
 H0501  :  283   H0504  :  284   Mean   :   3986                        
 H0237  :  281   H0653  :  283   3rd Qu.:   1652                        
 H0488  :  280   H0501  :  279   Max.   :1116120                        
 (Other):66403   (Other):66398                                          
    DISTANCE     ORIG_BUS_ALIGHT_COUNT DEST_BUS_STOP_COUNT DEST_ENTERTN_COUNT
 Min.   :  200   Min.   :     28       Min.   : 1.000      Min.   : 0.990    
 1st Qu.: 3000   1st Qu.: 137200       1st Qu.: 5.000      1st Qu.: 0.990    
 Median : 5662   Median : 349858       Median : 8.000      Median : 0.990    
 Mean   : 6535   Mean   : 572344       Mean   : 7.424      Mean   : 1.049    
 3rd Qu.: 9216   3rd Qu.: 679671       3rd Qu.:10.000      3rd Qu.: 0.990    
 Max.   :24727   Max.   :5597771       Max.   :20.000      Max.   :12.000    
                                                                             
 DEST_FOOD_BEV_COUNT DEST_LEISURE_COUNT DEST_RETAIL_COUNT DEST_BIZ_COUNT   
 Min.   : 0.99       Min.   : 0.990     Min.   :  0.99    Min.   :  0.990  
 1st Qu.: 0.99       1st Qu.: 0.990     1st Qu.:  6.00    1st Qu.:  0.990  
 Median : 0.99       Median : 1.000     Median : 21.00    Median :  1.000  
 Mean   : 2.61       Mean   : 1.985     Mean   : 57.35    Mean   :  6.077  
 3rd Qu.: 1.00       3rd Qu.: 2.000     3rd Qu.: 64.00    3rd Qu.:  5.000  
 Max.   :88.00       Max.   :13.000     Max.   :851.00    Max.   :104.000  
                                                                           
 DEST_FIN_COUNT   DEST_HDB_COUNT  DEST_HC_COUNT    DEST_SCH_COUNT 
 Min.   : 0.990   Min.   : 0.99   Min.   : 0.990   Min.   :0.990  
 1st Qu.: 0.990   1st Qu.: 0.99   1st Qu.: 0.990   1st Qu.:0.990  
 Median : 3.000   Median : 8.00   Median : 1.000   Median :0.990  
 Mean   : 5.521   Mean   :16.82   Mean   : 2.487   Mean   :1.156  
 3rd Qu.: 7.000   3rd Qu.:29.00   3rd Qu.: 3.000   3rd Qu.:1.000  
 Max.   :72.000   Max.   :73.00   Max.   :17.000   Max.   :4.000  
                                                                  </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save the layer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(SIM_data, <span class="st">"data/rds/SIM_data_final1.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="visualising-spatial-interactions" class="level1">
<h1>7.0 Visualising Spatial Interactions</h1>
<p>Load relevant datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>mpsz3414 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/mpsz3414.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `mpsz3414' from data source 
  `C:\guacodemoleh\IS415-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\mpsz3414.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 328 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 21448.47 xmax: 55941.94 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/hex_grids.rds"</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>flowlines <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flowlines.rds"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>SIM_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/SIM_data_final1.rds"</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>propulsiveness <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/propulsiveness.rds"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>attractiveness <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/attractiveness.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="general-view" class="level2">
<h2 class="anchored" data-anchor-id="general-view">General view</h2>
<p>Since the flowlines dataset is large, remove the intra-zonal flows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>flowlines_no_intra <span class="ot">&lt;-</span> flowlines <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ORIG_HEX_ID <span class="sc">!=</span> DEST_HEX_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can use <code>quantile()</code> to check the appropriate cut-off numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(flowlines_no_intra<span class="sc">$</span>TRIPS,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      80%       90%       95%       99%      100% 
    72.00    197.00    457.00   2121.85 134014.00 </code></pre>
</div>
</div>
<p>Showing the top 1% of these flow lines will reveal important details as they take up the majority of the bu trips that occurred from November 2023 to January 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>flowlines_base <span class="ot">&lt;-</span> <span class="fu">filter</span>(flowlines_no_intra, flowlines_no_intra<span class="sc">$</span>TRIPS<span class="sc">&gt;=</span><span class="dv">2386</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"lightgrey"</span>,<span class="at">title=</span><span class="st">"Singapore Boundary"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"white"</span>, <span class="at">title=</span><span class="st">"Hexagons"</span>, <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(flowlines_base) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="st">"TRIPS"</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"# of bus trips"</span>,</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Top 1% Bus Passenger flows"</span>,</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="plotting-trips-vs-distance" class="level1">
<h1>Plotting TRIPS vs DISTANCE</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(SIM_data,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> DISTANCE, <span class="at">y =</span> TRIPS)) <span class="sc">+</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2386</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">20000</span>,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">600</span>, <span class="at">label =</span> <span class="st">"95th percentile"</span>,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1510</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">20000</span>,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">1800</span>, <span class="at">label =</span> <span class="st">"99th percentile"</span>,</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of Trips as a Function of Distance"</span>,</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance (m)"</span>,</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Trips"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(SIM_data,</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(DISTANCE), <span class="at">y =</span> <span class="fu">log</span>(TRIPS))) <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="visualising-propulsive-forces" class="level2">
<h2 class="anchored" data-anchor-id="visualising-propulsive-forces">Visualising propulsive forces</h2>
<p>::: {callout-tip collapse=“true”} ### Creating a helper function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>plot_propulsive <span class="ot">&lt;-</span> <span class="cf">function</span>(var_name, title_comp, <span class="at">day_type =</span> <span class="cn">NULL</span>, <span class="at">hour =</span> <span class="cn">NULL</span>, <span class="at">pa=</span><span class="cn">NULL</span>) {</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  flowlines_filtered <span class="ot">&lt;-</span> flowlines_no_intra</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(day_type)) {</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> day_type)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(hour)) {</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TIME_PER_HOUR <span class="sc">==</span> hour)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pa)) {</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ORIGIN_SUBZONE <span class="sc">==</span> pa)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"lightgrey"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding this layer underneath propulsiveness as we removed 0s. from the map</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># so it won't skew the legend</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(propulsiveness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(var_name, <span class="sc">~</span>. <span class="sc">&gt;=</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(var_name, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(flowlines_no_intra <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TRIPS <span class="sc">&gt;</span> <span class="dv">2385</span>)) <span class="sc">+</span></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TRIPS"</span>,</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>),</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"# of bus trips"</span>,</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Top 1% Bus Passenger Flows and"</span>, title_comp),</span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>,</span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">bg.alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"*Passenger data"</span>,</span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>))</span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
<p>Looking at transfers from Buses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_propulsive</span>(<span class="st">"BUS_ALIGHT_COUNT"</span>, <span class="st">"Potential Transfers from Bus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualising-attractive-forces" class="level2">
<h2 class="anchored" data-anchor-id="visualising-attractive-forces">Visualising attractive forces</h2>
<p>::: {callout-tip collapse=“true”} ### Creating a helper function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>plot_attractive <span class="ot">&lt;-</span> <span class="cf">function</span>(var_name, title_comp, <span class="at">day_type =</span> <span class="cn">NULL</span>, <span class="at">hour =</span> <span class="cn">NULL</span>, <span class="at">pa =</span> <span class="cn">NULL</span>) {</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  flowlines_filtered <span class="ot">&lt;-</span> flowlines_no_intra</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(day_type)) {</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> day_type)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(hour)) {</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TIME_PER_HOUR <span class="sc">==</span> hour)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pa)) {</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    flowlines_filtered <span class="ot">&lt;-</span> flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DESTINATION_SUBZONE <span class="sc">==</span> pa)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(mpsz3414) <span class="sc">+</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"green"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding this layer underneath attractiveness as we removed 0s. from the map</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># so it won't skew the legend</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(attractiveness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>({{var_name}}, <span class="sc">~</span>. <span class="sc">&gt;=</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>({{var_name}}, <span class="at">palette =</span> <span class="st">"Purples"</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(flowlines_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TRIPS <span class="sc">&gt;</span> <span class="dv">2385</span>)) <span class="sc">+</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="st">"TRIPS"</span>,</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>),</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">title.lwd =</span> <span class="st">"# of bus trips"</span>,</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Top 1% Bus Passenger Flows and"</span>, {{title_comp}}),</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>,</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">bg.alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"*Passenger data"</span>,</span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>))</span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">HDBs</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Businesses</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Entertainment</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">F&amp;B</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">Leisure</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-7" role="tab" aria-controls="tabset-4-7" aria-selected="false">Retail</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-8" role="tab" aria-controls="tabset-4-8" aria-selected="false">Financial Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-9" role="tab" aria-controls="tabset-4-9" aria-selected="false">Public Healthcare Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-10" role="tab" aria-controls="tabset-4-10" aria-selected="false">School</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"BUS_STOP_COUNT"</span>, <span class="st">"Number of Bus Stops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"HDB_COUNT"</span>, <span class="st">"Number of HDB Blocks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"BIZ_COUNT"</span>, <span class="st">"Number of Business Locations"</span>, <span class="at">day_type =</span> <span class="st">"WEEKENDS/HOLIDAY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"ENTERTN_COUNT"</span>, <span class="st">"Number of Entertainment </span><span class="sc">\n</span><span class="st">Locations at 5pm on Weekdays"</span>, <span class="at">day_type =</span> <span class="st">"WEEKDAY"</span>, <span class="at">hour=</span><span class="dv">17</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"FOOD_BEV_COUNT"</span>, <span class="st">"Number of F&amp;B Locations"</span>, <span class="at">pa =</span> <span class="st">"BEDOK"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"LEISURE_COUNT"</span>, <span class="st">"Number of Leisure </span><span class="sc">\n</span><span class="st">&amp; Recreation Spots attracting flows to Bedok and Paya Lebar"</span>, <span class="at">pa =</span> <span class="fu">c</span>(<span class="st">"BEDOK"</span>, <span class="st">"PAYA LEBAR"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"RETAIL_COUNT"</span>, <span class="st">"Number of Retail Locations at 1pm"</span>, <span class="at">hour =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"FIN_COUNT"</span>, <span class="st">"Number of Financial Service Locations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"HC_COUNT"</span>, <span class="st">"Number of Public Healthcare Spots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_attractive</span>(<span class="st">"SCH_COUNT"</span>, <span class="st">"Number of School Locations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="prototype-potential" class="level1">
<h1>7.1 Prototype Potential</h1>
<p>The user inputs will include:</p>
<ul>
<li><p>Flow direction with the choices of <code>Overall</code>, <code>Outgoing</code>, <code>Incoming</code></p></li>
<li><p>A viewing level drop-down bar with choices of <code>Overall</code>, <code>PLN_AREA</code>. If <code>PLN_AREA</code> is selected, there will be a further drp-down feature for the user to select the interested planning areas of the Origins and Destinations.</p></li>
<li><p>Day type with the choices of <code>Overall</code>, <code>WEEKDAY</code>, <code>WEEKENDS/HOLIDAYS</code></p></li>
<li><p>Time hour choice in a sliding bar style, ranging from 0 to 23.</p></li>
<li><p>A sliding bar to control the number of trips shown based on the user inputs</p></li>
</ul>
</section>
<section id="spatial-econometric-interaction-modelling" class="level1">
<h1>8.0 Spatial Econometric Interaction Modelling</h1>
<p>Remove the intra-zonal zones pairs from SIM_data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>SIM_data_no_intra <span class="ot">&lt;-</span> SIM_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ORIG_HEX_ID <span class="sc">!=</span> DEST_HEX_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To calibrate SEIM using spflow package, three data sets are required:</p>
<ul>
<li><p>Spatial Weights</p></li>
<li><p>Distance Matrix</p></li>
<li><p>Explanatory Variables</p></li>
</ul>
<section id="prepare-spatial-weights" class="level2">
<h2 class="anchored" data-anchor-id="prepare-spatial-weights">Prepare Spatial Weights</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>hex_grid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(mpsz3414, <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="dv">750</span>, <span class="dv">750</span>), <span class="at">what =</span> <span class="st">"polygons"</span>, <span class="at">square =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply as.factor() since index will be used as the identifier to link to other data sets</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">as.factor</span>(<span class="fu">row_number</span>()))</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create border of Singapore's land area</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>mpsz_border <span class="ot">&lt;-</span> mpsz3414 <span class="sc">%&gt;%</span> <span class="fu">st_union</span>()</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the hexagon grid layer</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>hex_grid_bounded <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(hex_grid, mpsz_border)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if hex grid intersects any polygons using st_intersects</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns a list of intersecting hexagons</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>intersection_list <span class="ot">=</span> hex_grid<span class="sc">$</span>index[<span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grid, hex_grid_bounded)) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the intersecting hexagons</span></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>hex_grids <span class="ot">=</span> hex_grid <span class="sc">%&gt;%</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(index <span class="sc">%in%</span> intersection_list)</span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>BUS_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, BusStop))</span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>ENTERTN_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, entertn))</span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>FOOD_BEV_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, food_bev))</span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>LEISURE_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, leis_rec))</span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>RETAIL_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, retail))</span>
<span id="cb125-26"><a href="#cb125-26" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>BIZ_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, biz))</span>
<span id="cb125-27"><a href="#cb125-27" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>FIN_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, fin))</span>
<span id="cb125-28"><a href="#cb125-28" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>HDB_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, hdb_residential2))</span>
<span id="cb125-29"><a href="#cb125-29" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>HC_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, hc))</span>
<span id="cb125-30"><a href="#cb125-30" aria-hidden="true" tabindex="-1"></a>hex_grids<span class="sc">$</span>SCHOOL_COUNT <span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grids, schools))</span>
<span id="cb125-31"><a href="#cb125-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-32"><a href="#cb125-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-33"><a href="#cb125-33" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hex_grids) <span class="sc">+</span></span>
<span id="cb125-34"><a href="#cb125-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"BUS_COUNT"</span>,</span>
<span id="cb125-35"><a href="#cb125-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb125-36"><a href="#cb125-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cont"</span>,</span>
<span id="cb125-37"><a href="#cb125-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Bus Stop Density"</span>) <span class="sc">+</span></span>
<span id="cb125-38"><a href="#cb125-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"grey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03b_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> hex_grids <span class="sc">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">"BUS_COUNT"</span> <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geometry) <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>))</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary report</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  750.0   750.0   750.0   751.6   750.0  3436.9 </code></pre>
</div>
</div>
<p>The largest first nearest neighbour distance is 2461.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>({</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_point_on_surface</span>(<span class="fu">st_geometry</span>(hex_grids))})</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>hexgrid_nb <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_contiguity"</span> <span class="ot">=</span> <span class="fu">poly2nb</span>(hex_grids),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_distance"</span> <span class="ot">=</span> <span class="fu">dnearneigh</span>(centroids, </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="dv">3437</span>),</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"by_knn"</span> <span class="ot">=</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(centroids, <span class="dv">6</span>))</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>hexgrid_nb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$by_contiguity
Neighbour list object:
Number of regions: 1673 
Number of nonzero links: 9478 
Percentage nonzero weights: 0.3386295 
Average number of links: 5.665272 
1 region with no links:
1671
5 disjoint connected subgraphs

$by_distance
Neighbour list object:
Number of regions: 1673 
Number of nonzero links: 119676 
Percentage nonzero weights: 4.275778 
Average number of links: 71.53377 
2 disjoint connected subgraphs

$by_knn
Neighbour list object:
Number of regions: 1673 
Number of nonzero links: 10038 
Percentage nonzero weights: 0.3586372 
Average number of links: 6 
2 disjoint connected subgraphs
Non-symmetric neighbours list</code></pre>
</div>
</div>
</section>
<section id="preparing-flow-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-flow-data">Preparing Flow Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>flowlines<span class="sc">$</span>DISTANCE <span class="ot">&lt;-</span> dist_tbl<span class="sc">$</span>DISTANCE[<span class="fu">match</span>(<span class="fu">paste</span>(flowlines<span class="sc">$</span>ORIG_HEX_ID, flowlines<span class="sc">$</span>DEST_HEX_ID), <span class="fu">paste</span>(dist_tbl<span class="sc">$</span>ORIG_HEX_ID, dist_tbl<span class="sc">$</span>DEST_HEX_ID))]</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> flowlines <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ORIG_HEX_ID, DEST_HEX_ID, TRIPS, DISTANCE) <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIG_HEX_ID, DEST_HEX_ID, DISTANCE) <span class="sc">%&gt;%</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(flow_data, <span class="st">"data/rds/flow_data_3b.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>flow_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/flow_data_3b.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-explanatory-variables" class="level2">
<h2 class="anchored" data-anchor-id="preparing-explanatory-variables">Preparing Explanatory Variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>explanatory <span class="ot">&lt;-</span> hex_grids <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(explanatory, <span class="st">"data/rds/explanatory.rds"</span>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>explanatory <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/explanatory.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-spflow_network-class-objects" class="level2">
<h2 class="anchored" data-anchor-id="creating-spflow_network-class-objects">Creating spflow_network-class objects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>hex_net <span class="ot">&lt;-</span> <span class="fu">spflow_network</span>(</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_net =</span> <span class="st">"sg"</span>,  <span class="co"># assign an id name, can give it any input</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_neighborhood =</span> <span class="fu">nb2mat</span>(hexgrid_nb<span class="sc">$</span>by_distance),</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_data =</span> explanatory,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">node_key_column =</span> <span class="st">"index"</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>hex_net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial network nodes with id: sg
--------------------------------------------------
Number of nodes: 1673
Average number of links per node: 71.534
Density of the neighborhood matrix: 4.28% (non-zero connections)

Data on nodes:
     index BUS_COUNT ENTERTN_COUNT FOOD_BEV_COUNT LEISURE_COUNT RETAIL_COUNT
1       25         0             0              0             0            0
2       26         0             0              0             0            0
3       27         0             0              0             0            0
4       28         0             0              0             0            0
5       29         0             0              0             0            0
6       47         0             0              0             0            0
---    ---       ---           ---            ---           ---          ---
1668  2957         0             0              0             0            0
1669  3003         0             0              0             0            0
1670  3026         0             0              0             0            0
1671  3205         0             0              0             0            0
1672  3276         0             0              0             0            0
1673  3322         0             0              0             0            0
     BIZ_COUNT FIN_COUNT HDB_COUNT HC_COUNT SCHOOL_COUNT
1            0         0         0        0            0
2            0         0         0        0            0
3            0         0         0        0            0
4            0         0         0        0            0
5            0         0         0        0            0
6            0         0         0        0            0
---        ---       ---       ---      ---          ---
1668         0         0         0        0            0
1669         0         0         0        0            0
1670         0         0         0        0            0
1671         0         0         0        0            0
1672         0         0         0        0            0
1673         0         0         0        0            0</code></pre>
</div>
</div>
<p>Create spflow_network_pair-class using <code>spflow_network_pair()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>hex_net_pairs <span class="ot">&lt;-</span> <span class="fu">spflow_network_pair</span>(</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_orig_net =</span> <span class="st">"sg"</span>,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_dest_net =</span> <span class="st">"sg"</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pair_data =</span> flow_data,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_key_column =</span> <span class="st">"ORIG_HEX_ID"</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dest_key_column =</span> <span class="st">"DEST_HEX_ID"</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>hex_net_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>hex_multi_net <span class="ot">&lt;-</span> <span class="fu">spflow_network_multi</span>(hex_net, hex_net_pairs)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>hex_multi_net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>M. Chan. Applied Spatial Interaction Models - Case Study of Singapore Public Bus Commuter Flows. https://geospatial2023.netlify.app/take_home_exercise/ex2/take_home_ex2#calibrate-spatial-econometric-interaction-model-usng-maximum-likelihood-estimation</p>
<p>K. J. Paas, 2023. Take Home Exercise 2: A Case Study of Singapore Public Bus Commuter Flows. https://isss624-kjcpaas.netlify.app/take-home_ex2/take-home_ex2</p>
<p>T. S. Kam.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>